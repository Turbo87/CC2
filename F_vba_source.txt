olevba 0.60.2 on Python 3.11.3 - http://decalage.info/python/oletools
===============================================================================
FILE: F_vbaProject.bin
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Private Sub Workbook_Open()

Application.EnableAutoComplete = False
Application.MaxIterations = 50
Application.MaxChange = 0.001
End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet6.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/Sheet6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet3.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/Sheet3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet4.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/Sheet4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Sheet5.cls 
in file: F_vbaProject.bin - OLE stream: 'VBA/Sheet5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module1.bas 
in file: F_vbaProject.bin - OLE stream: 'VBA/Module1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
#If VBA7 And Win64 Then
    Dim LastRow As LongPtr
#Else
    Dim LastRow As Long
#End If

Sub Aselect()
'
' JLR 4/30/14 Revised 4/9/2015 Hp correction already in Ab
'
Application.ScreenUpdating = False
Workbooks("A.xlsm").Activate
ActiveWindow.WindowState = xlMaximized
Application.ScreenUpdating = True
ActiveWindow.DisplayWorkbookTabs = False
Application.ScreenUpdating = False
Workbooks("F.xlsm").Activate
'HpA correction copy to M2,M5,M8
Sheets("B").Range("M2").Value = Sheets("B").Range("F1").Value
Sheets("B").Range("M5").Value = Sheets("B").Range("F2").Value
Sheets("B").Range("M8").Value = Sheets("B").Range("F3").Value
Sheets("Sheet2").Activate

Range("E9").FormulaR1C1 = "=IF(OR(B!R[8]C[-4]<>"""",B!R[-6]C[-4]=""X""),""PR"","""")"
Range("D9").FormulaR1C1 = "=IF(RC[1]="""",1000,900)"
Range("D9:E9").Value = Range("D9:E9").Value

If Range("A10009") <> "" Then
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A9").Value = "REF"
    Sheets("Sheet3").Range("D9:E9").Value = Sheets("Sheet2").Range("D9:E9").Value
    Sheets("Sheet3").Range("A10:E60009").Value = Sheets("Sheet2").Range("A10:E60009").Value
    
    Sheets("Sheet2").Activate
    If Range("A10009") <> "" And Range("A20009") = "" Then
        Range("I12:I15").FormulaR1C1 = "=IF(R[-1]C="""",1,"""")"
    ElseIf Range("A20009") <> "" And Range("A30009") = "" Then
        Range("I12:I15").FormulaR1C1 = "=IF(SUM(R[-2]C:R[-1]C)=0,1,"""")"
    ElseIf Range("A30009") <> "" And Range("A40009") = "" Then
        Range("I13:I15").FormulaR1C1 = "=IF(SUM(R[-3]C:R[-1]C)=0,1,"""")"
    ElseIf Range("A40009") <> "" Then
        Range("I15").FormulaR1C1 = "=IF(SUM(R[-5]C:R[-1]C)=0,1,"""")"
    End If

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("I15:I15").AutoFill Destination:=.Range("I15:I" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("I11:I60009").Value = Range("I11:I60009").Value

    Range("I10").Value = 1
    Range("J10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    Range("K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    Range("M10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("J10:N10").AutoFill Destination:=.Range("J10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("J10:N60009").Value = Range("J10:N60009").Value
    Range("J10:N60009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("A10:E60009").Clear
    Range("A10:E10009").Value = Range("J10:N10009").Value
    Columns("F:N").Clear
End If

    Application.Run "F.xlsm!Straight"

End Sub

Sub Straight()
'
' Revised 4/28/15 consider LoH > < 100, PR vs Fr; amended 9/29/15 for STD reverse
' Re-written 7/16/2017 to consolidate Straight & Large


Application.ScreenUpdating = False
 
    Range("A9").FormulaR1C1 = "=IF(Sheet3!R[1]C<>"""",""REF"","""")"
    ActiveSheet.Calculate
    Range("A9").Value = Range("A9").Value
    
    If Range("A9") = "REF" Then
             Sheets("Sheet3").Activate
   
    ElseIf Range("A9") <> "REF" Then
             Sheets("Sheet2").Activate
    End If

    Range("B5:C5").FormulaR1C1 = "=MIN(R[5]C:R[60004]C)"
    Range("B6:C6").FormulaR1C1 = "=MAX(R[4]C:R[60003]C)"
    Range("B5:C6").Value = Range("B5:C6").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=R5C2,RC[-5]=R6C2,RC[-4]=R5C3,RC[-4]=R6C3),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("M10").FormulaR1C1 = _
        "=IF(R[1]C[-6]="""","""",6371*ACOS(SIN(RC[-5])*SIN(R[1]C[-5])+COS(RC[-5])*COS(R[1]C[-5])*COS(R[1]C[-4]-RC[-4])))"
    Range("N10").FormulaR1C1 = _
        "=IF(R[2]C[-7]="""","""",6371*ACOS(SIN(RC[-6])*SIN(R[2]C[-6])+COS(RC[-6])*COS(R[2]C[-6])*COS(R[2]C[-5]-RC[-5])))"
    Range("O10").FormulaR1C1 = _
        "=IF(R[3]C[-8]="""","""",6371*ACOS(SIN(RC[-7])*SIN(R[3]C[-7])+COS(RC[-7])*COS(R[3]C[-7])*COS(R[3]C[-6]-RC[-6])))"
    Range("P10").FormulaR1C1 = _
        "=IF(R[4]C[-9]="""","""",6371*ACOS(SIN(RC[-8])*SIN(R[4]C[-8])+COS(RC[-8])*COS(R[4]C[-8])*COS(R[4]C[-7]-RC[-7])))"
    Range("Q10").FormulaR1C1 = _
        "=IF(R[5]C[-10]="""","""",6371*ACOS(SIN(RC[-9])*SIN(R[5]C[-9])+COS(RC[-9])*COS(R[5]C[-9])*COS(R[5]C[-8]-RC[-8])))"
    Range("R10").FormulaR1C1 = _
        "=IF(R[6]C[-11]="""","""",6371*ACOS(SIN(RC[-10])*SIN(R[6]C[-10])+COS(RC[-10])*COS(R[6]C[-10])*COS(R[6]C[-9]-RC[-9])))"
    Range("S10").FormulaR1C1 = _
        "=IF(R[7]C[-12]="""","""",6371*ACOS(SIN(RC[-11])*SIN(R[7]C[-11])+COS(RC[-11])*COS(R[7]C[-11])*COS(R[7]C[-10]-RC[-10])))"
    Range("T10").FormulaR1C1 = _
        "=IF(R[8]C[-13]="""","""",6371*ACOS(SIN(RC[-12])*SIN(R[8]C[-12])+COS(RC[-12])*COS(R[8]C[-12])*COS(R[8]C[-11]-RC[-11])))"
    Range("U10").FormulaR1C1 = _
        "=IF(R[9]C[-14]="""","""",6371*ACOS(SIN(RC[-13])*SIN(R[9]C[-13])+COS(RC[-13])*COS(R[9]C[-13])*COS(R[9]C[-12]-RC[-12])))"
    Range("V10").FormulaR1C1 = _
        "=IF(R[10]C[-15]="""","""",6371*ACOS(SIN(RC[-14])*SIN(R[10]C[-14])+COS(RC[-14])*COS(R[10]C[-14])*COS(R[10]C[-13]-RC[-13])))"
    Range("W10").FormulaR1C1 = _
        "=IF(R[11]C[-16]="""","""",6371*ACOS(SIN(RC[-15])*SIN(R[11]C[-15])+COS(RC[-15])*COS(R[11]C[-15])*COS(R[11]C[-14]-RC[-14])))"
    
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:W10").AutoFill Destination:=.Range("M10:W" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("M10:W21").Value = Range("M10:W21").Value

  If Range("E9") <> "PR" Then

    Range("M23:M34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-3]-R[-12]C[-3]<=R9C4),AND(R[-13]C<=100,R[-13]C[-3]-R[-12]C[-3]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-3]-R[-12]C[-3]>R9C4),R[-13]C-((R[-13]C[-3]-R[-12]C[-3]-R9C4)*0.1),0)))"
    Range("N23:N34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-4]-R[-11]C[-4]<=R9C4),AND(R[-13]C<=100,R[-13]C[-4]-R[-11]C[-4]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-4]-R[-11]C[-4]>R9C4),R[-13]C-((R[-13]C[-4]-R[-11]C[-4]-R9C4)*0.1),0)))"
    Range("O23:O34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-5]-R[-10]C[-5]<=R9C4),AND(R[-13]C<=100,R[-13]C[-5]-R[-10]C[-5]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-5]-R[-10]C[-5]>R9C4),R[-13]C-((R[-13]C[-5]-R[-10]C[-5]-R9C4)*0.1),0)))"
    Range("P23:P34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-6]-R[-9]C[-6]<=R9C4),AND(R[-13]C<=100,R[-13]C[-6]-R[-9]C[-6]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-6]-R[-9]C[-6]>R9C4),R[-13]C-((R[-13]C[-6]-R[-9]C[-6]-R9C4)*0.1),0)))"
    Range("Q23:Q34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-7]-R[-8]C[-7]<=R9C4),AND(R[-13]C<=100,R[-13]C[-7]-R[-8]C[-7]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-7]-R[-8]C[-7]>R9C4),R[-13]C-((R[-13]C[-7]-R[-8]C[-7]-R9C4)*0.1),0)))"
    Range("R23:R34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-8]-R[-7]C[-8]<=R9C4),AND(R[-13]C<=100,R[-13]C[-8]-R[-7]C[-8]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-8]-R[-7]C[-8]>R9C4),R[-13]C-((R[-13]C[-8]-R[-7]C[-8]-R9C4)*0.1),0)))"
    Range("S23:S34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-9]-R[-6]C[-9]<=R9C4),AND(R[-13]C<=100,R[-13]C[-9]-R[-6]C[-9]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-9]-R[-6]C[-9]>R9C4),R[-13]C-((R[-13]C[-9]-R[-6]C[-9]-R9C4)*0.1),0)))"
    Range("T23:T34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-10]-R[-5]C[-10]<=R9C4),AND(R[-13]C<=100,R[-13]C[-10]-R[-5]C[-10]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-10]-R[-5]C[-10]>R9C4),R[-13]C-((R[-13]C[-10]-R[-5]C[-10]-R9C4)*0.1),0)))"
    Range("U23:U34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-11]-R[-4]C[-11]<=R9C4),AND(R[-13]C<=100,R[-13]C[-11]-R[-4]C[-11]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-11]-R[-4]C[-11]>R9C4),R[-13]C-((R[-13]C[-11]-R[-4]C[-11]-R9C4)*0.1),0)))"
    Range("V23:V34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-12]-R[-3]C[-12]<=R9C4),AND(R[-13]C<=100,R[-13]C[-12]-R[-3]C[-12]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-12]-R[-3]C[-12]>R9C4),R[-13]C-((R[-13]C[-12]-R[-3]C[-12]-R9C4)*0.1),0)))"
    Range("W23:W34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-13]-R[-2]C[-13]<=R9C4),AND(R[-13]C<=100,R[-13]C[-13]-R[-2]C[-13]<=10*R[-13]C)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-13]-R[-2]C[-13]>R9C4),R[-13]C-((R[-13]C[-13]-R[-2]C[-13]-R9C4))*0.1,0)))"
 
  ElseIf Range("E9") = "PR" Then
    
    Range("M23:M34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-3]-R[-12]C[-3]<=R9C4),AND(R[-13]C<=100,R[-13]C[-3]-R[-12]C[-3]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-3]-R[-12]C[-3]>R9C4),R[-13]C-((R[-13]C[-3]-R[-12]C[-3]-R9C4)*0.1),0)))"
    Range("N23:N34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-4]-R[-11]C[-4]<=R9C4),AND(R[-13]C<=100,R[-13]C[-4]-R[-11]C[-4]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-4]-R[-11]C[-4]>R9C4),R[-13]C-((R[-13]C[-4]-R[-11]C[-4]-R9C4)*0.1),0)))"
    Range("O23:O34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-5]-R[-10]C[-5]<=R9C4),AND(R[-13]C<=100,R[-13]C[-5]-R[-10]C[-5]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-5]-R[-10]C[-5]>R9C4),R[-13]C-((R[-13]C[-5]-R[-10]C[-5]-R9C4)*0.1),0)))"
    Range("P23:P34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-6]-R[-9]C[-6]<=R9C4),AND(R[-13]C<=100,R[-13]C[-6]-R[-9]C[-6]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-6]-R[-9]C[-6]>R9C4),R[-13]C-((R[-13]C[-6]-R[-9]C[-6]-R9C4)*0.1),0)))"
    Range("Q23:Q34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-7]-R[-8]C[-7]<=R9C4),AND(R[-13]C<=100,R[-13]C[-7]-R[-8]C[-7]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-7]-R[-8]C[-7]>R9C4),R[-13]C-((R[-13]C[-7]-R[-8]C[-7]-R9C4)*0.1),0)))"
    Range("R23:R34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-8]-R[-7]C[-8]<=R9C4),AND(R[-13]C<=100,R[-13]C[-8]-R[-7]C[-8]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-8]-R[-7]C[-8]>R9C4),R[-13]C-((R[-13]C[-8]-R[-7]C[-8]-R9C4)*0.1),0)))"
    Range("S23:S34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-9]-R[-6]C[-9]<=R9C4),AND(R[-13]C<=100,R[-13]C[-9]-R[-6]C[-9]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-9]-R[-6]C[-9]>R9C4),R[-13]C-((R[-13]C[-9]-R[-6]C[-9]-R9C4)*0.1),0)))"
    Range("T23:T34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-10]-R[-5]C[-10]<=R9C4),AND(R[-13]C<=100,R[-13]C[-10]-R[-5]C[-10]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-10]-R[-5]C[-10]>R9C4),R[-13]C-((R[-13]C[-10]-R[-5]C[-10]-R9C4)*0.1),0)))"
    Range("U23:U34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-11]-R[-4]C[-11]<=R9C4),AND(R[-13]C<=100,R[-13]C[-11]-R[-4]C[-11]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-11]-R[-4]C[-11]>R9C4),R[-13]C-((R[-13]C[-11]-R[-4]C[-11]-R9C4)*0.1),0)))"
    Range("V23:V34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-12]-R[-3]C[-12]<=R9C4),AND(R[-13]C<=100,R[-13]C[-12]-R[-3]C[-12]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-12]-R[-3]C[-12]>R9C4),R[-13]C-((R[-13]C[-12]-R[-3]C[-12]-R9C4)*0.1),0)))"
    Range("W23:W34").FormulaR1C1 = _
        "=IF(R[-13]C="""","""",IF(OR(AND(R[-13]C>100,R[-13]C[-13]-R[-2]C[-13]<=R9C4),AND(R[-13]C<=100,R[-13]C[-13]-R[-2]C[-13]<=(10*R[-13]C)-100)),R[-13]C,IF(AND(R[-13]C>100,R[-13]C[-13]-R[-2]C[-13]>R9C4),R[-13]C-((R[-13]C[-13]-R[-2]C[-13]-R9C4))*0.1,0)))"
    End If

    ActiveSheet.Calculate
    Range("M10:W21").Value = Range("M23:W34").Value
    Range("M23:W34").Clear
    
    Range("I5").FormulaR1C1 = "=MAX(R10C13:R21C23)"
    ActiveSheet.Calculate

    Range("I5").Value = Range("I5").Value
    
    Range("M7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[13]C)<>R5C9,"""",IF(MAX(R[3]C:R[13]C)=R[3]C,R[4]C7,IF(MAX(R[3]C:R[13]C)=R[4]C,R[5]C7,IF(MAX(R[3]C:R[13]C)=R[5]C,R[6]C7,IF(MAX(R[3]C:R[13]C)=R[6]C,R[7]C7,IF(MAX(R[3]C:R[13]C)=R[7]C,R[8]C7,IF(MAX(R[3]C:R[13]C)=R[8]C,R[9]C7,"""")))))))"
    Range("M8").FormulaR1C1 = _
        "=IF(MAX(R[2]C:R[12]C)<>R5C9,"""",IF(MAX(R[2]C:R[12]C)=R[8]C,R[9]C7,IF(MAX(R[2]C:R[12]C)=R[9]C,R[10]C7,IF(MAX(R[2]C:R[12]C)=R[10]C,R[11]C7,IF(MAX(R[2]C:R[12]C)=R[11]C,R[12]C7,IF(MAX(R[2]C:R[12]C)=R[12]C,R[13]C7,""""))))))"
    Range("N7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[12]C)<>R5C9,"""",IF(MAX(R[3]C:R[12]C)=R[3]C,R[5]C7,IF(MAX(R[3]C:R[12]C)=R[4]C,R[6]C7,IF(MAX(R[3]C:R[12]C)=R[5]C,R[7]C7,IF(MAX(R[3]C:R[12]C)=R[6]C,R[8]C7,IF(MAX(R[3]C:R[12]C)=R[7]C,R[9]C7,IF(MAX(R[3]C:R[12]C)=R[8]C,R[10]C7,"""")))))))"
    Range("N8").FormulaR1C1 = _
        "=IF(MAX(R[2]C:R[11]C)<>R5C9,"""",IF(MAX(R[2]C:R[11]C)=R[8]C,R[10]C7,IF(MAX(R[2]C:R[11]C)=R[9]C,R[11]C7,IF(MAX(R[2]C:R[11]C)=R[10]C,R[12]C7,IF(MAX(R[2]C:R[11]C)=R[11]C,R[13]C7,"""")))))"
    Range("O7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[11]C)<>R5C9,"""",IF(MAX(R[3]C:R[11]C)=R[3]C,R[6]C7,IF(MAX(R[3]C:R[11]C)=R[4]C,R[7]C7,IF(MAX(R[3]C:R[11]C)=R[5]C,R[8]C7,IF(MAX(R[3]C:R[11]C)=R[6]C,R[9]C7,IF(MAX(R[3]C:R[11]C)=R[7]C,R[10]C7,IF(MAX(R[3]C:R[11]C)=R[8]C,R[11]C7,"""")))))))"
    Range("O8").FormulaR1C1 = _
        "=IF(MAX(R[2]C:R[10]C)<>R5C9,"""",IF(MAX(R[2]C:R[10]C)=R[8]C,R[11]C7,IF(MAX(R[2]C:R[10]C)=R[9]C,R[12]C7,IF(MAX(R[2]C:R[10]C)=R[10]C,R[13]C7,""""))))"
    Range("P7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[10]C)<>R5C9,"""",IF(MAX(R[3]C:R[10]C)=R[3]C,R[7]C7,IF(MAX(R[3]C:R[10]C)=R[4]C,R[8]C7,IF(MAX(R[3]C:R[10]C)=R[5]C,R[9]C7,IF(MAX(R[3]C:R[10]C)=R[6]C,R[10]C7,IF(MAX(R[3]C:R[10]C)=R[7]C,R[11]C7,IF(MAX(R[3]C:R[10]C)=R[8]C,R[12]C7,"""")))))))"
    Range("P8").FormulaR1C1 = _
        "=IF(MAX(R[2]C:R[9]C)<>R5C9,"""",IF(MAX(R[2]C:R[9]C)=R[8]C,R[12]C7,IF(MAX(R[2]C:R[9]C)=R[9]C,R[13]C7,"""")))"
    Range("Q7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[9]C)<>R5C9,"""",IF(MAX(R[3]C:R[9]C)=R[3]C,R[8]C7,IF(MAX(R[3]C:R[9]C)=R[4]C,R[9]C7,IF(MAX(R[3]C:R[9]C)=R[5]C,R[10]C7,IF(MAX(R[3]C:R[9]C)=R[6]C,R[11]C7,IF(MAX(R[3]C:R[9]C)=R[7]C,R[12]C7,IF(MAX(R[3]C:R[9]C)=R[8]C,R[13]C7,"""")))))))"
    Range("Q8").FormulaR1C1 = _
        "=IF(MAX(R[2]C:R[8]C)<>R5C9,"""",IF(MAX(R[2]C:R[8]C)=R[8]C,R[13]C7,""""))"
    Range("R7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[8]C)<>R5C9,"""",IF(MAX(R[3]C:R[8]C)=R[3]C,R[9]C7,IF(MAX(R[3]C:R[8]C)=R[4]C,R[10]C7,IF(MAX(R[3]C:R[8]C)=R[5]C,R[11]C7,IF(MAX(R[3]C:R[8]C)=R[6]C,R[12]C7,IF(MAX(R[3]C:R[8]C)=R[7]C,R[13]C7,IF(MAX(R[3]C:R[8]C)=R[8]C,R[14]C7)))))))"
    Range("S7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[7]C)<>R5C9,"""",IF(MAX(R[3]C:R[7]C)=R[3]C,R[10]C7,IF(MAX(R[3]C:R[7]C)=R[4]C,R[11]C7,IF(MAX(R[3]C:R[7]C)=R[5]C,R[12]C7,IF(MAX(R[3]C:R[7]C)=R[6]C,R[13]C7,IF(MAX(R[3]C:R[7]C)=R[7]C,R[14]C7))))))"
    Range("T7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[6]C)<>R5C9,"""",IF(MAX(R[3]C:R[6]C)=R[3]C,R[11]C7,IF(MAX(R[3]C:R[6]C)=R[4]C,R[12]C7,IF(MAX(R[3]C:R[6]C)=R[5]C,R[13]C7,IF(MAX(R[3]C:R[6]C)=R[6]C,R[14]C7)))))"
    Range("U7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[5]C)<>R5C9,"""",IF(MAX(R[3]C:R[5]C)=R[3]C,R[12]C7,IF(MAX(R[3]C:R[5]C)=R[4]C,R[13]C7,IF(MAX(R[3]C:R[5]C)=R[5]C,R[14]C7))))"
    Range("V7").FormulaR1C1 = _
        "=IF(MAX(R[3]C:R[4]C)<>R5C9,"""",IF(MAX(R[3]C:R[4]C)=R[3]C,R[13]C7,R[14]C7))"
    Range("W7").FormulaR1C1 = "=IF(R[3]C<>R5C9,"""",R[14]C7)"
    ActiveSheet.Calculate

    Range("M9:W9").FormulaR1C1 = "=IF(MAX(R[1]C:R[11]C)=R5C9,MAX(R[-2]C:R[-1]C),"""")"

    Range("L10:L20").FormulaR1C1 = "=IF(MAX(RC[1]:RC[11])=R5C9,RC[-5],"""")"
    ActiveSheet.Calculate

    Range("M7:W9").Value = Range("M7:W9").Value
    Range("L10:L20").Value = Range("L10:L20").Value
    
    Range("A1").FormulaR1C1 = "=MAX(R10C12:R21C12)"
    Range("A2").FormulaR1C1 = "=MAX(R9C13:R9C23)"
    ActiveSheet.Calculate

    Range("A1:A2").Value = Range("A1:A2").Value
    
    Range("G10:L60009,L7:W21").Clear
    
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R1C1,RC[-6]=R2C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<"""",RC[-6],"""")"
    
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("A1:E2").Value = Range("G10:K11").Value
    
    Range("B5:I6,G10:K12").Clear
    Range("F2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate

    Range("F2").Value = Range("F2").Value
    
   If Range("E9") <> "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
   ElseIf Range("E9") = "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
   End If
    ActiveSheet.Calculate

    Range("G2").Value = Range("G2").Value
    Range("F2").Value = Range("G2").Value
    
    'PaynePain added 5/19/15
    Range("F6:K6").FormulaR1C1 = "=MAX(R[4]C:R[60003]C)"
    Range("F7:K7").FormulaR1C1 = "=MAX(R[3]C[7]:R[60002]C[7])"
    
    Range("F10").FormulaR1C1 = _
        "=IF(RC[-5]>=R2C1,"""",IF(RC[-2]-R2C4<R9C4,6371*ACOS(SIN(RC[-4])*SIN(R2C2)+COS(RC[-4])*COS(R2C2)*COS(R2C3-RC[-3])),6371*ACOS(SIN(RC[-4])*SIN(R2C2)+COS(RC[-4])*COS(R2C2)*COS(R2C3-RC[-3]))-((RC[-2]-R2C4-R9C4)*0.1)))"
    Range("G10").FormulaR1C1 = "=IF(RC[-1]="""","""",IF(RC[-1]=R6C6,RC[-6],""""))"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("F10:K10").AutoFill Destination:=.Range("F10:K" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
   
    Range("F6:K6").Value = Range("F6:K6").Value
    Range("F6").Clear
    
    Range("M10").FormulaR1C1 = _
        "=IF(RC[-12]<R6C7,"""",IF(R6C10-RC[-9]<R9C4,6371*ACOS(SIN(RC[-11])*SIN(R6C8)+COS(RC[-11])*COS(R6C8)*COS(R6C9-RC[-10])),6371*ACOS(SIN(RC[-11])*SIN(R6C8)+COS(RC[-11])*COS(R6C8)*COS(R6C9-RC[-10]))-((R6C10-RC[-9]-R9C4)*0.1)))"
    Range("N10").FormulaR1C1 = "=IF(RC[-1]=R7C6,RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
   'Copy Ref A
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:R10").AutoFill Destination:=.Range("M10:R" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
   
    Range("F7:K7").Value = Range("F7:K7").Value
    
    If Range("F7") > Range("F2") Then
        Range("A1:E1").Value = Range("G6:K6").Value
        Range("A2:E2").Value = Range("G7:K7").Value
        Range("F2").Value = Range("F7").Value
        
        If Range("E9") <> "PR" Then
            Range("G2").FormulaR1C1 = _
                "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
        ElseIf Range("E9") = "PR" Then
            Range("G2").FormulaR1C1 = _
            "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
        End If
    End If
    ActiveSheet.Calculate

    Range("F6:R60009").Clear

    'Re-calc Start
    Range("A5").Value = 1 / 24
    
    Range("I8:N8").FormulaR1C1 = "=MAX(R[2]C:R[60001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R1C1-R5C1,RC[-6]<=R1C1+R5C1),6371*ACOS(SIN(RC[-5])*SIN(R2C2)+COS(RC[-5])*COS(R2C2)*COS(R2C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]="""","""",IF(RC[-1]>100,R9C4,IF(AND(RC[-1]<=100,R9C5<>""PR""),10*RC[-1],IF(AND(RC[-1]<=100,R9C5=""PR""),10*RC[-1]-100))))"
    Range("I10").FormulaR1C1 = "=IF(RC[-5]-R2C4<=RC[-1],RC[-2],RC[-2]-((RC[-5]-R2C4-RC[-1])*0.1))"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R8C9,RC[-9],"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
     Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
  If Range("I8") > Range("F2") Then
    Range("A1:E1").Value = Range("J8:N8").Value
    Range("F2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate
    Range("F2").Value = Range("F2").Value
    
    If Range("E9") <> "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
    ElseIf Range("E9") = "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
    End If
    ActiveSheet.Calculate

    Range("G2").Value = Range("G2").Value
    Range("F2").Value = Range("G2").Value
    Range("G2").Clear
   End If

    'recalc fini
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R2C1-R5C1,RC[-6]<=R2C1+R5C1),6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]="""","""",IF(RC[-1]>100,R9C4,IF(AND(RC[-1]<=100,R9C5<>""PR""),10*RC[-1],IF(AND(RC[-1]<=100,R9C5=""PR""),10*RC[-1]-100))))"
    Range("I10").FormulaR1C1 = "=IF(R1C4-RC[-5]<=RC[-1],RC[-2],RC[-2]-((R1C4-RC[-5]-RC[-1])*0.1))"
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:I10").AutoFill Destination:=.Range("G10:I" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

If Range("I8") > Range("F2") Then
    Range("A2:E2").Value = Range("J8:N8").Value
    Range("F2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("F2").Value = Range("F2").Value
 If Range("E9") <> "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
 ElseIf Range("E9") = "PR" Then
    Range("G2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
 End If
    ActiveSheet.Calculate
End If
 
  'CK reverse
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>=R2C1,6371*ACOS(SIN(RC[-5])*SIN(R2C2)+COS(RC[-5])*COS(R2C2)*COS(R2C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]="""","""",IF(RC[-1]>100,R9C4,IF(AND(RC[-1]<=100,R9C5<>""PR""),10*RC[-1],IF(AND(RC[-1]<=100,R9C5=""PR""),10*RC[-1]-100))))"
    Range("I10").FormulaR1C1 = "=IF(R2C4-RC[-5]<=RC[-1],RC[-2],RC[-2]-((R2C4-RC[-5]-RC[-1])*0.1))"
    'Copy Ref a
     With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:I10").AutoFill Destination:=.Range("G10:I" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
If Range("I8") > Range("F2") Then
    Range("A1:E1").Value = Range("J8:N8").Value
    Range("A1:E2").Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("F2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("F2").Value = Range("F2").Value
    If Range("E9") <> "PR" Then
        Range("G2").FormulaR1C1 = _
            "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
    ElseIf Range("E9") = "PR" Then
        Range("G2").FormulaR1C1 = _
            "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
    End If
 End If
 ActiveSheet.Calculate
 
    Range("A5,G8:N60009").Clear

  'Ck w/in 1 minute
    Range("A7").Value = 6.94444444444444E-04
    
    'FINIS
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R2C1-R7C1,RC[-6]<=R2C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort COPY to N1"
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("G10:K133").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    Range("G10:K133").Clear
    
    'STARTS
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C1-R7C1,RC[-6]<=R1C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    'MATRIX REVISED THIS SECTION!! N6,L10
    If Range("F2") > 100 Then
        Range("N10:EE132").FormulaR1C1 = _
            "=IF(OR(R1C="""",RC11="""",RC9=R3C),"""",IF(AND(6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>100,RC10-R4C<=R9C4),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9)),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))-((RC10-R4C-R9C4)*0.1)))"
    ElseIf Range("F2") <= 100 And Range("E9") <> "PR" Then
        Range("N10:EE132").FormulaR1C1 = _
        "=IF(OR(RC11="""",R1C="""",RC9=R3C),"""",IF(RC10-R4C<=63710*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9)),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9)),0))"
    ElseIf Range("F2") <= 100 And Range("E9") = "PR" Then
        Range("N10:EE132").FormulaR1C1 = _
        "=IF(OR(RC11="""",R1C="""",RC9=R3C),"""",IF(RC10-R4C<=63710*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))-100,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9)),0))"
    End If

    Range("I5").FormulaR1C1 = "=MAX(R10C14:R132C135)"
    ActiveSheet.Calculate
    Range("I5").Value = Range("I5").Value
    Range("N6:EE6").FormulaR1C1 = "=IF(AND(R[-5]C<>"""",MAX(R[4]C:R[124]C)=R5C9),R[-5]C,"""")"
    ActiveSheet.Calculate
    Range("N6:EE6").Value = Range("N6:EE6").Value
    Range("L10:L132").FormulaR1C1 = "=IF(MAX(RC[2]:RC[123])=R5C9,RC[-5],"""")"
    ActiveSheet.Calculate
    Range("L10:L132").Value = Range("L10:L132").Value
    
    Range("N10:EE132").Clear
    
    Range("N7:EE10").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-5]C,"""")"
    
    Range("H2").FormulaR1C1 = "=MAX(R[4]C[6]:R[4]C[128])"
    Range("I2").FormulaR1C1 = "=MAX(R[5]C[5]:R[5]C[127])"
    Range("J2").FormulaR1C1 = "=MAX(R[6]C[4]:R[6]C[126])"
    Range("K2").FormulaR1C1 = "=MAX(R[7]C[3]:R[7]C[125])"
    Range("L2").FormulaR1C1 = "=MAX(R[8]C[2]:R[8]C[124])"
    ActiveSheet.Calculate
    Range("H2:L2").Value = Range("H2:L2").Value
    
    Range("M10:Q122").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-5],"""")"

    Range("H1:L1").FormulaR1C1 = "=MAX(R[9]C[4]:R[131]C[4])"
    ActiveSheet.Calculate
    Range("H1:L1").Value = Range("H1:L1").Value
    Columns("N:EE").Clear
    Range("G5:M300").Clear
    
    Range("M2").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate
    Range("M2").Value = Range("M2").Value
    
   If Range("E9") <> "PR" Then
    Range("N2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=10*RC[-1])),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
   ElseIf Range("E9") = "PR" Then
    Range("N2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]<=R9C4),AND(RC[-1]<=100,R[-1]C[-3]-RC[-3]<=(10*RC[-1])-100)),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-RC[-3]>R9C4),RC[-1]-((R[-1]C[-3]-RC[-3]-R9C4)*0.1),0))"
   End If
    ActiveSheet.Calculate
    Range("M2").Value = Range("N2").Value
    Range("N2").Clear
       
    If Range("M2") > Range("F2") Then
        Range("A1:F2").Value = Range("H1:M2").Value
        Range("A7,H1:M2").Clear
    End If
    
    Sheets("Sheet2").Activate
    Range("H1:M2").Value = Sheets("Sheet3").Range("A1:F2").Value
    
    If Range("H1") <> "" Then
        Range("A1:F2").Value = Range("H1:M2").Value
        Range("H1:M2").Clear
        Sheets("Sheet3").Range("A1:F2").Clear

    End If

    Sheets("Tasks").Activate
    Sheets("Tasks").Range("C10:E11").Value = Sheets("Sheet2").Range("A1:C2").Value
    Sheets("Tasks").Activate
    Range("F10:G11").FormulaR1C1 = "=DEGREES(RC[-2])"
    ActiveSheet.Calculate
    Range("F10:G11").Value = Range("F10:G11").Value
    Sheets("Tasks").Range("H10:J11").Value = Sheets("Sheet2").Range("D1:F2").Value

Sheets("Sheet2").Activate
Application.Run "F.xlsm!NewOR1"
End Sub

-------------------------------------------------------------------------------
VBA MACRO Module4.bas 
in file: F_vbaProject.bin - OLE stream: 'VBA/Module4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
#If VBA7 And Win64 Then
    Dim LastRow As LongPtr
#Else
    Dim LastRow As Long
#End If

Sub Triangle1()
'
' 2/8/14 JLR finds 3 TP triangle, based on StDist OffCourse & O&R Start/Fini Macro CloseSF added 10/9/14; W6 modified for 2-TP Triangles via O&R S/F or NearestS/F
'
 Application.ScreenUpdating = False
    Application.Run "F.xlsm!CloseSF"
    Sheets("Sheet2").Range("A7").Value = Sheets("TASKS").Range("G40").Value
    Sheets("Sheet2").Range("B7").Value = Sheets("TASKS").Range("G41").Value
    Sheets("Sheet2").Range("A8").Value = Sheets("TASKS").Range("C14").Value
    Sheets("Sheet2").Range("B8").Value = Sheets("TASKS").Range("C16").Value
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("Tasks").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("Tasks").Range("H10:I11").Value
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
        
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C[3],"""",IF(AND(RC1>R8C1,RC1<R8C2),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"

    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").Value = Range("J8:N8").Value
    
    Sheets("Sheet2").Range("P3:R4").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("S3:T4").Value = Sheets("TASKS").Range("H10:I11").Value
    Range("P2:T4").Sort Key1:=Range("P2"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
    Range("F9").Value = 6.94444444444444E-04
    'Range("W6").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(ABS(R[-2]C[-7]-R[2]C[-21])<R[3]C[-17],ABS(R[-4]C[-7]-R[2]C[-22])<R[3]C[-17],ABS(R[-4]C[-7]-R[1]C[-22])<5*R[3]C[-17]),""2TP"",IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"",""""))"
    Range("P2:W6").Value = Range("P2:W6").Value
  '''''''''''''''''
  If Range("W6") = "2TP" Then
    Application.Run ("F.xlsm!SibTri")
  End If
  
  If Range("W6") = "" Then
    Sheets("Sheet2").Range("A1:E4").Value = Sheets("Tasks").Range("A40:E44").Value
    Range("A6").Value = 2.08333333333333E-03
    Range("P6").FormulaR1C1 = _
        "=IF(AND(R[-4]C>=R[-4]C[-15]-RC[-15],R[-4]C<=R[-4]C[-15]+RC[-15],R[-2]C>=R[-2]C[-15]-RC[-15],R[-2]C<=R[-2]C[-15]+RC[-15]),""2 X 4"",IF(AND(R[-4]C>=R[-5]C[-15]-RC[-15],R[-4]C<=R[-5]C[-15]+RC[-15],R[-3]C>=R[-4]C[-15]-RC[-15],R[-3]C<R[-4]C[-15]+RC[-15],R[-2]C>=R[-3]C[-15]-RC[-15],R[-2]C<=R[-3]C[-15]+RC[-15]),""123"",""""))"
    Range("P6").Value = Range("P6").Value

If Range("P6") = 123 Then
    Application.Run "F.xlsm!TriAlmost"
    
ElseIf Range("P6") = "2 X 4" Then
    Range("P3:U3").Clear
    Range("U2:V6").Clear
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R2C16,RC[-6]<R4C16),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("P9:U9").FormulaR1C1 = "=MAX(R[1]C:R[10000]C)"
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=R4C21"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    Range("P10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R9C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("Q9") <> 0 Then
        Range("P3:T3").Value = Range("Q9:U9").Value
        Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
        Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
        Range("W6").FormulaR1C1 = "=IF(OR(AND(R[-1]C[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*R[-1]C[-1]),AND(R[-1]C[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*R[-1]C[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*R[-1]C[-1])),""OK"","""")"
        Range("U2:W6").Value = Range("U2:W6").Value
    End If
 
    Range("A6").FormulaR1C1 = "=R[-4]C-R[-5]C"
      If Range("A6") < 1 / 48 Then
        Range("F5").FormulaR1C1 = "=6371*ACOS(SIN(R[-4]C[-4])*SIN(R[-2]C[-4])+COS(R[-4]C[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-R[-4]C[-3]))"
        Range("F6").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-4])*SIN(R[-2]C[-4])+COS(R[-3]C[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-R[-3]C[-3]))"
        Range("F7").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-4])*SIN(R[-6]C[-4])+COS(R[-3]C[-4])*COS(R[-6]C[-4])*COS(R[-6]C[-3]-R[-3]C[-3]))"
        Range("F8").FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
        Range("G8").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(R[-3]C[-1]:R[-1]C[-1])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-3]C[-1]:R[-1]C[-1])>=0.25*RC[-1],MAX(R[-3]C[-1]:R[-1]C[-1])<=0.45*RC[-1])),""OK"",""NOPE"")"
        Range("F5:G8").Value = Range("F5:G8").Value
    
        If Range("W6") = "OK" And Range("G8") = "OK" And Range("V5") < Range("F8") Then
        Range("F5:G8,W6").Clear
        End If
      End If
   End If
End If
 
    Range("A6,P6,G7:U10009").Clear
  
  If Range("W6") = "OK" And Range("A1") <> "This is a 2-Turn Point Triangle" Then
    Application.Run "F.xlsm!ReCk"
    Columns("G:N").Clear
    Range("A2:F4").Value = Range("P2:U4").Value
    Range("F6:F7").Value = Range("V5:V6").Value
    Range("E6").Value = Range("X6").Value
    Range("A8:B8,P2:X7").Clear
  ElseIf Range("W6") <> "OK" And Range("A1") <> "This is a 2-Turn Point Triangle" Then
    Columns("G:N").Clear
    Application.Run "F.xlsm!TriOrds"
  End If

If Range("A1") <> "This is a 2-Turn Point Triangle" And Range("A1") <> "NONE IDENTIFIED" Then
    Sheets("Sheet2").Range("A1:C1").Value = Sheets("TASKS").Range("C14:E14").Value
    Sheets("Sheet2").Range("E1:D1").Value = Sheets("TASKS").Range("H14:I14").Value
    Sheets("Sheet2").Range("A5:C5").Value = Sheets("TASKS").Range("C17:E17").Value
    Sheets("Sheet2").Range("D5:E5").Value = Sheets("TASKS").Range("H17:I17").Value
    
    If Range("A4") > Range("A5") Or Range("A2") < Range("A1") Then
        Application.Run "F.xlsm!TriSFredux"
    End If

    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("B2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("C2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("B3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("C3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G2").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("B4").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("C4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G4").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("B3").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("C3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G3").Value = Sheets("YDWK3").Range("F37").Value
    
ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("B2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("C2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("B3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("C3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G2").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("B4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("C4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G3").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("B2").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("C2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("G4").Value = Sheets("YDWK3").Range("F37").Value
 End If
 
Application.Run "F.xlsm!YDWK3clear"
Range("G6").FormulaR1C1 = "=SUM(R[-4]C:R[-2]C)"
Range("G7").FormulaR1C1 = "=IF(OR(AND(R[-1]C>=750,MIN(R[-5]C:R[-3]C)>=0.25*R[-1]C,MAX(R[-5]C:R[-3]C)<=0.45*R[-1]C),AND(R[-1]C<750,MIN(R[-5]C:R[-3]C)>=0.28*R[-1]C)),""OK"","""")"
Range("E7").FormulaR1C1 = "=IF(OR(R1C1=""NONE IDENTIFIED"",RC[1]=""""),""NONE IDENTIFIED"",IF(OR(AND(RC[1]>=750,MIN(R[-5]C[1]:R[-3]C[1])>=0.25*RC[1],MAX(R[-5]C[1]:R[-3]C[1])<=0.45*RC[1]),AND(RC[1]<750,MIN(R[-5]C[1]:R[-3]C[1])>=0.28*RC[1])),""OK"",""""))"
Range("E8").FormulaR1C1 = "=IF(AND(R[-1]C=""OK"",R[-1]C[2]=""""),""No record-eligible Triangle found. Great Circle distances are shown in red above"","""")"
Range("G6:G7").Value = Range("G6:G7").Value
Range("E7:E8").Value = Range("E7:E8").Value

If Range("E7") = "NONE IDENTIFIED" Then
    Sheets("TASKS").Range("G26").Value = Sheets("Sheet2").Range("E7").Value
    Sheets("Sheet2").Range("A1:X8").Clear
    Sheets("TASKS").Activate
    'Restore raw pressure altitudes to K
    Range("K10,K11,K14:K17,K20:K24").FormulaR1C1 = "=IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13)"
    Range("K27:K29").FormulaR1C1 = "=IF(R[-1]C[-4]=""NONE IDENTIFIED"","""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
    Range("K30").FormulaR1C1 = "=IF(OR(R26C7=""NONE IDENTIFIED"",RC[-8]=""""),"""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
    Range("K31").FormulaR1C1 = "=IF(OR(R26C7=""NONE IDENTIFIED"",RC[-8]=""""),"""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
    Range("K10:K31").Value = Range("K10:K31").Value
    If Range("A2") = "PR" Then
        Range("H10:H11,H14:H17,H20:H24").Value = "N/A"
        Range("K10,K11,K14:K17,K20:K24").FormulaR1C1 = "=RC[-2]"
    ElseIf Range("A2") <> "PR" Then
        Range("K10,K11,K14:K17,K20:K24").FormulaR1C1 = "=IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13)"
    End If
    Range("H10:H24").Value = Range("K10:K24").Value
    Range("A27:A32").EntireRow.Hidden = True
    Exit Sub
End If

If Range("E8") = "" Then
    Range("F2:F6").Value = Range("G2:G6").Value
    Range("F7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    Range("F7").Value = Range("F7").Value
    Range("F8").Value = Range("G7").Value
    Range("G2:G10009").Clear
End If
Range("A7:B8,F9").Clear
Columns("H:X").Clear
Range("A1").Select
Application.Run "F.xlsm!TriFline1"
End Sub
Sub CloseSF()
'
' Find closest S/F for Triangle claims Run early in Triangle1 for Antares et al
'
    Sheets("Sheet2").Range("A6").Value = Sheets("TASKS").Range("C14").Value
    Sheets("Sheet2").Range("B6").Value = Sheets("TASKS").Range("C17").Value
    
    Range("A7").Value = 1.38888888888889E-03
    Range("G10").FormulaR1C1 = "=IF(OR(AND(RC[-6]>=R6C1-R7C1,RC[-6]<=R6C1+R7C1),AND(RC[-6]>=R6C2-R7C1,RC[-6]<=R6C2+R7C1)),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:L10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
   
    Range("M10").FormulaR1C1 = "=IF(RC[-6]>=R6C2-R7C1,RC[-6],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref G Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:Q10").AutoFill Destination:=.Range("M10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:Q509").Value = Range("M10:Q509").Value
    Range("M10:Q509").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
   
    Range("M10:Q250").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("M10:Q500").Clear
    'MATRIX
    Range("N10:IV10").FormulaR1C1 = "=IF(OR(RC7>=R1C14,RC9=R3C,R1C=""""),"""",6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9)))"
    'Copy Ref G
     Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:IV10").AutoFill Destination:=.Range("N10:IV" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("I5").FormulaR1C1 = "=MIN(R[5]C[5]:R[255]C[247])"
    Range("I5").Value = Range("I5").Value
    Range("N6:IV6").FormulaR1C1 = "=IF(MIN(R[4]C:R[314]C)=R5C9,R[-5]C,"""")"
    Range("N6:IV6").Value = Range("N6:IV6").Value
    
    Range("L10:L250").FormulaR1C1 = "=IF(MIN(RC[2]:RC[244])=R5C9,RC[-5],"""")"
    Range("L10:L250").Value = Range("L10:L250").Value
    Range("N10:IV509").Clear
    
    Range("N7:IV10").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-5]C,"""")"
    
    Range("G7").FormulaR1C1 = "=MAX(R[-1]C[7]:R[-1]C[249])"
    Range("H7").FormulaR1C1 = "=MAX(RC[6]:RC[248])"
    Range("I7").FormulaR1C1 = "=MAX(R[1]C[5]:R[1]C[247])"
    Range("J7").FormulaR1C1 = "=MAX(R[2]C[4]:R[2]C[246])"
    Range("K7").FormulaR1C1 = "=MAX(R[3]C[3]:R[3]C[245])"
    ActiveSheet.Calculate
    Range("G7:K7").Value = Range("G7:K7").Value
    
    Range("M10:P250").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-5],"""")"
    
    Range("G8:K8").FormulaR1C1 = "=MAX(R[2]C[5]:R[252]C[5])"
    Range("G8:K8").Value = Range("G8:K8").Value
    
    Range("G7:K8").Sort Key1:=Range("G7"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Sheets("TASKS").Range("G40:K41").Value = Sheets("Sheet2").Range("G7:K8").Value
    Sheets("Sheet2").Range("A6:B7,G5:M10009,N1:IV1000").Clear

End Sub

Sub TriAlmost()
'
' 4/28/14 JLR  when 1st TRI1 is almost ORDS 123 fo AussieNoName winch
'
Application.ScreenUpdating = False
    Range("T6").FormulaR1C1 = "=IF(RC[2]<750,0.28*RC[2],0.25*RC[2])"
    Range("T6").Value = Range("T6").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(R[-4]C[-6]<R3C16,6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4]))>=R6C20),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
  If Range("G10") <> "" Then
    
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=R3C21"
    Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R4C17)+COS(RC[-6])*COS(R4C17)*COS(R4C18-RC[-5]))"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    Range("P10").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
     Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("P8") <> 0 Then
    Range("P2:T2").Value = Range("Q8:U8").Value

    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-TASKS!R[10]C[-14]<R9C4,R[-1]C,R[-1]C-((TASKS!R[8]C[-14]-TASKS!R[10]C[-14]-R9C4)*0.1))"
    Range("W6").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
    Range("U2:W6").Value = Range("U2:W6").Value
    End If
    Range("G10:O10009").Clear
    Range("T6,P8:U10009").Clear
 End If
End Sub
Sub SibTri()
'
'
' Triangle based on St Dist s/f as TPs, w/ O&R Start & Finish or NearestSF Revised 4/18/2018 to address either/or
'
    Application.ScreenUpdating = False
    Range("P8").FormulaR1C1 = "=IF(ABS(R[-6]C-RC[-15])<R[1]C[-10],R[-6]C,RC[-15])"
    Range("Q8").FormulaR1C1 = "=IF(RC[-1]=RC[-16],TASKS!R[6]C[-13],R[-6]C)"
    Range("R8").FormulaR1C1 = "=IF(RC[-2]=RC[-17],TASKS!R[6]C[-13],R[-6]C)"
    Range("S8").FormulaR1C1 = "=IF(RC[-3]=RC[-18],TASKS!R[6]C[-11],R[-6]C)"
    Range("T8").FormulaR1C1 = "=IF(RC[-4]=RC[-19],TASKS!R[6]C[-11],R[-6]C)"
    Range("U8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("P9:T10").Value = Range("P2:T3").Value
    Range("U9:U10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    ActiveSheet.Calculate
    Range("P11").FormulaR1C1 = "=IF(ABS(R[-7]C-R[-3]C[-14])<R[-2]C[-10],R[-3]C[-14],R[-7]C)"
    Range("Q11").FormulaR1C1 = "=IF(RC[-1]=R[-3]C[-15],TASKS!R[5]C[-13],R[-7]C)"
    Range("R11").FormulaR1C1 = "=IF(RC[-2]=R[-3]C[-16],TASKS!R[5]C[-13],R[-7]C)"
    Range("S11").FormulaR1C1 = "=IF(RC[-3]=R[-3]C[-17],TASKS!R[5]C[-11],Sheet2!R[-7]C)"
    Range("T11").FormulaR1C1 = "=IF(RC[-4]=R[-3]C[-19],TASKS!R[5]C[-11],R[-7]C)"
    Range("V11").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V12").FormulaR1C1 = "=IF(R[-4]C[-3]-R[-1]C[-3]<=R[-3]C[-18],R[-1]C,R[-1]C-((R[-4]C[-3]-R[-1]C[-3]-1000)*0.1))"
    Range("W12").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),""OK"","""")"
    ActiveSheet.Calculate
    Range("P8:W12").Value = Range("P8:W12").Value
    
    Sheets("Sheet2").Range("P14:T14").Value = Sheets("Tasks").Range("G40:K40").Value
    Range("P15:T16").Value = Range("P3:T4").Value
    Sheets("Sheet2").Range("P17:T17").Value = Sheets("Tasks").Range("G41:K41").Value
     
    Range("U14:U16").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("V17").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V18").FormulaR1C1 = "=IF(R[-4]C[-3]-R[-1]C[-3]<=R[-9]C[-18],R[-1]C,R[-1]C-((R[-4]C[-3]-R[-1]C[-3]-1000)*0.1))"
    Range("W18").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),""OK"","""")"
    ActiveSheet.Calculate
    Range("P14:W18").Value = Range("P14:W18").Value
    
    If Range("V12") > Range("V18") And Range("W12") = "OK" Then
      Range("A1").Value = "This is a 2-Turn Point Triangle"
      Range("A2:F5").Value = Range("P8:U11").Value
      Range("F6:F7").Value = Range("V11:V12").Value
    
    ElseIf Range("V18") > Range("V12") And Range("W18") = "OK" Then
      Range("A1").Value = "This is a 2-Turn Point Triangle"
      Range("A2:F5").Value = Range("P14:U17").Value
      Range("F6:F7").Value = Range("V17:V18").Value
    End If

    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
    Columns("G:O").Clear
    Range("P8:W18").Clear
    
    End Sub

Sub TriSFredux()
'
' Addresses TRI TP3 after O&R fini, but within 10 km
'
Application.ScreenUpdating = False
    Range("G8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(RC[-4]=R1C3,"""",IF(AND(RC[-6]>R4C1,6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4]))<10),RC[-6],""""))"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("G8") = 0 Then
        Range("G10").FormulaR1C1 = "=If(RC[-4]=R1C3,"""",IF(AND(RC[-6]>R4C1,6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4]))<20),RC[-6],""""))"
        'Copy Ref A Value Sort
        Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
        LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
    .Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    End If
    
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("G10:K509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("G10:U10009").Clear
    
    Range("N6:SS6").FormulaR1C1 = "=IF(OR(R1C="""",R3C=R[-2]C3),"""",6371*ACOS(SIN(R2C)*SIN(R4C2)+COS(R2C)*COS(R4C2)*COS(R4C3-R3C)))"
    Range("N6:SS6").Value = Range("N6:SS6").Value
    Range("L6").FormulaR1C1 = "=MIN(RC[2]:RC[501])"
    Range("M6").FormulaR1C1 = "=MAX(RC[1]:RC[500])"
    Range("L6:M6").Value = Range("L6:M6").Value
    
    Range("G10").FormulaR1C1 = "=IF(RC[-4]=R4C3,"""",IF(AND(RC[-6]<R2C1,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))>=R6C12,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))<=R6C13),RC[-6],""""))"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R4C2)+COS(RC[-4])*COS(R4C2)*COS(R4C3-RC[-3])),"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
If Range("G10") = "" Then
    Range("A1").Value = "NONE IDENTIFIED"
ElseIf Range("G10") <> "" Then
    
    'MATRIX
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,R6C<SQRT(RC12^2+0.25),R6C>R6C[1]),"""",IF(RC10-R4C<R9C4,R6C+RC12,R6C+RC12-((RC10-R4C-R9C4)*0.1))))"
    'COPY REF G
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("I5").FormulaR1C1 = "=MAX(R[5]C[5]:R[3004]C[504])"
    Range("I5").Value = Range("I5").Value
    
    Range("N10:SS10009").Value = Range("N10:SS10009").Value
    Range("N7:SS7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R5C9,R[-6]C,"""")"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C9,RC[-6],"""")"
    'Copy Ref G
     Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M10009").Value = Range("M10:M10009").Value
    
    Range("N10:SS10009").Clear
    
    Range("N8:SS8").FormulaR1C1 = "=IF(R1C="""","""",IF(R[-1]C=R1C,R[-6]C,""""))"
    Range("N9:SS11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    
    Range("A5").FormulaR1C1 = "=MAX(R[2]C[13]:R[2]C[512])"
    Range("B5").FormulaR1C1 = "=MAX(R[3]C[12]:R[3]C[511])"
    Range("C5").FormulaR1C1 = "=MAX(R[4]C[11]:R[4]C[510])"
    Range("D5").FormulaR1C1 = "=MAX(R[5]C[10]:R[5]C[509])"
    Range("E5").FormulaR1C1 = "=MAX(R[6]C[9]:R[6]C[508])"
    Range("A5:E5").Value = Range("A5:E5").Value
    
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy REF G
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("A1:E1").FormulaR1C1 = "=MAX(R[9]C[12]:R[10008]C[12])"
    Range("A1:E1").Value = Range("A1:E1").Value
End If
    Columns("G:SS").Clear
End Sub
Sub ReCK()
'
' ReCK Macro for 3 ORDS only!
'
    'ReCK TP2
    Columns("G:N").Clear
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R2C16,RC[-6]<R4C16),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L8:Q8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))+6371*ACOS(SIN(RC[-4])*SIN(R4C17)+COS(RC[-4])*COS(R4C17)*COS(R4C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]=R8C12,RC[-6],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:Q10").AutoFill Destination:=.Range("L10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-6]C[-1])+COS(RC[-4])*COS(R[-6]C[-1])*COS(R[-6]C-RC[-3]))"
    Range("S8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[-4]C[-2])+COS(RC[-5])*COS(R[-4]C[-2])*COS(R[-4]C[-1]-RC[-4]))"
    Range("T8").FormulaR1C1 = "=SUM(RC[-8],R[-4]C[1])"
    Range("U8").FormulaR1C1 = "=IF(RC[-1]<750,0.28*RC[-1],0.25*RC[-1])"
    Range("V8").FormulaR1C1 = "=IF(RC[-2]>=750,0.25*RC[-2],RC[-2])"
    Range("W8").FormulaR1C1 = "=IF(AND(RC[-11]>=RC[-2],RC[-11]<=RC[-1]),""OK"","""")"
    Range("X8").FormulaR1C1 = "=IF(MIN(RC[-6],RC[-5],R[-4]C[-3])>=RC[-3],""OK"",""NOPE"")"
    ActiveSheet.Calculate
  If Range("X8") = "OK" Then
    Range("P3:T3").Value = Range("M8:Q8").Value

    Range("U2:U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("U4").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
  End If
  
    'Re-CK TP3
    Range("A7").Value = 1.38888888888889E-03
    Range("G10:Q10009").Clear
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R4C16-R7C1,RC[-6]<=R4C16+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L10").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))+6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]=R8C12,RC[-6],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:Q10").AutoFill Destination:=.Range("L10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R8").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-6]C[-1])+COS(RC[-4])*COS(R[-6]C[-1])*COS(R[-6]C-RC[-3]))"
    Range("S8").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-5])*SIN(R[-5]C[-2])+COS(RC[-5])*COS(R[-5]C[-2])*COS(R[-5]C[-1]-RC[-4]))"
    Range("T8").FormulaR1C1 = "=SUM(RC[-8],R[-6]C[1])"
    Range("U8").FormulaR1C1 = "=IF(RC[-1]<750,0.28*RC[-1],0.25*RC[-1])"
    Range("V8").FormulaR1C1 = "=IF(RC[-2]>=750,0.25*RC[-2],RC[-2])"
    Range("W8").FormulaR1C1 = _
        "=IF(AND(RC[-11]>=RC[-2],RC[-11]<=RC[-1]),""OK"","""")"
    Range("X8").FormulaR1C1 = _
        "=IF(MIN(RC[-6],RC[-5],R[-6]C[-3])>=RC[-3],""OK"",""NOPE"")"

  If Range("X8") = "OK" Then
    Range("P4:T4").Value = Range("M8:Q8").Value
    Range("U2:U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("U4").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
  End If
  
  'Re-CK TP1
  Range("G10:Q10009").Clear
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R2C16-R7C1,RC[-6]<=R2C16+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L10").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R4C17)+COS(RC[-4])*COS(R4C17)*COS(R4C18-RC[-3]))+6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]=R8C12,RC[-6],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:Q10").AutoFill Destination:=.Range("L10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-5]C[-1])+COS(RC[-4])*COS(R[-5]C[-1])*COS(R[-5]C-RC[-3]))"
    Range("S8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[-4]C[-2])+COS(RC[-5])*COS(R[-4]C[-2])*COS(R[-4]C[-1]-RC[-4]))"
    Range("T8").FormulaR1C1 = "=SUM(RC[-8],R[-5]C[1])"
    Range("U8").FormulaR1C1 = "=IF(RC[-1]<750,0.28*RC[-1],0.25*RC[-1])"
    Range("V8").FormulaR1C1 = "=IF(RC[-2]>=750,0.25*RC[-2],RC[-2])"
    Range("W8").FormulaR1C1 = "=IF(AND(RC[-11]>=RC[-2],RC[-11]<=RC[-1]),""OK"","""")"
    Range("X8").FormulaR1C1 = "=IF(MIN(RC[-6],RC[-5],R[-5]C[-3])>=RC[-3],""OK"",""NOPE"")"
    
  If Range("X8") = "OK" Then
    Range("P2:T2").Value = Range("M8:Q8").Value
    Range("U2:U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("U4").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
    Range("S8:X8,G8:R10009").Clear
    Range("U2:X6").Value = Range("U2:X6").Value
  End If
  
End Sub
Sub TriOrds()
'
' Works for Leonard,Mueller, Ramy06 w/macro noted
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("A1:E4").Value = Sheets("Tasks").Range("A40:E44").Value
    Range("F1").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("G2").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[1]C[-5])+COS(RC[-5])*COS(R[1]C[-5])*COS(R[1]C[-4]-RC[-4]))"
    Range("H3").FormulaR1C1 = "=6371*ACOS(SIN(R[-2]C[-6])*SIN(RC[-6])+COS(R[-2]C[-6])*COS(RC[-6])*COS(RC[-5]-R[-2]C[-5]))"
    Range("H4").FormulaR1C1 = "=6371*ACOS(SIN(R[-2]C[-6])*SIN(RC[-6])+COS(R[-2]C[-6])*COS(RC[-6])*COS(RC[-5]-R[-2]C[-5]))"
    Range("H5").FormulaR1C1 = "=6371*ACOS(SIN(R[-2]C[-6])*SIN(R[-1]C[-6])+COS(R[-2]C[-6])*COS(R[-1]C[-6])*COS(R[-1]C[-5]-R[-2]C[-5]))"
    Range("J4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-8])*SIN(R[-3]C[-8])+COS(RC[-8])*COS(R[-3]C[-8])*COS(R[-3]C[-7]-RC[-7]))"
    Range("L1").FormulaR1C1 = "=RC[-6]+R[1]C[-5]+R[2]C[-4]"
    Range("M1").FormulaR1C1 = "=IF(OR(AND(RC[-1]>=750,MIN(RC[-7],R[1]C[-6],R[2]C[-5])>=0.25*RC[-1],MAX(RC[-7],R[1]C[-6],R[2]C[-5])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(RC[-7],R[1]C[-6],R[2]C[-5])>=0.28*RC[-1])),""OK"",""NOPE"")"
    Range("L2").FormulaR1C1 = "=R[-1]C[-6]+R[2]C[-4]+R[2]C[-2]"
    Range("M2").FormulaR1C1 = "=IF(OR(AND(RC[-1]>=750,MIN(R[-1]C[-7],R[2]C[-5],R[2]C[-3])>=0.25*RC[-1],MAX(R[-1]C[-7],R[2]C[-5],R[2]C[-3])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-1]C[-7],R[2]C[-5],R[2]C[-3])>=0.28*RC[-1])),""OK"",""NOPE"")"
    Range("L3").FormulaR1C1 = "=RC[-4]+R[2]C[-4]+R[1]C[-2]"
    Range("M3").FormulaR1C1 = "=IF(OR(AND(RC[-1]>=750,MIN(RC[-5],R[2]C[-5],R[1]C[-3])>=0.25*RC[-1],MAX(RC[-5],R[2]C[-5],R[1]C[-3])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(RC[-5],R[2]C[-5],R[1]C[-3])>=0.28*RC[-1])),""OK"",""NOPE"")"
    Range("L4").FormulaR1C1 = "=R[-2]C[-5]+R[1]C[-4]+RC[-4]"
    Range("M4").FormulaR1C1 = "=IF(OR(AND(RC[-1]>=750,MIN(R[-2]C[-6],R[1]C[-5],RC[-3])>=0.25*RC[-1],MAX(R[-2]C[-6],R[1]C[-5],RC[-3])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-2]C[-6],R[1]C[-5],RC[-3])>=0.28*RC[-1])),""OK"",""NOPE"")"
    Range("N1:N4").FormulaR1C1 = "=IF(RC[-1]=""OK"",RC[-2],"""")"
    Range("N5").FormulaR1C1 = "=IF(SUM(R[-4]C:R[-1]C)=0,""NOPE"",IF(R[-4]C=MAX(R[-4]C:R[-1]C),123,IF(R[-3]C=MAX(R[-4]C:R[-1]C),124,IF(R[-2]C=MAX(R[-4]C:R[-1]C),134,IF(R[-1]C=MAX(R[-4]C:R[-1]C),234)))))"
    ActiveSheet.Calculate
    If Range("N5") = 123 Then
        Range("P2:T4").Value = Range("A1:E3").Value
    ElseIf Range("N5") = 124 Then
        Range("P2:T3").Value = Range("A1:E2").Value
        Range("P4:T4").Value = Range("A4:E4").Value
    ElseIf Range("N5") = 134 Then
        Range("P2:T2").Value = Range("A1:E1").Value
        Range("P3:T4").Value = Range("A3:E4").Value
    ElseIf Range("N5") = 234 Then
        Range("P2:T4").Value = Range("A2:E4").Value
    ElseIf Range("N5") = "NOPE" Then
    'Find longest possible triangle based on shortest leg/applicable FAI minimum
        '123 tri
        Range("O1").FormulaR1C1 = "=IF(RC[-3]<750,MIN(RC[-9],R[1]C[-8],R[2]C[-7])/0.28,MIN(RC[-9],R[1]C[-8],R[2]C[-7])/0.25)"
        '124 tri
        Range("O2").FormulaR1C1 = "=IF(RC[-3]<750,MIN(R[-1]C[-9],R[2]C[-7],R[2]C[-5])/0.28,MIN(R[-1]C[-9],R[2]C[-7],R[2]C[-5])/0.25)"
        '134 tri
        Range("O3").FormulaR1C1 = "=IF(RC[-3]<750,MIN(RC[-7],R[2]C[-7],R[1]C[-5])/0.28,MIN(RC[-7],R[2]C[-7],R[1]C[-5])/0.25)"
        '234 tri
        Range("O4").FormulaR1C1 = "=IF(RC[-3]<750,MIN(R[-2]C[-8],RC[-7],R[1]C[-7])/0.28,MIN(R[-2]C[-8],RC[-7],R[1]C[-7])/0.25)"
        Range("O1:O4").Value = Range("O1:O4").Value
        'Branch here for Tri2 vs TriOFC2, followed if needed by TriONE; amended for 300k limit end 10/1/14
      If Range("O1") = Range("O2") And Range("O3") = Range("O4") Then
        Application.Run "F.xlsm!Tri2Ords"
      ElseIf Range("O1") = Range("O2") And Range("O1") > Range("O3") And Range("O1") > Range("O4") And Range("O1") < 300 Then
        Application.Run "F.xlsm!Tri2TP"
      ElseIf Range("O1") = Range("O4") And Range("O2") = Range("O3") Then
        Application.Run "F.xlsm!Tri2Ordsb"
      ElseIf Range("O1") <> Range("O2") Or Range("O3") <> Range("O4") Then
        'HERE?
        Application.Run "F.xlsm!TriONEord"
      End If
    End If
    
    If Range("N5") <> "NOPE" And Range("N5") <> "" Then
        Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
        Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
        Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
        Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
        Range("W6").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
        Application.Run "F.xlsm!ReCK"
    End If
    
    If Range("W6") = "OK" And Range("P1") <> "This is a 2-Turn Point Triangle" And Range("P2") < Range("A8") Then
        Application.Run "F.xlsm!Ramy06"
    End If
    
    If Range("W6") = "OK" And Range("V6") > Range("F7") Then
        Range("A1:E5").Value = Range("P1:T5").Value
        Range("F2:F4").Value = Range("U2:U4").Value
        Range("F6:F7").Value = Range("V5:V6").Value
    End If
    Range("F1,G1:W6").Clear
End Sub
Sub Tri2tp()
'
' Tri2tp Macro Antares 2-TP triangle using longest leg Ords 1/2; shortest leg Ords 2/3
'
    'If Range("O1") = Range("O2") And Range("O1") > Range("O3") And Range("O1") > Range("O4") And Range("O1") < 300 Then
    Range("P1").Value = "This is a 2-Turn Point Triangle"
    Range("P2:U3").Cut Destination:=Range("P3:U4")
    Sheets("Sheet2").Range("P2:R2").Value = Sheets("TASKS").Range("C14:E14").Value
    Sheets("Sheet2").Range("S2:T2").Value = Sheets("TASKS").Range("H14:I14").Value
    Sheets("Sheet2").Range("P5:R5").Value = Sheets("TASKS").Range("C16:E16").Value
    Sheets("Sheet2").Range("S5:T5").Value = Sheets("TASKS").Range("H16:I16").Value
    
    Range("T6").Clear
    Range("U2:U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
   
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("W6").FormulaR1C1 = "=IF(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>0.28*RC[-1]),""OK"","""")"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R5C16,RC[-6]>R4C16),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("L10").FormulaR1C1 = "=R2C21"
    Range("M10").FormulaR1C1 = "=IF(RC[-4]<>R3C18,6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4])),"""")"
    Range("N10").FormulaR1C1 = "=IF(RC[-5]<>R5C18,6371*ACOS(SIN(RC[-6])*SIN(R5C17)+COS(RC[-6])*COS(R5C17)*COS(R5C18-RC[-5])),"""")"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    Range("P10").FormulaR1C1 = "=IF(MIN(RC[-4]:RC[-2])>=0.28*RC[-1],RC[-1],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    'Copy Ref G
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("Q8") <> 0 Then
        Range("P4:T4").Value = Range("Q8:U8").Value
    End If
    
    If Range("Q8") = 0 Or Range("W6") <> "OK" Then
        Sheets("Sheet2").Range("P2:T2").Value = Sheets("TASKS").Range("G40:K40").Value
        Sheets("Sheet2").Range("P5:T5").Value = Sheets("TASKS").Range("G41:K41").Value
        If Range("Q8") <> 0 Then
             Range("P4:T4").Value = Range("Q8:U8").Value
        End If
    End If

 Range("G8:U10009").Clear
End Sub

Sub Tri2Ords()
'
' Tri2Ords Macro works for Payne 09 NO reCK
'
    Range("A7").Value = 1.38888888888889E-03
    
    'IF cks ORDS 3 & 4, ElseIf cks ORDS 1 & 2
    
    If Range("O4") = Range("O3") And Range("O3") > Range("O2") Then
        Range("P2:T3").Value = Range("A3:E4").Value
    ElseIf Range("O1") = Range("O2") And Range("O2") > Range("O3") Then
        Range("P2:T3").Value = Range("A1:E2").Value
    End If
    
    Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("L8:Q8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R2C16-R7C1,RC[-6]<=R2C16+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R3C17)+COS(RC[-10])*COS(R3C17)*COS(R3C18-RC[-9])),"""")"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]=R8C12,RC[-6],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:Q10").AutoFill Destination:=.Range("G10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("L8") > Range("U2") Then
    Range("P2:T2").Value = Range("M8:Q8").Value
  End If
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R3C16-R7C1,RC[-6]<=R3C16+R7C1),RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R2C17)+COS(RC[-10])*COS(R2C17)*COS(R2C18-RC[-9])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("L8") > Range("U2") Then
    Range("P3:T3").Value = Range("M8:Q8").Value
  End If
    Range("G8:Q10009").Clear
 
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R3C16,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
     With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
If Range("G10") = "" Then
    Exit Sub
ElseIf Range("G10") <> "" Then
    Range("O8:T8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R2C21)"
    Range("O10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-3],RC[-2],R2C21)>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-3],RC[-2],R2C21)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R2C21)<=0.45*RC[-1])),RC[-1],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]=R8C15,RC[-9],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:T10").AutoFill Destination:=.Range("L10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P4:T4").Value = Range("P8:T8").Value
        
    Range("U2:U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1])),""OK"","""")"

 If Range("W6") <> "" Then
        Application.Run "F.xlsm!TriGEO"
 End If

    If Range("W6") = "OK" Then
        Range("L1:O5").Value = Range("L1:O5").Value
        Range("G10:N10009").Clear
        Range("A2:F4").Value = Range("P2:U4").Value
        Range("F6:F7").Value = Range("V5:V6").Value
        Range("E6").Value = Range("X6").Value
        Range("F1,A7:B8").Clear

        Sheets("Sheet2").Range("A1:C1").Value = Sheets("TASKS").Range("C14:E14").Value
        Sheets("Sheet2").Range("E1:D1").Value = Sheets("TASKS").Range("H14:I14").Value
        Sheets("Sheet2").Range("A5:C5").Value = Sheets("TASKS").Range("C16:E16").Value
        Sheets("Sheet2").Range("D5:E5").Value = Sheets("TASKS").Range("H16:I16").Value
    End If
    
    If Range("O3") = Range("O4") And Range("O3") > Range("O2") Then
        Application.Run "F.xlsm!Tri2Ordsa"
    ElseIf Range("O1") > Range("O2") And Range("O2") > Range("O3") And Range("O3") <= Range("O4") Then
        Application.Run "F.xlsm!TriONEord"
    End If
    
        
End If
End Sub
Sub TriGEO()
'
' SOMETHING Macro
'
Application.ScreenUpdating = False
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("Q2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("R2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("Q3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("R3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W2").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("Q4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("R4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W3").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("Q2").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("R2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W4").Value = Sheets("YDWK3").Range("F37").Value
    
    Range("X5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("X6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-16]-MAX(TASKS!R[10]C[-16],TASKS!R[11]C[-16])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-16]-MAX(TASKS!R[10]C[-16],TASKS!R[11]C[-16])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("Y6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1])),""OK"","""")"
    
  If Range("Y6") = "" Then
    
    Range("H6").FormulaR1C1 = _
        "=IF(AND(RC[17]="""",OR(AND(RC[16]<750,MIN(R[-4]C[15]:R[-2]C[15])<0.28*RC[16]),AND(RC[16]>=750,MIN(R[-4]C[15]:R[-2]C[15])<0.25*RC[16]))),MIN(R[-4]C[13]:R[-2]C[13])-MIN(R[-4]C[15]:R[-2]C[15]),"""")"
    Range("H7").FormulaR1C1 = _
        "=IF(AND(R[-1]C<>"""",R[-5]C[15]=MAX(R[-5]C[15]:R[-3]C[15])),R[-5]C[8],IF(AND(R[-1]C<>"""",R[-4]C[15]=MAX(R[-5]C[15]:R[-3]C[15])),R[-4]C[8],IF(AND(R[-1]C<>"""",R[-3]C[15]=MAX(R[-5]C[15]:R[-3]C[15])),R[-3]C[8],"""")))"
    Range("H8").FormulaR1C1 = "=IF(R[-2]C<>"""",R[-2]C[16]/R[-2]C[14],"""")"
    
    Range("H6:H8").Value = Range("H6:H8").Value
    
    Range("A7").Value = 2.08333333333333E-03
    Range("G10").FormulaR1C1 = _
        "=IF(OR(AND(R7C8=R4C16,RC[-6]>=R4C16-R7C1,RC[-6]<=R4C16+R7C1),AND(R7C8=R3C16,RC[-6]>=R3C16-R7C1,RC[-6]<=R3C16+R7C1),AND(R7C8=R2C16,RC[-6]>=R2C16-R7C1,RC[-6]<=R2C16+R7C1)),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
   
    If Range("H7") = Range("P4") Then
        Range("L10").FormulaR1C1 = "=R2C21"
        Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4]))"
        Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R2C17)+COS(RC[-6])*COS(R2C17)*COS(R2C18-RC[-5]))"
        Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
        Range("P10").FormulaR1C1 = "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*R8C8*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*R8C8*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*R8C8*RC[-1])),R8C8*RC[-1],"""")"
    'ElseIf(s) for H7 = P3, H7=P2
    End If
    
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("H7") = Range("P4") Then
        Range("P4:T4").Value = Range("Q8:U8").Value
    ElseIf Range("H7") = Range("P3") Then
        Range("P3:T3").Value = Range("Q8:U8").Value
    ElseIf Range("H7") = Range("P2") Then
        Range("P2:T2").Value = Range("Q8:U8").Value
    End If
  
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("Q2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("R2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("Q3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("R3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W2").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet2").Range("Q4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet2").Range("R4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W3").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet2").Range("Q2").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet2").Range("R2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("W4").Value = Sheets("YDWK3").Range("F37").Value
    
    Range("X5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("X6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-16]-MAX(TASKS!R[10]C[-16],TASKS!R[11]C[-16])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-16]-MAX(TASKS!R[10]C[-16],TASKS!R[11]C[-16])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("Y6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1])),""OK"","""")"
 End If
 
 If Range("Y6") = "" Then
    Range("G6:U10009").Clear
    
    Range("A7").FormulaR1C1 = "=MAX(TASKS!R[9]C[2],TASKS!R[10]C[2])"
    Range("A7").Value = Range("A7").Value
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R3C16,RC[-6]<R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
If Range("G10") = "" Then
    Exit Sub
ElseIf Range("G10") <> "" Then
    Range("O8:T8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R2C21)"
    Range("O10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-3],RC[-2],R2C21)>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-3],RC[-2],R2C21)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R2C21)<=0.45*RC[-1])),RC[-1],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]=R8C15,RC[-9],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:T10").AutoFill Destination:=.Range("L10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P4:T4").Value = Range("P8:T8").Value
        
    Range("U2:U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[1]C[-4])*SIN(RC[-4])+COS(R[1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[1]C[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1]),AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1])),""OK"","""")"

    If Range("W6") = "OK" Then
        Range("L1:O5").Value = Range("L1:O5").Value
        Range("G10:N10009").Clear
        Range("A2:F4").Value = Range("P2:U4").Value
        Range("F6:F7").Value = Range("V5:V6").Value
        Range("E6").Value = Range("W6").Value
        Range("F1,A7:B8,P2:X7").Clear

        Sheets("Sheet2").Range("A1:C1").Value = Sheets("TASKS").Range("C14:E14").Value
        Sheets("Sheet2").Range("E1:D1").Value = Sheets("TASKS").Range("H14:I14").Value
        Sheets("Sheet2").Range("A5:C5").Value = Sheets("TASKS").Range("C16:E16").Value
        Sheets("Sheet2").Range("D5:E5").Value = Sheets("TASKS").Range("H16:I16").Value
    End If
  End If
 End If
 
End Sub
Sub Tri2Ordsa()
'
' double-checks ORDS 3/4 after Tri2Ords
'
    Sheets("Sheet2").Range("A8").Value = Sheets("TASKS").Range("C14").Value
    Sheets("Sheet2").Range("B8").Value = Sheets("TASKS").Range("C16").Value
    Range("P3:T4").Value = Range("A2:E3").Value
    Range("U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R3C16,RC[-6]>=R8C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
  If Range("G10") <> "" Then
    
    Range("N8:S8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4]))"
    Range("N10").FormulaR1C1 = _
        "=IF(OR(AND(SUM(RC[-2],RC[-1],R3C21)<750,MIN(RC[-2],RC[-1],R3C21)>=0.28*SUM(RC[-2],RC[-1],R3C21)),AND(SUM(RC[-2],RC[-1],R3C21)>=750,MIN(RC[-2],RC[-1],R3C21)>=0.25*SUM(RC[-2],RC[-1],R3C21),MAX(RC[-2],RC[-1],R3C21)<=0.45*SUM(RC[-2],RC[-1],R3C21))),SUM(RC[-2],RC[-1],R3C21),"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]=R8C14,RC[-8],"""")"
    Range("P10:S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-8],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:S10").AutoFill Destination:=.Range("L10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").Value = Range("O8:S8").Value
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,Sheet2!R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),Sheet2!R[-1]C)"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R2C16,RC[-6]<R4C16),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=IF(OR(AND(SUM(RC[-2],RC[-1],R4C21)<750,MIN(RC[-2],RC[-1],R4C21)>=0.28*SUM(RC[-2],RC[-1],R4C21)),AND(SUM(RC[-2],RC[-1],R4C21)>=750,MIN(RC[-2],RC[-1],R4C21)>=0.25*SUM(RC[-2],RC[-1],R4C21),MAX(RC[-2],RC[-1],R4C21)<=0.45*SUM(RC[-2],RC[-1],R4C21))),SUM(RC[-2],RC[-1],R4C21),"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:S10").AutoFill Destination:=.Range("L10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("N8") > Range("V6") Then
    Range("P3:T3").Value = Range("O8:S8").Value
  End If
    
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R4C16,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4]))"
    Range("N10").FormulaR1C1 = _
        "=IF(OR(AND(SUM(RC[-2],RC[-1],R2C21)<750,MIN(RC[-2],RC[-1],R2C21)>=0.28*SUM(RC[-2],RC[-1],R2C21)),AND(SUM(RC[-2],RC[-1],R2C21)>=750,MIN(RC[-2],RC[-1],R2C21)>=0.25*SUM(RC[-2],RC[-1],R2C21),MAX(RC[-2],RC[-1],R2C21)<=0.45*SUM(RC[-2],RC[-1],R2C21))),SUM(RC[-2],RC[-1],R2C21),"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:S10").AutoFill Destination:=.Range("L10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("N8") > Range("V6") Then
    Range("P4:T4").Value = Range("O8:S8").Value
  End If
    
  If Range("V6") > Range("F7") Then
    Range("A2:F4").Value = Range("P2:U4").Value
    Range("F6:F7").Value = Range("V5:V6").Value
  End If
  End If
Columns("G:W").Clear
End Sub
Sub Tri2Ordsb()
'
' Cks for Ords 2&3 LEWIS, future expansion for 1&4
'
Application.ScreenUpdating = False
'Check 1&4 as two Ords (If W4<V4, 1&4 not possible)
    Range("V4").FormulaR1C1 = "=R[-2]C[-7]*0.28"
    Range("W4").FormulaR1C1 = "=R[-2]C[-8]-(RC[-2]+RC[-1])"
 If Range("W4") < Range("V4") Then
 'Check 2&3 as two Ords
    Range("P3:T3").Value = Range("A3:E3").Value
    Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("V2").FormulaR1C1 = "=RC[-1]/0.28"
 'ElseIf (future?)for Ords 1 & 4
 End If
    'Determine 2 vs 3 TP
If Range("V2") < 300 Then
    Range("A7").Value = 1.04166666666667E-02
    'START CANDIDATES for a 2-TP Triangle
    Range("G10").FormulaR1C1 = "=IF(RC[-6]<R2C16,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'CopyRef A Value SORT
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
  If Range("G10") = "" Then
    Application.Run "F.xlsm!TriONEord"
  ElseIf Range("G10") <> "" Then
  
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=R2C21"
    Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R3C17)+COS(RC[-6])*COS(R3C17)*COS(R3C18-RC[-5]))"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    Range("P10").FormulaR1C1 = "=IF(AND(RC[-9]>=R8C1-R7C1,RC[-9]<=R8C1+R7C1,OR(AND(RC[-1]<=750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1]))),RC[-1],"""")"
    Range("Q10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref K Value
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "K").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P10:U10009").Value = Range("P10:U10009").Value
    Range("P10:U10009").Sort Key1:=Range("Q10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    If Range("P10") = "" Then
        Range("A1").Value = "NONE IDENTIFIED"
        Exit Sub
    End If
    Range("G10:O10009").Clear
    
    Range("V10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("W10").FormulaR1C1 = "=IF(RC[-7]>100,R9C4,IF(R9C5<>""PR"",10*RC[-7],10*RC[-7]-100))"
    'Copy Ref U VALUE
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "U").End(xlUp).Row
.Range("V10:W10").AutoFill Destination:=.Range("V10:W" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("V10:W10009").Value = Range("V10:W10009").Value
    Range("V7").FormulaR1C1 = "=MIN(R[3]C:R[10002]C)"
    Range("V8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    'FINISH CANDIDATES
    Range("Y10").FormulaR1C1 = _
        "=IF(AND(RC[-24]>R3C16,6371*ACOS(SIN(RC[-23])*SIN(R3C17)+COS(RC[-23])*COS(R3C17)*COS(R3C18-RC[-22]))>R7C22,6371*ACOS(SIN(RC[-23])*SIN(R3C17)+COS(RC[-23])*COS(R3C17)*COS(R3C18-RC[-22]))<R8C22),RC[-24],"""")"
    Range("Z10:AC10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-24],"""")"
    Range("AD10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("Y10:AD10").AutoFill Destination:=.Range("Y10:AD" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Y10:AD10009").Value = Range("Y10:AD10009").Value
    Range("Y10:AD10009").Sort Key1:=Range("Y10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    If Range("Y510") <> "" Then
        Range("G10:L509").Value = Range("Y510:AD1009").Value
        Range("Y510:AD1009").Clear
    End If
    
    Range("Y10:AD509").Copy
    Range("Y1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("Y10:AD10009").Clear
    
    'MATRIX
    Range("Y10:TD10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC19=R3C),"""",IF(OR(R6C<RC22,6371*ACOS(SIN(RC18)*SIN(R2C)+COS(RC18)*COS(R2C)*COS(R3C-RC19))>0.5,R6C>SQRT(RC22^2+0.25)),"""",IF(RC20-R4C<=RC23,RC16+R6C,IF(AND(RC16>100,RC20-R4C>RC23),RC16+R6C-((RC20-R4C-RC23)*0.1),0))))"
    'Copy Ref P
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "P").End(xlUp).Row
.Range("Y10:TD10").AutoFill Destination:=.Range("Y10:TD" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Y10:TD3000").Value = Range("Y10:TD3000").Value
    Range("T5").FormulaR1C1 = "=MAX(R[5]C[5]:R[2995]C[504])"
    Range("T5").Value = Range("T5").Value

    If Range("T5") = 0 Then
        Columns("Y:TD").Clear
        Range("G10:L509").Copy
        Range("Y1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        'MATRIX
        Range("Y10:TD10").FormulaR1C1 = _
            "=IF(OR(R1C="""",RC19=R3C),"""",IF(OR(R6C<RC22,6371*ACOS(SIN(RC18)*SIN(R2C)+COS(RC18)*COS(R2C)*COS(R3C-RC19))>0.5,R6C>SQRT(RC22^2+0.25)),"""",IF(RC20-R4C<=RC23,RC16+R6C,IF(AND(RC16>100,RC20-R4C>RC23),RC16+R6C-((RC20-R4C-RC23)*0.1),0))))"
         'Copy Ref P
        With Worksheets("Sheet2")
        LastRow = .Cells(Rows.Count, "P").End(xlUp).Row
    .Range("Y10:TD10").AutoFill Destination:=.Range("Y10:TD" & LastRow), Type:=xlFillDefault
        End With
        ActiveSheet.Calculate
        'If T5 0 again, clear Columns N:TD, go None Identified
    End If
    
    Range("Y10:TD3000").Value = Range("Y10:TD3000").Value
    Range("T5").FormulaR1C1 = "=MAX(R[5]C[5]:R[2995]C[504])"
    Range("T5").Value = Range("T5").Value
    
    Range("Y7:TD7").FormulaR1C1 = "=IF(MAX(R[3]C:R[2993]C)=R5C20,R[-6]C,"""")"
    Range("Y7:TD7").Value = Range("Y7:TD7").Value

    Range("X10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C20,RC[-7],"""")"
    'Copy Ref W
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "W").End(xlUp).Row
.Range("X10:X10").AutoFill Destination:=.Range("X10:X" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("X10:X3000").Value = Range("X10:X3000").Value
    
    Range("P4:T4").Value = Range("P3:T3").Value
    Range("P3:T3").Value = Range("P2:T2").Value
    Range("P1").Value = "This is a 2-Turn Point Triangle"
    
    Range("Y10:AD10009").Clear
    Range("Y10:AB10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref X
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "X").End(xlUp).Row
.Range("Y10:AB10").AutoFill Destination:=.Range("Y10:AB" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").FormulaR1C1 = "=MAX(R[8]C[8]:R[10007]C[8])"
    Range("P2:T2").Value = Range("P2:T2").Value
    
    Range("Y8:TD8").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    Range("Y9:TD9").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    Range("Y10:TD10").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    Range("Y11:TD11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    
    Range("P5").FormulaR1C1 = "=MAX(R[2]C[9]:R[2]C[508])"
    Range("Q5").FormulaR1C1 = "=MAX(R[3]C[8]:R[3]C[507])"
    Range("R5").FormulaR1C1 = "=MAX(R[4]C[7]:R[4]C[506])"
    Range("S5").FormulaR1C1 = "=MAX(R[5]C[6]:R[5]C[505])"
    Range("T5").FormulaR1C1 = "=MAX(R[6]C[5]:R[6]C[504])"
    
    Range("P5:T5").Value = Range("P5:T5").Value
    
    Range("U2:U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(OR(AND(R[-1]C>100,R[-4]C[-3]-R[-1]C[-3]<=R9C4),AND(R[-1]C<=100,R9C5<>""PR"",R[-4]C[-3]-R[-1]C[-3]<=10*R[-1]C),AND(R[-1]C<=100,R[-4]C[-3]-R[-1]C[-3]<=10*R[-1]C-100)),R[-1]C,IF(AND(R[-1]C>100,R[-4]C[-3]-R[-1]C[-3]>R9C4),R[-1]C-((R[-4]C[-3]-R[-1]C[-3]-R9C4)*0.1),0))"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"",""NOPE"")"
    Columns("Y:TD").Clear
  End If
ElseIf Range("V2") >= 300 Then
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R3C16,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
  If Range("G10") = "" Then
    Application.Run "F.xlsm!TriONEord"
  ElseIf Range("G10") <> "" Then
  
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=R2C21"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    'Copy Ref G Value
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:O10").AutoFill Destination:=.Range("L10:O" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:O10009").Value = Range("L10:O10009").Value
    
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("P10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("P10:U10").AutoFill Destination:=.Range("P10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P4:T4").Value = Range("Q8:U8").Value
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14]:R[11]C[-14])<R9C4,R[-1]C,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14]:R[11]C[-14])-R9C4)*0.1))"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
   End If
End If
 Range("G7:W10009").Clear

End Sub
Sub TriONEord()
'
'Revised 3/21/14 First Part uses OFC as basis for TP 2
'
Application.ScreenUpdating = False
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R4C16,RC[-6]<R8C2),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
If Range("G10") <> "" Then
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R4C17)+COS(RC[-4])*COS(R4C17)*COS(R4C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4]))"
    Range("N10").FormulaR1C1 = "=R3C[7]"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3],RC[-2],RC[-1])"
    Range("P10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("P8") = 0 Then
    Range("G8:U10009").Clear
    Application.Run "F.xlsm!Triangle2"
    
  ElseIf Range("P8") <> 0 Then
    Range("P8:U8").Value = Range("P8:U8").Value
    Range("G10:U10009").Clear
    Range("V7").FormulaR1C1 = "=6371*ACOS(SIN(R[-4]C[-5])*SIN(R[-3]C[-5])+COS(R[-4]C[-5])*COS(R[-3]C[-5])*COS(R[-3]C[-4]-R[-4]C[-4]))"
    Range("V8").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R4C17)+COS(RC[-4])*COS(R4C17)*COS(R4C18-RC[-3]))"
    Range("V9").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(R[-6]C[-5])+COS(R[-1]C[-4])*COS(R[-6]C[-5])*COS(R[-6]C[-4]-R[-1]C[-3]))"
    Range("V10").FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
    Range("V11").FormulaR1C1 = "=IF(Tasks!R[3]C[-14]-Tasks!R[6]C[-14]<R9C4,R[-1]C,R[-1]C-((Tasks!R[3]C[-14]-Tasks!R[6]C[-14]-R9C4)*0.1))"
    Range("W11").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-1]:R[-2]C[-1])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-1]:R[-2]C[-1])>=0.25*R[-4]C[-1],MAX(R[-4]C[-1]:R[-2]C[-1])<=0.45*R[-4]C[-1])),""OK"","""")"
    ActiveSheet.Calculate
    Range("V7:W11").Value = Range("V7:W11").Value
    
    If Range("W11") = "OK" Then
        Range("U2:W6").Clear
        Range("P2:T2").Value = Range("P3:T3").Value
        Range("P3:T3").Value = Range("P4:T4").Value
        Range("P4:T4").Value = Range("Q8:U8").Value
        Range("U2:U4").Value = Range("V7:V9").Value
        Range("V5:W6").Value = Range("V10:W11").Value
    End If
    Range("G7:W10009").Clear
  End If
 
 If Range("W6") <> "OK" Then
    'Check base Triangle1 TP1&3 +/-15 Mins, with TP2 at ORD2 (works for Keene)EG: O1= MAX(O1:O4)
    Range("A7").Value = 1.04166666666667E-02
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R2C16-R7C1,RC[-6]<=R2C16+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N10").FormulaR1C1 = "=IF(AND(RC[-13]>=R4C16-R7C1,RC[-13]<=R4C16+R7C1),RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("S10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:S10").AutoFill Destination:=.Range("N10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:S10009").Value = Range("N10:S10009").Value
    Range("N10:S10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N10:S500").Copy
    Range("Z1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("N10:S10009").Clear
   'Matrix
    Range("Z10:TE10").FormulaR1C1 = _
        "=IF(OR(AND(RC12+R6C+6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))<750,MIN(RC12,R6C,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C)))>=0.28*(RC12+R6C+6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C)))),AND(RC12+R6C+6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>=750,MIN(RC12,R6C,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C)))>=0.25*(RC12+R6C+6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))),MAX(RC12,R6C,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C)))<=0.45*(RC12+R6C+6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))))),SUM(RC12,R6C,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))),"""")"
    'COPY ref G Value
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("Z10:TE10").AutoFill Destination:=.Range("Z10:TE" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Z10:TE10009").Value = Range("Z10:TE10009").Value
    
    Range("X5").FormulaR1C1 = "=MAX(R[5]C[2]:R[495]C[501])"
    Range("X5").Value = Range("X5").Value

  If Range("X5") <> 0 Then
    Range("P10:P509").FormulaR1C1 = "=IF(MAX(RC[10]:RC[509])=R5C24,RC[-9],"""")"
    Range("Z7:TE7").FormulaR1C1 = "=IF(MAX(R[3]C:R[504]C)=R5C24,R[-6]C,"""")"

    Range("P7").FormulaR1C1 = "=MAX(R[3]C:R[502]C)"
    Range("P8").FormulaR1C1 = "=MAX(R[-1]C[10]:R[-1]C[509])"
    Range("P7:P8").Value = Range("P7:P8").Value
    Range("P10:TE509").Clear

    Range("P10").FormulaR1C1 = "=IF(OR(RC[-15]=R7C16,RC[-15]=R8C16),RC[-15],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-15],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("P10:T10").AutoFill Destination:=.Range("P10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P10:T10009").Value = Range("P10:T10009").Value
    Range("P10:T10009").Sort Key1:=Range("P10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P2:T2").Value = Range("P10:T10").Value
    Range("P4:T4").Value = Range("P11:T11").Value
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
   End If
 End If
    If Range("W6") <> "OK" Then
    Range("A1:W8").Clear
    Range("A1").Value = "NONE IDENTIFIED"
    End If
    Columns("Z:TE").Clear
    Range("G7:T10009").Clear
    
ElseIf Range("G10") = "" Then
    Range("A1:F7").Clear
    Range("A1").Value = "NONE IDENTIFIED"
End If
    
End Sub
Sub Triangle2()
'
' Triangle2 IN TRIORDS? When OneOrd fails, and O3 = O4 and O3 = MAX Os (Essex)
'
Application.ScreenUpdating = False
If Range("O3") = Range("O4") And Range("O3") > Range("O1") And Range("O3") > Range("O2") Then
    'amended 7/15/14 R4C1 instead of R4C16
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R4C1,6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(R3C3-RC[-4]))<=10),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R4C2)+COS(RC[-10])*COS(R4C2)*COS(R4C3-RC[-9])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'Determine whether 134 or 234 is closer
    Range("D6").Value = "134"
    Range("E6").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-3])*SIN(R[-5]C[-3])+COS(R[-3]C[-3])*COS(R[-5]C[-3])*COS(R[-5]C[-2]-R[-3]C[-2]))"
    Range("E7").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-3])*SIN(R[-4]C[-3])+COS(R[-3]C[-3])*COS(R[-4]C[-3])*COS(R[-4]C[-2]-R[-3]C[-2]))"
    Range("E8").FormulaR1C1 = "=6371*ACOS(SIN(R[-4]C[-3])*SIN(R[-7]C[-3])+COS(R[-4]C[-3])*COS(R[-7]C[-3])*COS(R[-7]C[-2]-R[-4]C[-2]))"
    Range("F7").FormulaR1C1 = "=SUM(R[-1]C[-1]:R[1]C[-1])"
    Range("G7").FormulaR1C1 = "=IF(RC[-1]>=750,0.25*RC[-1],0.28*RC[-1])"
    Range("H7").FormulaR1C1 = "=IF(RC[-2]>=750,0.45*RC[-2],"""")"
    Range("I6").Value = "234"
    Range("J6").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-8])*SIN(R[-4]C[-8])+COS(R[-3]C[-8])*COS(R[-4]C[-8])*COS(R[-4]C[-7]-R[-3]C[-7]))"
    Range("J7").FormulaR1C1 = "=6371*ACOS(SIN(R[-3]C[-8])*SIN(R[-4]C[-8])+COS(R[-3]C[-8])*COS(R[-4]C[-8])*COS(R[-4]C[-7]-R[-3]C[-7]))"
    Range("J8").FormulaR1C1 = "=6371*ACOS(SIN(R[-4]C[-8])*SIN(R[-6]C[-8])+COS(R[-4]C[-8])*COS(R[-6]C[-8])*COS(R[-6]C[-7]-R[-4]C[-7]))"
    Range("K7").FormulaR1C1 = "=SUM(R[-1]C[-1]:R[1]C[-1])"
    Range("L7").FormulaR1C1 = "=IF(RC[-1]>=750,0.25*RC[-1],0.28*RC[-1])"
    Range("M7").FormulaR1C1 = "=IF(RC[-2]>=750,0.45*RC[-2],"""")"
    Range("L8").FormulaR1C1 = "=MIN(R[2]C:R[10001]C)"
    Range("L9").FormulaR1C1 = "=MAX(R[1]C:R[10000]C)"
    Range("N7").FormulaR1C1 = "=RC[-7]-R[1]C[-2]"
    Range("O7").FormulaR1C1 = "=RC[-3]-R[1]C[-3]"
    Range("P7").FormulaR1C1 = "=SUM(RC[-2]:RC[-1])"
    Range("Q7").FormulaR1C1 = "=SUM(R[1]C[-3]:R[1]C[-2])"
    Range("N8").FormulaR1C1 = "=IF(R[-1]C[-6]<>"""",R[-1]C[-6]-R[1]C[-2],"""")"
    Range("O8").FormulaR1C1 = "=IF(R[-1]C[-2]<>"""",R[-1]C[-2]-R[1]C[-3],"""")"
    Range("P7").FormulaR1C1 = "=SUM(RC[-2]:RC[-1])"
    Range("Q7").FormulaR1C1 = "=SUM(R[1]C[-3]:R[1]C[-2])"
   
    If Range("P7") < Range("Q7") Then
        Range("P2:T2").Value = Range("A1:E1").Value
    ElseIf Range("Q7") < Range("P7") Then
        Range("P2:T2").Value = Range("A2:E2").Value
    End If
    
    Range("P3:T4").Value = Range("A3:E4").Value
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("U5").FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
    Range("L9,D6:Q8").Clear
   
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R4C16,6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(R3C3-RC[-4]))<=10),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R4C17)+COS(RC[-4])*COS(R4C17)*COS(R4C18-RC[-3])),"""")"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]="""","""",IF(OR(AND(R5C21>=750,RC[-1]>0.25*R5C21,RC[-1]<=0.45*R5C21),AND(R5C21<750,RC[-1]>=0.28*R5C21)),1,""""))"
    'Copy Ref A value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:M10").AutoFill Destination:=.Range("G10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:M10009").Value = Range("G10:M10009").Value
    Range("G10:M10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("M9").FormulaR1C1 = "=SUM(R[1]C:R[10000]C)"
    
    Range("A6").Value = 6.94444444444444E-03
    Range("O10").FormulaR1C1 = "=IF(AND(RC[-14]<R10C7,6371*ACOS(SIN(RC[-13])*SIN(R2C17)+COS(RC[-13])*COS(R2C17)*COS(R2C18-RC[-12]))<=15,RC[-14]>=R2C16-R6C1,RC[-14]<=R2C16+R6C1),RC[-14],"""")"
    Range("P10:S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-14],"""")"
    Range("T10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-18])*SIN(R4C17)+COS(RC[-18])*COS(R4C17)*COS(R4C18-RC[-17])),"""")"
    Range("U10").FormulaR1C1 = "=IF(RC[-1]<>"""",1,"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("O10:U10").AutoFill Destination:=.Range("O10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("O10:U10009").Value = Range("O10:U10009").Value
    Range("O10:U10009").Sort Key1:=Range("O10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U9").FormulaR1C1 = "=SUM(R[1]C:R[10000]C)"
    
    If Range("M9") < Range("U9") And Range("M9") <= 500 Then
    
    Range("W10").FormulaR1C1 = "=IF(RC[-10]=1,RC[-16],"""")"
    Range("X10:AA10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-16],"""")"
    Range("AB10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-20])*SIN(R4C17)+COS(RC[-20])*COS(R4C17)*COS(R4C18-RC[-19])),"""")"
    'Copy Ref G Value Sort Copy/Transpose to W1"
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("W10:AB10").AutoFill Destination:=.Range("W10:AB" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("W10:AB509").Value = Range("W10:AB509").Value
    Range("W10:AB509").Sort Key1:=Range("W10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("W10:AB509").Copy
    Range("W1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("W10:AB509").Clear
    
    'MATRIX
    Range("W10:TB10").FormulaR1C1 = _
        "=IF(R1C="""","""",IF(AND(RC20+R6C+6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17))>=R5C21,MIN(RC20,R6C,6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17)))>=0.25*(SUM(RC20,R6C,6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17)))),MAX(RC20,R6C,6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17)))<=0.45*SUM(RC20,R6C,6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17)))),SUM(RC20,R6C,6371*ACOS(SIN(RC16)*SIN(R2C)+COS(RC16)*COS(R2C)*COS(R3C-RC17))),""""))"
    'Copy Ref O
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "O").End(xlUp).Row
.Range("W10:TB10").AutoFill Destination:=.Range("W10:TB" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("W10:TB3000").Value = Range("W10:TB3000").Value
   
    Range("R6").FormulaR1C1 = "=MAX(R[4]C[5]:R[2994]C[500])"
    Range("R6").Value = Range("R6").Value
    
    Range("W7:TB7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R6C18,R[-6]C,"""")"
    Range("W7:TB7").Value = Range("W7:TB7").Value
    Range("V10:V3000").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R6C18,RC[-7],"""")"
    ActiveSheet.Calculate
    Range("V10:V3000").Value = Range("V10:V3000").Value
    Range("W10:TB3000").Clear
    
    Range("W8:TB11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    Range("P2").FormulaR1C1 = "=MAX(R[5]C[7]:R[5]C[506])"
    Range("Q2").FormulaR1C1 = "=MAX(R[6]C[6]:R[6]C[505])"
    Range("R2").FormulaR1C1 = "=MAX(R[7]C[5]:R[7]C[504])"
    Range("S2").FormulaR1C1 = "=MAX(R[8]C[4]:R[8]C[503])"
    Range("T2").FormulaR1C1 = "=MAX(R[9]C[3]:R[9]C[502])"
    Range("P2:T2").Value = Range("P2:T2").Value
    Range("W8:TB11").Clear
   
    Range("W10:Z3000").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    Range("P3:T3").FormulaR1C1 = "=MAX(R[7]C[6]:R[2997]C[6])"
    
    Range("P3:T3").Value = Range("P3:T3").Value
   
    Range("P2:T4").Select
    Range("P2:T4").Sort Key1:=Range("P2"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("U5").FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
    Range("U2:U5").Value = Range("U2:U5").Value
    End If
    
    Range("R6,G9:TB3000,W1:TB7").Clear
  
  ElseIf Range("O1") > Range("O2") And Range("O1") > Range("O2") And Range("O1") > Range("O3") And Range("O1") > Range("O4") Then
    Application.Run "F.xlsm!TriORDS123"
  End If
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C3,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
    Range("W6").FormulaR1C1 = "=IF(OR(AND(R[-1]C[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*R[-1]C[-1]),AND(R[-1]C[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*R[-1]C[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*R[-1]C[-1])),""OK"","""")"
    Range("U2:W6").Value = Range("U2:W6").Value
End Sub
Sub TriORDS123()
'
' If Range O1 = MAX O1:O4 And G2 = MIN F1,G2,H3
'
Application.ScreenUpdating = False
    'Range("G9:U10009,P2:U5").Clear
    Range("K1").FormulaR1C1 = "=IF(AND(RC[4]=MAX(RC[4]:R[3]C[4]),R[1]C[-4]=MIN(RC[-5],R[1]C[-4],R[2]C[-3])),123,"""")"
    Range("K1").Value = Range("K1").Value
    
 If Range("K1") = 123 Then
    Range("A7").Value = 3.47222222222222E-03
    Range("U5").FormulaR1C1 = "=IF(R[-4]C[-6]<750,R[-4]C[-6]*0.28,R[-4]C[-6]*0.25)"
    Range("U6").FormulaR1C1 = "=IF(R[-5]C[-6]>=750,0.45*R[-5]C[-6],0.44*R[-5]C[-6])"
    Range("U5:U6").Value = Range("U5:U6").Value
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C1-R7C1,RC[-6]<=R1C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A value sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]>=R2C1-R7C1,RC[-12]<=R2C1+R7C1),RC[-12],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    'Copy Ref A value sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:Q10").AutoFill Destination:=.Range("M10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:Q10009").Value = Range("M10:Q10009").Value
    Range("M10:Q10009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("S10").FormulaR1C1 = "=IF(AND(RC[-18]>=R3C1-R7C1,RC[-18]<=R3C1+R7C1),RC[-18],"""")"
    Range("T10:W10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-18],"""")"
    'Copy Ref A value sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("S10:W10").AutoFill Destination:=.Range("S10:W" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("S10:W10009").Value = Range("S10:W10009").Value
    Range("S10:W10009").Sort Key1:=Range("S10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("M10:Q500").Copy
    Range("Z1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    'MATRIX
    Range("Z10:TE10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC21=R3C),"""",IF(AND(6371*ACOS(SIN(RC20)*SIN(R2C)+COS(RC20)*COS(R2C)*COS(R3C-RC21))>=R5C21,6371*ACOS(SIN(RC20)*SIN(R2C)+COS(RC20)*COS(R2C)*COS(R3C-RC21))<=R6C21),6371*ACOS(SIN(RC20)*SIN(R2C)+COS(RC20)*COS(R2C)*COS(R3C-RC21)),""""))"
    'Copy Ref S
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "S").End(xlUp).Row
.Range("Z10:TE10").AutoFill Destination:=.Range("Z10:TE" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Z10:TE3000").Value = Range("Z10:TE3000").Value
    Range("V5").FormulaR1C1 = "=MAX(R[5]C[4]:R[995]C[153])"
    Range("V5").Value = Range("V5").Value

    Range("Z6:TE6").FormulaR1C1 = "=IF(R1C="""","""",IF(MAX(R[4]C:R[2994]C)=R5C22,R[-5]C,""""))"
    Range("Z6:TE6").Value = Range("Z6:TE6").Value
    Range("Y10:Y3000").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C22,RC[-6],"""")"
    Range("Y10:Y3000").Value = Range("Y10:Y3000").Value
    
    Range("Z10:TE3000").Clear
    
    Range("Z7:TE10").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-5]C,"""")"
    
    Range("P3").FormulaR1C1 = "=MAX(R[3]C[10]:R[3]C[509])"
    Range("Q3").FormulaR1C1 = "=MAX(R[4]C[9]:R[4]C[508])"
    Range("R3").FormulaR1C1 = "=MAX(R[5]C[8]:R[5]C[507])"
    Range("S3").FormulaR1C1 = "=MAX(R[6]C[7]:R[6]C[506])"
    Range("T3").FormulaR1C1 = "=MAX(R[7]C[6]:R[7]C[505])"
    Range("P3:T3").Value = Range("P3:T3").Value
    
    Range("Z7:TE10").Clear
    
    Range("Z10:AC10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref S
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "S").End(xlUp).Row
.Range("Z10:AC10").AutoFill Destination:=.Range("Z10:AC" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P4:T4").FormulaR1C1 = "=MAX(R[6]C[9]:R[2996]C[9])"
    Range("P4:T4").Value = Range("P4:T4").Value
    
    Range("M10:W3000").Clear
    Columns("Y:TE").Clear

    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[2992]C)"
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    Range("M10").FormulaR1C1 = "=R3C21"
    Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R4C17)+COS(RC[-6])*COS(R4C17)*COS(R4C18-RC[-5]))"
    Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
    Range("P10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
   
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").Value = Range("Q8:U8").Value
    
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    'Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    'Range("V6").FormulaR1C1 = "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"
    'Range("W6").FormulaR1C1 = "=IF(OR(AND(R[-1]C[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*R[-1]C[-1]),AND(R[-1]C[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*R[-1]C[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*R[-1]C[-1])),""OK"","""")"
    'Range("U2:W6").Value = Range("U2:W6").Value
    
    Range("G8:X10009").Clear
  End If
End Sub

Sub Ramy06()
'
' Checks for 2-TP Triangle if TP1 earlier than O&R Start
'
 If Range("W6") = "OK" And Range("P2") < Range("A8") Then
    'Save Tri2 results
    Range("G6:K8").Value = Range("P2:T4").Value
    Sheets("Sheet2").Range("C8:D8").Value = Sheets("TASKS").Range("D16:E16").Value
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R2C16,RC[-6]<=R8C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R8C3)+COS(RC[-10])*COS(R8C3)*COS(R8C4-RC[-9])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R3C17)+COS(RC[-6])*COS(R3C17)*COS(R3C18-RC[-5]))"
    Range("O10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-7])*SIN(R4C17)+COS(RC[-7])*COS(R4C17)*COS(R4C18-RC[-6]))"
    Range("Q10").FormulaR1C1 = "=SUM(RC[-3],RC[-2],R3C21)"
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:Q10009").Value = Range("N10:Q10009").Value
   
    Range("E8").Value = 1.38888888888889E-03
    Range("S10").FormulaR1C1 = "=IF(AND(RC[-18]>=R8C2-R8C5,RC[-18]<=R8C2+R8C5),RC[-18],"""")"
    Range("T10:W10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-18],"""")"
    Range("X10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(R4C17)*SIN(RC[-22])+COS(R4C17)*COS(RC[-22])*COS(RC[-21]-R4C18)),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("S10:X10").AutoFill Destination:=.Range("S10:X" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("S10:X10009").Value = Range("S10:X10009").Value
    Range("S10:X10009").Sort Key1:=Range("S10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("S10:X500").Copy
    Range("Z1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("S10:X500").Clear
    'Matrix
    Range("Z10:TE10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC15,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.7),"""",IF(RC10-R4C>R9C4,RC17-((RC10-R4C-R9C4)*0.1),RC17)))"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("Z10:TE10").AutoFill Destination:=.Range("Z10:TE" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("X5").FormulaR1C1 = "=MAX(R[5]C[2]:R[3004]C[501])"
    Range("X5").Value = Range("X5").Value
    Range("Z10:TE3000").Value = Range("Z10:TE3000").Value
    
    Range("Z7:TE7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R5C24,R[-6]C,"""")"
    Range("Z7:TE7").Value = Range("Z7:TE7").Value
    
    Range("R10:R3000").FormulaR1C1 = "=IF(MAX(RC[8]:RC[507])=R5C24,RC[-11],"""")"
    ActiveSheet.Calculate
    Range("R10:R3000").Value = Range("R10:R3000").Value
    
    Range("Z10:TE3000").Clear
    
    Range("S10:V10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    'Copy Ref G
     With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("S10:V10").AutoFill Destination:=.Range("S10:V" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").FormulaR1C1 = "=MAX(R[8]C[2]:R[10007]C[2])"
    Range("P2:T2").Value = Range("P2:T2").Value
    
    Range("Z8:TE8").FormulaR1C1 = "=IF(R[-1]C=MIN(R[-1]C26:R[-1]C525),R[-6]C,"""")"
    Range("Z9:TE11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    Range("Z8:TE11").Value = Range("Z8:TE11").Value
 
    Range("P5").FormulaR1C1 = "=MIN(R[2]C[10]:R[2]C[509])"
    Range("Q5").FormulaR1C1 = "=MAX(R[3]C[9]:R[3]C[508])"
    Range("R5").FormulaR1C1 = "=MAX(R[4]C[8]:R[4]C[507])"
    Range("S5").FormulaR1C1 = "=MAX(R[5]C[7]:R[5]C[506])"
    Range("T5").FormulaR1C1 = "=MAX(R[6]C[6]:R[6]C[505])"
    Range("P5:T5").Value = Range("P5:T5").Value
    
    Range("P1").Value = "This is a 2-Turn Point Triangle"
    
    Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("V5").FormulaR1C1 = "=SUM(R[-3]C[-1]:R[-1]C[-1])"
    Range("V6").FormulaR1C1 = _
        "=IF(TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])>R9C4,R[-1]C-((TASKS!R[8]C[-14]-MAX(TASKS!R[10]C[-14],TASKS!R[11]C[-14])-R9C4)*0.1),R[-1]C)"

    Range("W6").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-4]C[-2]:R[-2]C[-2])>=0.25*RC[-1],MAX(R[-4]C[-2]:R[-2]C[-2])<=0.45*RC[-1])),""OK"","""")"
    Range("C8:E8,G10:W10009,X1:TE11").Clear
 End If
    'Ck Start, given FinLine length
    Range("N5").FormulaR1C1 = "=6371*ACOS(SIN(RC[3])*SIN(R[-3]C[3])+COS(RC[3])*COS(R[-3]C[3])*COS(R[-3]C[4]-RC[4]))"
   
    If Range("N5") <= 0.5 Then
        Exit Sub
    End If
    
    'Ck for Finish candidates based on FinLine length
    If Range("N5") > 0.5 Then
        Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]<R3C16,6371*ACOS(SIN(RC[-5])*SIN(R5C17)+COS(RC[-5])*COS(R5C17)*COS(R5C18-RC[-4]))<=0.5),6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4])),"""")"
        'Copy Ref A
        With Worksheets("Sheet2")
        LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
    .Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
        End With
     ActiveSheet.Calculate
        Range("L8").FormulaR1C1 = "=MAX(R[2]C[-5]:R[10001]C[-5])"
        Range("L8").Value = Range("L8").Value
        Range("G10:G10009").Clear
        'If G8 =0 ck for 3 TP triangle
        If Range("L8") = 0 Then
            Range("X4:X5").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-7])*SIN(RC[-7])+COS(R[-1]C[-7])*COS(RC[-7])*COS(RC[-6]-R[-1]C[-6]))"
            Range("X6").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-7])*SIN(R[-3]C[-7])+COS(R[-1]C[-7])*COS(R[-3]C[-7])*COS(R[-3]C[-6]-R[-1]C[-6]))"
            Range("Y5").FormulaR1C1 = "=SUM(R[-1]C[-1]:R[1]C[-1])"
            Range("Y6").FormulaR1C1 = _
                "=IF(TASKS!R[8]C[-17]-MAX(TASKS!R[10]C[-17],TASKS!R[11]C[-17])>R9C4,R[-1]C-((TASKS!R[8]C[-17]-MAX(TASKS!R[10]C[-17],TASKS!R[11]C[-17])-R9C4)*0.1),R[-1]C)"
            Range("Z6").FormulaR1C1 = _
                "=IF(OR(AND(RC[-1]<750,MIN(R[-2]C[-2]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(R[-2]C[-2]:RC[-2])>=0.25*RC[-1],MAX(R[-2]C[-2]:RC[-2])<=0.45*RC[-1])),""OK"","""")"
            
            If Range("Z6") <> "OK" Then
                Range("G10").FormulaR1C1 = "=IF(RC[-6]>R4C16,RC[-6],"""")"
                Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
                'Copy Ref A Value Sort
                With Worksheets("Sheet2")
                LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
            .Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
                End With
                ActiveSheet.Calculate
                Range("G10:K10009").Value = Range("G10:K10009").Value
                Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
                Range("L10").FormulaR1C1 = "=R4C24"
                Range("M10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4]))"
                Range("N10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-6])*SIN(R3C17)+COS(RC[-6])*COS(R3C17)*COS(R3C18-RC[-5]))"
                Range("O10").FormulaR1C1 = "=SUM(RC[-3]:RC[-1])"
                Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
                Range("P10").FormulaR1C1 = _
                    "=IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],"""")"
                Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C16,RC[-10],"""")"
                Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
                'Copy Ref G
                With Worksheets("Sheet2")
                LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
            .Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
                End With
                ActiveSheet.Calculate
                Range("P8:U8").Value = Range("P8:U8").Value
    
                Range("G10:U10009").Clear
    
                Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R3C16,6371*ACOS(SIN(RC[-5])*SIN(R8C18)+COS(RC[-5])*COS(R8C18)*COS(R8C19-RC[-4]))<=0.5),RC[-6],"""")"
                'Copy Ref A
                With Worksheets("Sheet2")
                LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
            .Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
                End With
                ActiveSheet.Calculate
                    If Range("L8") = 0 Then
                        Range("P8:U8").Clear
                    ElseIf Range("G8") <> 0 Then
                        Range("P5:T5").Value = Range("Q8:U8").Value
                    End If
          End If
        End If
      End If
    Range("X4:Z6").Value = Range("X4:Z6").Value
    Range("P1").Clear
    Range("P2:T2").Value = Range("P3:T3").Value
    Range("P3:T3").Value = Range("P4:T4").Value
    Range("P4:T4").Value = Range("P5:T5").Value
    Range("P5:T5").Clear
    Range("U2:U4").Value = Range("X4:X6").Value
    Range("L8,N5,X4:Z6").Clear
    If Range("P1") = "" And Range("G6") > Range("A8") Then
        Range("P2:T4").Value = Range("G6:K8").Value
        Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
        Range("U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
        Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
        Range("U2:U4").Value = Range("U2:U4").Value
    End If
    Range("G6:K8").Clear
        
End Sub

Sub TriFline1()
'
' Adapted from Azz2
'
'Select Tri FINI + 2 fixes before, 2 fixes after
Application.ScreenUpdating = False
 If Range("A9") <> "REF" Then
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R5C1,AND(R[-1]C[-6]<R5C1,RC[-6]>R5C1)),1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

 ElseIf Range("A9") = "REF" Then
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A5").Value = Sheets("Sheet2").Range("A5").Value
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R5C1,AND(R[-1]C[-6]<R5C1,RC[-6]>R5C1)),1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
    Range("L10:P60009").Value = Range("L10:P60009").Value
    Range("G10:K60009").Clear
    
    Range("L10:P60009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Sheets("Sheet2").Range("L10:P14").Value = Sheets("Sheet3").Range("L10:P14").Value
    Sheets("Sheet3").Range("A5,L10:P14").Clear
    Sheets("Sheet2").Activate
 End If
 
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("A4:E4").Value
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("A1:E1").Value
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("A2:E2").Value
    End If
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value
    Sheets("YDWK3").Activate
Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("A6").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("B6").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("B6").Value = Range("B6").Value
    Sheets("Sheet2").Range("D6:E6").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear

Application.Run "F.xlsm!YDWK3clear"

If Range("A6") = "NO FIN LINE" Then
    Application.Run "F.xlsm!TriFline1b"
End If

If Range("A9") = "REF" Then
    Application.Run "F.xlsm!TriFline1a"
End If

Application.Run "F.xlsm!TriOZSector"
End Sub
Sub TriFline1a()
'
' Finds Finish Line candidate at OR Start, within 5 mins of OR Finish
'
Application.ScreenUpdating = False
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A1:E5").Value = Sheets("Sheet2").Range("A1:E5").Value
    Sheets("Sheet3").Range("M5").Value = Sheets("Sheet2").Range("F7").Value
    Sheets("Sheet3").Range("A7").Value = 3.47222222222222E-03
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("G10:K10").Value = Range("A1:E1").Value
    Else:
        Range("G10:K10").Value = Range("A2:E2").Value
    End If
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-6]C[-10])+COS(RC[-4])*COS(R[-6]C[-10])*COS(R[-6]C[-9]-RC[-3]))"
    
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]>=R5C1-R7C1,RC[-12]<=R5C1+R7C1),RC[-12],"""")"
    Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    'Copy Ref A Value Sort to N1
 With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:Q10").AutoFill Destination:=.Range("M10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:Q60009").Value = Range("M10:Q60009").Value
    Range("M10:Q60009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("M10:Q509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("M10:Q509").Clear
    
    Range("N6:SS6").FormulaR1C1 = "=IF(R1C<>"""",6371*ACOS(SIN(R2C)*SIN(R4C2)+COS(R2C)*COS(R4C2)*COS(R4C3-R3C)),"""")"
    
    'MATRIX
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9,R6C[1]<R6C),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,SQRT(RC12^2+0.25)<=R2C),"""",IF(RC10-R4C>R9C4,R5C13-((RC10-R4C-R9C4)*0.1),R5C13)))"
    ActiveSheet.Calculate
    Range("M6").FormulaR1C1 = "=MAX(R[4]C[1]:R[4]C[500])"
    Range("M6").Value = Range("M6").Value
    Range("C7").FormulaR1C1 = "=MIN(RC[11]:RC[510])"
    Range("N7:SS7").FormulaR1C1 = "=IF(R[3]C=R6C13,R[-6]C,"""")"
    Range("C7").Value = Range("C7").Value
    
  If Range("C7") = 0 Then
    Range("A6").Value = "NO FIN LINE"
    Range("C7,G1:SS7,G10:L10").Clear
  ElseIf Range("C7") <> 0 Then
    
    Range("G10:L10").Clear
    'Find 5 fixes BASED ON C7
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R7C3,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("L10:P60009").Value = Range("L10:P60009").Value
    Range("G10:K60009").Clear
    
    Range("L10:P60009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Sheets("Sheet2").Range("L10:P14").Value = Sheets("Sheet3").Range("L10:P14").Value
    Sheets("Sheet3").Range("A1:SS8,L10:P14,Q10:SS10").Clear
    Sheets("Sheet2").Activate
 
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("A4:E4").Value
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("A1:E1").Value
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("A2:E2").Value
    End If
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value
    Sheets("YDWK3").Activate
Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("A6").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("B6").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("B6").Value = Range("B6").Value
    Sheets("Sheet2").Range("D6:E6").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear
    Range("F7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-1]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-1]C[-2]-R9C4)*0.1),R[-1]C)"
    Range("F8").FormulaR1C1 = _
        "=IF(OR(AND(R[-1]C<750,MIN(R[-6]C:R[-4]C)>=0.28*R[-1]C),AND(R[-1]C>=750,MIN(R[-6]C:R[-4]C)>=0.25*R[-1]C,MAX(R[-6]C:R[-4]C)<=0.45*R[-1]C)),""OK"",""NOPE"")"
    Range("F7:F8").Value = Range("F7:F8").Value
Application.Run "F.xlsm!YDWK3clear"
 End If
End Sub
Sub TriFline1b()
'
' Cks within 5 mins OR Fini, 30 mins OR Start
'
Application.ScreenUpdating = False
    Range("A7").Value = 6.94444444444444E-03
    Range("A8").Value = 2.08333333333333E-02
    'Finis to TOP
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R5C1-R7C1,RC[-6]<=R5C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R4C2)+COS(RC[-10])*COS(R4C2)*COS(R4C3-RC[-9])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("G10:L509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("L6").FormulaR1C1 = "=MIN(RC[2]:RC[501])"
    Range("M6").FormulaR1C1 = "=MAX(RC[1]:RC[500])"
    Range("L6:M6").Value = Range("L6:M6").Value
    
    Range("G10:L10009").Clear
    'STARTS
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("G10").FormulaR1C1 = _
            "=IF(RC[-4]=R4C3,"""",IF(AND(RC[-6]>=R1C1-R8C1,RC[-6]<=R1C1+R8C1,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))>=R6C12),RC[-6],""""))"
    Else:
        Range("G10").FormulaR1C1 = _
            "=IF(RC[-4]=R4C3,"""",IF(AND(RC[-6]>=R2C1-R8C1,RC[-6]<=R2C1+R8C1,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))>=R6C12),RC[-6],""""))"
    End If
    
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R4C2)+COS(RC[-10])*COS(R4C2)*COS(R4C3-RC[-9])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

If Range("G10") <> "" Then
    'MATRIX Uses MIN!!
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,SQRT(RC12^2+0.25)<=R2C),"""",R6C+RC12))"
    
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("N10:SS3000").Value = Range("N10:SS3000").Value
    
    Range("J6").FormulaR1C1 = "=MIN(R[4]C[4]:R[3003]C[503])"
    Range("J6").Value = Range("J6").Value
    Range("N7:SS7").FormulaR1C1 = "=IF(MIN(R[3]C:R[10002]C)=R6C10,R[-6]C,"""")"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MIN(RC[1]:RC[500])=R6C10,RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M3009").Value = Range("M10:M3009").Value
    
    Range("N10:SS3009").Clear
    Range("N8:SS11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    
    Range("H7").FormulaR1C1 = "=MAX(RC[6]:RC[505])"
    Range("I7").FormulaR1C1 = "=MAX(R[1]C[5]:R[1]C[504])"
    Range("J7").FormulaR1C1 = "=MAX(R[2]C[4]:R[2]C[503])"
    Range("K7").FormulaR1C1 = "=MAX(R[3]C[3]:R[3]C[502])"
    Range("L7").FormulaR1C1 = "=MAX(R[4]C[2]:R[4]C[501])"
    Range("H7:L7").Value = Range("H7:L7").Value
    
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("H6:L6").FormulaR1C1 = "=MAX(R[4]C[5]:R[3003]C[5])"
    Range("H6:L6").Value = Range("H6:L6").Value
    
    Columns("N:SS").Clear
    Range("M6,G8:M10009").Clear

    'Select Tri FINI + 2 fixes before, 2 fixes after
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R7C8,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("A4:E4").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H6:L6").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H8").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I8").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I8").Value = Range("I8").Value
    Sheets("Sheet2").Range("K8:L8").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear
    
    Range("M8").FormulaR1C1 = _
        "=IF(RC[-5]=""NO FIN LINE"","""",IF(R[-2]C[-2]-RC[-2]>R9C4,R[-2]C[-7]-((R[-2]C[-2]-RC[-2]-R9C4)*0.1),R[-2]C[-7]))"
    Range("M8").Value = Range("M8").Value

    Application.Run "F.xlsm!YDWK3clear"
    
    If Range("H8") <> "NO FIN LINE" And Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("A1:E1").Value = Range("H6:L6").Value
        Range("A5:E6").Value = Range("H7:L8").Value
        Range("F7").Value = Range("M8").Value
    ElseIf Range("H8") <> "NO FIN LINE" And Range("A1") = "This is a 2-Turn Point Triangle" Then
        Range("A2:E2").Value = Range("H6:L6").Value
        Range("A5:E6").Value = Range("H7:L8").Value
        Range("F7").Value = Range("M8").Value
    End If
End If
    Range("A7:A8,H6:M8").Clear
End Sub
Sub TriOZSector()
'
' Adapted from Azz2 Tests for OZ after Triangle1; Tests for/finds OZ Sector; P1 modified 4/18/2018 so sector OK irrespective of date
'
Application.ScreenUpdating = False
    
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("B1:C1").Value
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("B2:C2").Value
    End If
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B4:C4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("C7:C8").Value = Sheets("YDWK3").Range("E2:E3").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Activate
    'CK OZ for Triangle1 result
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("H1:L1").Value = Range("A1:E1").Value
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Range("H1:L1").Value = Range("A2:E2").Value
    End If
    Range("H2:L3").Value = Range("A5:E6").Value
   'Find 7 Fixes - 3 before & 3 after raw Fin
    
  If Range("A9") <> "REF" Then
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R5C1,AND(R[-1]C[-6]<R5C1,RC[-6]>R5C1)),1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[3]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[2]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-1]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = "=IF(R[-2]C[-5]=1,1,"""")"
    Range("M10").FormulaR1C1 = "=IF(R[-3]C[-6]=1,1,"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:M10").AutoFill Destination:=.Range("G10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:M10009").Value = Range("G10:M10009").Value
    Range("N10").FormulaR1C1 = _
        "=IF(OR(RC[-7]=1,RC[-6]=1,RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-13],"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
      
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:R10009").Value = Range("N10:R10009").Value
    Range("G10:M10009").Clear
    Range("N10:R10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
  ElseIf Range("A9") = "REF" Then
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A5").Value = Sheets("Sheet2").Range("A5").Value
    
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R5C1,AND(R[-1]C[-6]<R5C1,RC[-6]>R5C1)),1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[3]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[2]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-1]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = "=IF(R[-2]C[-5]=1,1,"""")"
    Range("M10").FormulaR1C1 = "=IF(R[-3]C[-6]=1,1,"""")"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:M10").AutoFill Destination:=.Range("G10:M" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("G10:M60009").Value = Range("G10:M60009").Value
    Range("N10").FormulaR1C1 = _
        "=IF(OR(RC[-7]=1,RC[-6]=1,RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-13],"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
      
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("N10:R60009").Value = Range("N10:R60009").Value
    Range("G10:M60009").Clear
    Range("N10:R60009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
    Sheets("Sheet2").Range("N10:R16").Value = Sheets("Sheet3").Range("N10:R16").Value
    Sheets("Sheet3").Range("A5,N10:R16").Clear
    Sheets("Sheet2").Activate
  End If
   
    'Test 3 earlier, 3 later than A5
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O10:P10").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M10").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O11:P11").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M11").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O12:P12").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M12").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O13:P13").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M13").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O14:P14").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M14").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O15:P15").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M15").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O16:P16").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M16").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Application.Run "F.xlsm!YDWK3clear"
    
    'Added 9/1/14 G10:G15 to find thru sector G16= former G10:G16/deleted 11/3/14 ignores longer 2nd leg, finds ourside of sector!
    'ADDED NEW G10:G15 11/3/14
    'Range("G10:G15").FormulaR1C1 = _
        "=IF(OR(6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))>1,RC[6]=""""),"""",IF(OR(AND(R7C3>R8C3,RC[6]>=R8C3,RC[6]<=R7C3),AND(R7C3<R8C3,OR(RC[6]<=R7C3,RC[6]>=R8C3))),RC[7],IF(ABS(RC[6]-R[1]C[6])>90,RC[7],"""")))"
    Range("G10:G15").FormulaR1C1 = _
        "=IF(OR(6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))>1,RC[6]=""""),"""",IF(OR(AND(R7C3>R8C3,RC[6]>=R8C3,RC[6]<=R7C3),AND(R7C3<R8C3,OR(RC[6]<=R7C3,RC[6]>=R8C3))),RC[7],IF(AND(ABS(RC[6]-R[1]C[6])>90,6371*ACOS(SIN(R4C2)*SIN(R1C9)+COS(R4C2)*COS(R1C9)*COS(R1C10-R4C3))<6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))),RC[7],"""")))"
    Range("G16").FormulaR1C1 = _
        "=IF(OR(6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))>1,RC[6]=""""),"""",IF(OR(AND(R7C3>R8C3,RC[6]>=R8C3,RC[6]<=R7C3),AND(R7C3<R8C3,OR(RC[6]<=R7C3,RC[6]>=R8C3))),RC[7],""""))"
    Range("H10:K16").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[7],"""")"
    ActiveSheet.Calculate
    Range("G8").FormulaR1C1 = "=MAX(R[2]C[3]:R[8]C[3])"
    Range("G8").Value = Range("G8").Value
    Range("H7").FormulaR1C1 = _
        "=IF(R[1]C[-1]=R[3]C[2],R[3]C[-1],IF(R[1]C[-1]=R[4]C[2],R[4]C[-1],IF(R[1]C[-1]=R[5]C[2],R[5]C[-1],IF(R[1]C[-1]=R[6]C[2],R[6]C[-1],""""))))"
    Range("H8").FormulaR1C1 = _
        "=IF(RC[-1]=R[6]C[2],R[6]C[-1],IF(RC[-1]=R[7]C[2],R[7]C[-1],IF(RC[-1]=R[8]C[2],R[8]C[-1],"""")))"
    Range("H7:H8").Value = Range("H7:H8").Value
    Range("G8").FormulaR1C1 = "=MAX(R[-1]C[1]:RC[1])"
    Range("G8").Value = Range("G8").Value
    Range("H10:H16").FormulaR1C1 = "=IF(R8C7=0,"""",IF(RC[-1]=R8C7,RC[7],""""))"
    Range("H8:K8").FormulaR1C1 = "=MAX(R[2]C:R[8]C)"
    Range("G8:K8").Value = Range("G8:K8").Value
    
    If Range("G8") > 0 Then
        Range("D7").Value = "OK"
        Range("H4:L4").Value = Range("G8:K8").Value
        Range("M4").Value = "SECTOR"
        Range("G8:R16").Clear
        Range("M5").FormulaR1C1 = "=IF(R[-4]C[-2]-R[-1]C[-2]>R9C4,R7C6-((R[-4]C[-2]-R[-1]C[-2]-R9C4)*0.1),R7C6)"
        Range("M5").Value = Range("M5").Value
        
        If Range("I3") <> "        FINISH LINE" Then
            Application.Run "F.xlsm!TriFLine2b"
        End If
     End If
    
    If Range("G8") = 0 And Range("I3") = "        FINISH LINE" Then
        Range("G8:R10009").Clear
    ElseIf Range("G8") = 0 And Range("I3") <> "        Finish Line" Then
        Application.Run "F.xlsm!TriFLine2b"
    End If
     
     Range("P1").FormulaR1C1 = _
        "=IF(AND(R[6]C[-10]=MAX(R[6]C[-10],R[4]C[-3],R[7]C[-3]),R[5]C[-15]<>""NO FIN LINE""),""A1"",IF(OR(AND(R[4]C[-3]=MAX(R[6]C[-10],R[4]C[-3],R[7]C[-3]),R[3]C[-3]=""Sector""),AND(RC[-8]<42278,R[5]C[-15]=""NO FIN LINE"",R[4]C[-3]=MAX(R[4]C[-3],R[7]C[-3]))),""H1"",""H6""))"
     Range("P1").Value = Range("P1").Value
     Range("A7:D8,L9:R16").Clear
     Range("A1").Select
    
     Application.Run "F.xlsm!TriH10"
            
    If Range("E8") <> "" Then
        Sheets("TASKS").Range("C32").Value = Sheets("Sheet2").Range("E8").Value
        Sheets("TASKS").Range("A32").Value = "X"
    End If
    
If Range("H16") = "" Then
    If Range("A1") = "This is a 2-Turn Point Triangle" Then
        Sheets("TASKS").Range("G26").Value = "This is a 2-Turn Point Triangle"
        Sheets("TASKS").Range("C27:E29").Value = Sheets("Sheet2").Range("H10:J12").Value
        Sheets("TASKS").Range("C30").Value = Sheets("Sheet2").Range("H13").Value
        Sheets("TASKS").Range("F30").Value = Sheets("Sheet2").Range("I13").Value
        Sheets("TASKS").Range("H27:I30").Value = Sheets("Sheet2").Range("K10:L13").Value
        Sheets("TASKS").Range("L28:L30").Value = Sheets("Sheet2").Range("M10:M12").Value
        Sheets("TASKS").Activate
        Range("F27:G29").FormulaR1C1 = "=DEGREES(RC[-2])"
        Range("F27:G29").Value = Range("F27:G29").Value
        Range("M30").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
        Range("M30").Value = Range("M30").Value
        Range("N30").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)<=R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-MAX(R30C8:R31C8),0)<=10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-MAX(R30C8:R31C8),0)<=10*R30C13)),R30C13,IF(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)>R1C1),R30C13-((ROUND(R27C8-MAX(R30C8:R31C8),0)-R1C1))*0.1,0))"
        Range("M31").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)>R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-MAX(R30C8:R31C8),0)>10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-MAX(R30C8:R31C8),0)>10*R30C13)),""LoH"","""")"
        Range("M31").Value = Range("M31").Value
        Range("M30").Value = Range("N30").Value
        Range("N30").Clear
        If Range("A2") = "PR" Then
            Range("H10:H11,H14:H17,H20:H24,H27:H30").Value = "N/A"
        End If
    ElseIf Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Sheets("TASKS").Range("G26").Value = "This is a 3-Turn Point Triangle"
        Sheets("TASKS").Range("H27:I31").Value = Sheets("Sheet2").Range("K10:L14").Value
        Sheets("TASKS").Range("C27:E31").Value = Sheets("Sheet2").Range("H10:J14").Value
        Sheets("TASKS").Range("L28:L30").Value = Sheets("Sheet2").Range("M11:M13").Value
        Sheets("TASKS").Activate
        Range("F27:G30").FormulaR1C1 = "=DEGREES(RC[-2])"
        Range("F31").FormulaR1C1 = "=RC[-2]"
        Range("F27:G31").Value = Range("F27:G31").Value
        Range("M30").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
        Range("M30").Value = Range("M30").Value
        Range("N30").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-R31C8,0)<=R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-R31C8,0)<=10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-R31C8,0)<=10*R30C13)),R30C13,IF(AND(R30C13>100,ROUND(R27C8-R31C8,0)>R1C1),R30C13-((ROUND(R27C8-R31C8,0)-R1C1))*0.1,0))"
        Range("M31").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-R31C8,0)>R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-R31C8,0)>10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-R31C8,0)>10*R30C13)),""LoH"","""")"
        Range("M31").Value = Range("M31").Value
        Range("M30").Value = Range("N30").Value
        Range("N30").Clear
        Range("M30:M31").Value = Range("M30:M31").Value
        If Range("A2") = "PR" Then
            Range("H10:H11,H14:H17,H20:H24,H27:H31").Value = "N/A"
        End If
    End If

ElseIf Range("H16") <> "" Then
    If Range("A1") = "This is a 2-Turn Point Triangle" Then
        Sheets("TASKS").Range("G26").Value = "This is a 2-Turn Point Triangle"
        Sheets("TASKS").Range("C27:E29").Value = Sheets("Sheet2").Range("H16:J18").Value
        Sheets("TASKS").Range("C30").Value = Sheets("Sheet2").Range("H19").Value
        Sheets("TASKS").Range("F30").Value = Sheets("Sheet2").Range("I19").Value
        Sheets("TASKS").Range("H27:I30").Value = Sheets("Sheet2").Range("K16:L19").Value
        Sheets("TASKS").Range("L28:L30").Value = Sheets("Sheet2").Range("M16:M18").Value
        Sheets("TASKS").Activate
        Range("F27:G29").FormulaR1C1 = "=DEGREES(RC[-2])"
        Range("F27:G29").Value = Range("F27:G29").Value
        Range("M30").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
        Range("M30").Value = Range("M30").Value
        Range("N30").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)<=R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-MAX(R30C8:R31C8),0)<=10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-MAX(R30C8:R31C8),0)<=10*R30C13)),R30C13,IF(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)>R1C1),R30C13-((ROUND(R27C8-MAX(R30C8:R31C8),0)-R1C1))*0.1,0))"
        Range("M31").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-MAX(R30C8:R31C8),0)>R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-MAX(R30C8:R31C8),0)>10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-MAX(R30C8:R31C8),0)>10*R30C13)),""LoH"","""")"
        Range("M31").Value = Range("M31").Value
        Range("M30").Value = Range("N30").Value
        Range("N30").Clear
        If Range("A2") = "PR" Then
            Range("H10:H11,H14:H17,H20:H24,H27:H30").Value = "N/A"
        End If
    ElseIf Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Sheets("TASKS").Range("G26").Value = "This is a 3-Turn Point Triangle"
        Sheets("TASKS").Range("H27:I31").Value = Sheets("Sheet2").Range("K16:L20").Value
        Sheets("TASKS").Range("C27:E31").Value = Sheets("Sheet2").Range("H16:J20").Value
        Sheets("TASKS").Range("L28:L30").Value = Sheets("Sheet2").Range("M17:M19").Value
        Sheets("TASKS").Activate
        Range("F27:G30").FormulaR1C1 = "=DEGREES(RC[-2])"
        Range("F31").FormulaR1C1 = "=IF(RC[-3]=""NO FIN LINE"",""    NO FINISH LINE"",RC[-2])"
        Range("F27:G31").Value = Range("F27:G31").Value
        Range("M30").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
        Range("M30").Value = Range("M30").Value
        Range("N30").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-R31C8,0)<=R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-R31C8,0)<=10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-R31C8,0)<=10*R30C13)),R30C13,IF(AND(R30C13>100,ROUND(R27C8-R31C8,0)>R1C1),R30C13-((ROUND(R27C8-R31C8,0)-R1C1))*0.1,0))"
        Range("M31").FormulaR1C1 = _
        "=IF(OR(AND(R30C13>100,ROUND(R27C8-R31C8,0)>R1C1),AND(R30C13<=100,R2C1=""PR"",ROUND(R27C8-R31C8,0)>10*R30C13-100),AND(R30C13<=100,R2C1=0,ROUND(R27C8-R31C8,0)>10*R30C13)),""LoH"","""")"
        Range("M31").Value = Range("M31").Value
        Range("M30").Value = Range("N30").Value
        Range("N30").Clear
        If Range("A2") = "PR" Then
            Range("H10:H11,H14:H17,H20:H24,H27:H31").Value = "N/A"
        End If
    End If
 End If
 
 'Date-sensitive rules & Restore raw pressure altitudes to K
    Sheets("TASKS").Activate
    If Range("C10") < 41913 And Range("G26") = "This is a 3-Turn Point Triangle" And Range("M30") < 300 Then
        Range("C33:M33").Value = "Note: Per SC3 rules on this flight date, a 3-Turn Point Triangle required an Official Distance of at least 300km"
    ElseIf Range("C10") > 42278 Then
        If Range("F30") = "    FINISH SECTOR" Then
            Range("C33:M33").Value = "Note: Per SC3 rules on this flight date, Triangle Courses require Finish Line crossing"
        End If
    End If
    
    If Range("A2") <> "PR" Then
        Range("K10,K11,K14:K17,K20:K24").FormulaR1C1 = "=IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13)"
        Range("K10:K24").Value = Range("K10:K24").Value
        Range("K27:K29").FormulaR1C1 = "=IF(R[-1]C[-4]=""NONE IDENTIFIED"","""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
        Range("K30").FormulaR1C1 = "=IF(OR(R26C7=""NONE IDENTIFIED"",RC[-8]=""""),"""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
        Range("K31").FormulaR1C1 = "=IF(OR(R26C7=""NONE IDENTIFIED"",RC[-8]=""""),"""",IF(RC[-8]<B!R5C13,RC[-3]-B!R2C13,RC[-3]-B!R8C13))"
        Range("H10:H31").Value = Range("K10:K31").Value
    End If
End Sub
Sub TriFLine2b()
'
' Finds Finish Line after Sector - cks w/in 30 mins after OR Start; after last TP & among last 500 fixes recorded
'
Application.ScreenUpdating = False
    Range("A7").FormulaR1C1 = "=LARGE(R[3]C:R[10002]C,500)"
    Range("A7").Value = Range("A7").Value
    Range("A8").Value = 2.08333333333333E-02
    
    'Finishes to Top
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]>R4C1,RC[-12]>=R7C1),RC[-12],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:Q10").AutoFill Destination:=.Range("M10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:Q10009").Value = Range("M10:Q10009").Value
    Range("M10:Q10009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("M10:Q509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("M10:Q3009").Clear
    
    Range("N6:SS6").FormulaR1C1 = "=IF(R[-5]C<>"""",6371*ACOS(SIN(R4C2)*SIN(R2C)+COS(R4C2)*COS(R2C)*COS(R3C-R4C3)),"""")"
    Range("N6:SS6").Value = Range("N6:SS6").Value
    Range("M6").FormulaR1C1 = "=MAX(RC[1]:RC[500])"
    Range("M6").Value = Range("M6").Value
    
    'Starts
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("G10").FormulaR1C1 = _
            "=IF(AND(RC[-6]<R2C1,RC[-6]>=R1C1-R8C1,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))<=R6C13),RC[-6],"""")"
    Else:
        Range("G10").FormulaR1C1 = _
            "=IF(AND(RC[-6]<R3C1,RC[-6]>=R2C1-R8C1,6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4]))<=R6C13),RC[-6],"""")"
    End If

    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R4C2)+COS(RC[-4])*COS(R4C2)*COS(R4C3-RC[-3])),"""")"
    'CopyRef A Value Sort
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'Matrix
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9,R6C[1]<R6C),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,SQRT(RC12^2+0.25)<=R2C),"""",R6C+RC12))"
    
    'Copy Ref G Value
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:SS3009").Value = Range("N10:SS3009").Value
    
    Range("J6").FormulaR1C1 = "=MAX(R[4]C[4]:R[3003]C[503])"
    Range("J6").Value = Range("J6").Value
    Range("N7:SS7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R6C10,R[-6]C,"""")"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R6C10,RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M3009").Value = Range("M10:M3009").Value
    
    Range("N8:SS11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    'Range("N10:SS12").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-7]C,"""")"
    
    Range("H7").FormulaR1C1 = "=MAX(RC[6]:RC[505])"
    Range("I7").FormulaR1C1 = "=MAX(R[1]C[5]:R[1]C[504])"
    Range("J7").FormulaR1C1 = "=MAX(R[2]C[4]:R[2]C[503])"
    Range("K7").FormulaR1C1 = "=MAX(R[3]C[3]:R[3]C[502])"
    Range("L7").FormulaR1C1 = "=MAX(R[4]C[2]:R[4]C[501])"
    Range("H7:L7").Value = Range("H7:L7").Value
    
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("H6:L6").FormulaR1C1 = "=MAX(R[4]C[5]:R[3003]C[5])"
    Range("H6:L6").Value = Range("H6:L6").Value
    
    Columns("N:SS").Clear
    Range("M6,G8:M10009").Clear

    'Select Tri FINI + 2 fixes before, 2 fixes after
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R7C8,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("A4:E4").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H6:L6").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H8").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I8").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I8").Value = Range("I8").Value
    Sheets("Sheet2").Range("K8:L8").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear
    
    Range("M8").FormulaR1C1 = _
        "=IF(RC[-5]=""NO FIN LINE"","""",IF(R[-2]C[-2]-RC[-2]>R9C4,R[-2]C[-7]-((R[-2]C[-2]-RC[-2]-R9C4)*0.1),R[-2]C[-7]))"
    Range("M8").Value = Range("M8").Value

    Application.Run "F.xlsm!YDWK3clear"

End Sub
Sub TriFLine2a()
'
' amended 3/21/14; amended 11/3/14 for 2-TP Triangles
'
Application.ScreenUpdating = False
    Range("G10:R10009").Clear
    Range("A8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("B8").FormulaR1C1 = "=IF(AND(R8C1-R5C1<0.0208333333333333,SECOND(R[3]C[-1]-R[2]C[-1])>=4),0.0208333333333333,0.010416666666666)"
    Range("A8:B8").Value = Range("A8:B8").Value
    
    Range("G8").FormulaR1C1 = "=SMALL(R[2]C[-1]:R[10001]C[-1],500)"
    
    Range("F10").FormulaR1C1 = "=IF(AND(RC[-5]>=R5C1-R8C2,RC[-5]<=R5C1+R8C2),ABS(R5C1-RC[-5]),"""")"
    Range("G10").FormulaR1C1 = "=IF(RC[-1]<R8C7,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value CLEAR F10:F10009 Sort
    
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("F10:K10").AutoFill Destination:=.Range("F10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    On Error Resume Next
        Range("G8").FormulaR1C1 = "=MAX(R[2]C[-1]:R[10001]C[-1])"
    
    Range("F10:K10009").Value = Range("F10:K10009").Value
    Range("G8,F10:F10009").Clear
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("G10:K509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("G10:K10009").Clear
    
    Range("N6:SS6").FormulaR1C1 = "=IF(R[-5]C<>"""",6371*ACOS(SIN(R[-4]C)*SIN(R4C2)+COS(R[-4]C)*COS(R4C2)*COS(R4C3-R[-3]C)),"""")"

    Range("B8").Value = 2.08333333333333E-02
   
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C1-R8C2,RC[-6]<=R1C1+R8C2),RC[-6],"""")"
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R2C1-R8C2,RC[-6]<=R2C1+R8C2),RC[-6],"""")"
    End If
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R4C2)+COS(RC[-4])*COS(R4C2)*COS(R4C3-RC[-3])),"""")"
    'Copy Ref A Value Sort
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'MATRIX
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9,R6C[1]<R6C),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,SQRT(RC12^2+0.25)<=R2C),"""",IF(RC10-R4C>R9C4,(R6C+RC12)-((RC10-R4C-R9C4)*0.1),R6C+RC12)))"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("J6").FormulaR1C1 = "=MAX(R[4]C[4]:R[10003]C[503])"
    Range("J6").Value = Range("J6").Value
    
    Range("N7:SS7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R6C10,R[-6]C,"""")"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R6C10,RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M3009").Value = Range("M10:M3009").Value
    Range("N10:SS10009").Clear
    Range("N8:SS11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    
    Range("H7").FormulaR1C1 = "=MAX(R7C[6]:R7C[505])"
    Range("I7").FormulaR1C1 = "=MAX(R8C[5]:R8C[504])"
    Range("J7").FormulaR1C1 = "=MAX(R9C[4]:R9C[503])"
    Range("K7").FormulaR1C1 = "=MAX(R10C[3]:R10C[502])"
    Range("L7").FormulaR1C1 = "=MAX(R11C[2]:R11C[501])"
    Range("H7:L7").Value = Range("H7:L7").Value
    
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref G
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("H6:L6").FormulaR1C1 = "=MAX(R10C[5]:R3009C[5])"
    Range("H6:L6").Value = Range("H6:L6").Value
    
    Columns("N:SS").Clear
    Range("A8,B8,G8:M10009").Clear
  
    'Select Tri FINI + 2 fixes before, 2 fixes after
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R7C8,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("A4:E4").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H6:L6").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H8").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I8").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I8").Value = Range("I8").Value
    Sheets("Sheet2").Range("K8:L8").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear
    
    Application.Run "F.xlsm!YDWK3clear"
    'Amended 11/3:
    If Range("A1") <> "This is a 2-Turn Point Triangle" Then
        Range("M8").FormulaR1C1 = _
            "=IF(RC[-5]=""NO FIN LINE"","""",IF(R[-2]C[-2]-RC[-2]>R9C4,R[-2]C[-7]-((R[-2]C[-2]-RC[-2]-R9C4)*0.1),R[-2]C[-7]))"
        Range("M8").Value = Range("M8").Value
    
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Range("N6").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[-3]C[-12])+COS(RC[-5])*COS(R[-3]C[-12])*COS(R[-3]C[-11]-RC[-4]))"
        Range("N7").FormulaR1C1 = "=R[-4]C[-8]"
        Range("N8").FormulaR1C1 = "=6371*ACOS(SIN(R[-4]C[-12])*SIN(R[-1]C[-5])+COS(R[-4]C[-12])*COS(R[-1]C[-5])*COS(R[-1]C[-4]-R[-4]C[-11]))"
        Range("O8").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
        Range("O9").FormulaR1C1 = "=IF(R[-3]C[-4]-R[-1]C[-4]<=RC[-11],R[-1]C,R[-1]C-((R[-3]C[-4]-R[-1]C[-4]-RC[-11])*0.1))"
        Range("P8").FormulaR1C1 = "=IF(MIN(R[-2]C[-2]:RC[-2])>=0.28*R[1]C[-1],""OK"",""NOPE"")"
        
       If Range("P8") = "OK" Then
            Range("M8").Value = Range("O9").Value
            Range("N6:P9").Clear
        ElseIf Range("P8") = "NOPE" Then
            'Range("E7").Value = "NONE IDENTIFIED"  or M8=""??
            Range("N6:P9").Clear
        End If
    End If
End Sub

Sub TriH10()
'
' Moves data to H10
'
Application.ScreenUpdating = False
If Range("P1") = "A1" And Range("E8") = "" Then
   If Range("A1") <> "This is a 2-Turn Point Triangle" Then
       Range("H10:L13").Value = Range("A1:E4").Value
       Range("M11:M13").Value = Range("F2:F4").Value
       Range("H14:L14").Value = Range("A6:E6").Value
       Range("M14").Value = Range("F7").Value
   ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
       Range("H10:L12").Value = Range("A2:E4").Value
       Range("H13:L13").Value = Range("A6:E6").Value
       Range("M10:M12").Value = Range("F2:F4").Value
       Range("M13").Value = Range("F7").Value
    End If

ElseIf Range("P1") = "A1" And Range("E8") <> "" And Range("A1") <> "This is a 2-Turn Point Triangle" Then
       Range("H10:L13").Value = Range("A1:E4").Value
       Range("H14:L14").Value = Range("A6:E6").Value
       Range("M11:M13").Value = Range("F2:F4").Value
       Range("M14").Value = Range("F7").Value
       Range("H15").Value = "No record-eligible Triangle found. Great Circle distances are shown in red above"
        
ElseIf Range("P1") = "H1" And Range("E8") = "" Then
   If Range("A1") <> "This is a 2-Turn Point Triangle" Then
       Range("H10:L10").Value = Range("H1:L1").Value
       Range("H11:L13").Value = Range("A2:E4").Value
       Range("M11:M13").Value = Range("F2:F4").Value
       Range("M14").Value = Range("M5").Value

       If Range("M4") = "SECTOR" And Range("H3") = "NO FIN LINE" Then
            Range("H14").Value = Range("H4").Value
            Range("I14").Value = "    FINISH SECTOR"
            Range("K14:L14").Value = Range("K4:L4").Value
       ElseIf Range("I4") = "        FINISH LINE" Then
            Range("H14").Value = Range("H3").Value
            Range("I14").Value = Range("I4").Value
            Range("K14:L14").Value = Range("K3:L3").Value
       End If
    
    ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
        Range("H10:L10").Value = Range("H1:L1").Value
        Range("H11:L12").Value = Range("A3:E4").Value
        Range("M10:M12").Value = Range("F2:F4").Value
        Range("M13").Value = Range("F7").Value
        
        If Range("M4") = "SECTOR" And Range("H3") = "NO FIN LINE" Then
            Range("H13").Value = Range("H4").Value
            Range("I13").Value = "    FINISH SECTOR"
            Range("K13:L13").Value = Range("K4:L4").Value
        ElseIf Range("I3") = "        FINISH LINE" Then
            Range("H13").Value = Range("H3").Value
            Range("I13").Value = "        FINISH LINE"
            Range("K13:L13").Value = Range("K3:L3").Value
        End If
    End If

ElseIf Range("P1") = "H1" And Range("M4") = "SECTOR" And Range("E8") <> "" And Range("A1") <> "This is a 2-Turn Point Triangle" Then
    Range("H10:L10").Value = Range("H1:L1").Value
    Range("H11:L13").Value = Range("A2:E4").Value
    Range("M11:M13").Value = Range("F2:F4").Value
    Range("M14").Value = Range("F7").Value
    Range("H14").Value = Range("H4").Value
    Range("I14").Value = "    FINISH SECTOR"
    Range("K14:L14").Value = Range("K4:L4").Value
    Range("H15").Value = "No record-eligible Triangle found. Great Circle distances are shown in red above"
    
ElseIf Range("P1") = "H6" And Range("E8") = "" Then
  If Range("A1") <> "This is a 2-Turn Point Triangle" Then
    Range("H10:L10").Value = Range("H6:L6").Value
    Range("H11:L13").Value = Range("A2:E4").Value
    Range("M11:M13").Value = Range("F2:F4").Value
    Range("H14:L14").Value = Range("H8:L8").Value
    Range("M14").Value = Range("M8").Value
  ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
    Range("H10:L10").Value = Range("H6:L6").Value
    Range("H11:L12").Value = Range("A3:E4").Value
    Range("H13:L14").Value = Range("H7:L8").Value
    Range("M13").Value = Range("M8").Value
  End If
End If

If Range("A9") <> "REF" Then
    Sheets("Sheet3").Range("A9:E10009").Value = Sheets("Sheet2").Range("A9:E10009").Value
    Application.Run "F.xlsm!TriREF2"
    Sheets("Sheet3").Columns("A:E").Clear
ElseIf Range("A9") = "REF" Then
    Application.Run "F.xlsm!TriREF2"
End If

End Sub
Sub TriREF2()
'
' Cks triangle @ sheet 3 +/- 3 minutes Amended 9/3/14 for 2-TP triangles
'
Application.ScreenUpdating = False
    Sheets("Sheet3").Range("A1:G5").Value = Sheets("Sheet2").Range("H10:N14").Value
    Sheets("Sheet3").Activate
    Range("A8").Value = 2.08333333333333E-03
    
  If Range("A5") <> "" Then
    Range("G2:G3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[1]C[-5])+COS(RC[-5])*COS(R[1]C[-5])*COS(R[1]C[-4]-RC[-4]))"
    Range("G4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-5])*SIN(R[-2]C[-5])+COS(RC[-5])*COS(R[-2]C[-5])*COS(R[-2]C[-4]-RC[-4]))"
    Range("H4").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
    Range("G2:H4").Value = Range("G2:H4").Value
    Range("G10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-6]>=R2C1-R8C1,RC[-6]<=R2C1+R8C1),AND(RC[-6]>=R3C1-R8C1,RC[-6]<=R3C1+R8C1),AND(RC[-6]>=R4C1-R8C1,RC[-6]<=R4C1+R8C1)),RC[-6],"""")"
  ElseIf Range("A5") = "" Then
    Range("G2").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-5])*SIN(RC[-5])+COS(R[-1]C[-5])*COS(RC[-5])*COS(RC[-4]-R[-1]C[-4]))"
    Range("G3").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-5])*SIN(RC[-5])+COS(R[-1]C[-5])*COS(RC[-5])*COS(RC[-4]-R[-1]C[-4]))"
    Range("G4").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-5])*SIN(R[-3]C[-5])+COS(R[-1]C[-5])*COS(R[-3]C[-5])*COS(R[-3]C[-4]-R[-1]C[-4]))"
    Range("G2:H4").Value = Range("G2:H4").Value
    Range("G10").FormulaR1C1 = "=IF(OR(AND(RC[-6]>=R2C1-R8C1,RC[-6]<=R2C1+R8C1),AND(RC[-6]>=R3C1-R8C1,RC[-6]<=R3C1+R8C1)),RC[-6],"""")"
  End If
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L7").FormulaR1C1 = "=IF(R5C1<>"""",R4C1-R8C1,R3C1-R8C1)"
    Range("L8").FormulaR1C1 = "=IF(R5C1<>"""",R3C1+R8C1,R2C1+R8C1)"
    Range("L9").FormulaR1C1 = "=R2C1+R8C1"
    
    'Range("L10").FormulaR1C1 = _
        "=IF(AND(R5C1<>"""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R3C2)+COS(RC[-4])*COS(R3C2)*COS(R3C3-RC[-3])),IF(AND(R5C1="""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R1C2)+COS(RC[-4])*COS(R1C2)*COS(R1C3-RC[-3])),""""))"
    'Range("M10").FormulaR1C1 = _
        "=IF(AND(RC[-1]<>"""",R5C1<>""""),6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4])),IF(AND(RC[-1]<>"""",R5C1=""""),6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(R3C3-RC[-4])),""""))"
    'Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-2]+RC[-1]+R3C7,"""")"
    'Copy Ref G
    'Application.Calculation = xlCalculationManual
    'With Worksheets("Sheet3")
    'LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
'.Range("L10:N10").AutoFill Destination:=.Range("L10:N" & LastRow), Type:=xlFillDefault
    'End With
'Application.Calculation = xlCalculationAutomatic
    
    Range("P9:U9").FormulaR1C1 = "=MAX(R[1]C:R[10000]C)"
    
    'TP1
    Range("L10").FormulaR1C1 = _
        "=IF(AND(R5C1<>"""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R3C2)+COS(RC[-4])*COS(R3C2)*COS(R3C3-RC[-3])),IF(AND(R5C1="""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R1C2)+COS(RC[-4])*COS(R1C2)*COS(R1C3-RC[-3])),""""))"
    Range("M10").FormulaR1C1 = _
        "=IF(AND(RC[-1]<>"""",R5C1<>""""),6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4])),IF(AND(RC[-1]<>"""",R5C1=""""),6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(R3C3-RC[-4])),""""))"
    Range("N10").FormulaR1C1 = "=IF(AND(R5C1<>"""",RC[-1]<>""""),R3C7,IF(AND(R5C1="""",RC[-1]<>""""),R4C7,""""))"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",SUM(RC[-3]:RC[-1]),"""")"
    Range("P10").FormulaR1C1 = _
        "=IF(RC[-1]="""","""",IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],""""))"
    ''Range("L10").FormulaR1C1 = _
        "=IF(AND(R5C1<>"""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R3C2)+COS(RC[-4])*COS(R3C2)*COS(R3C3-RC[-3])),IF(AND(R5C1="""",RC[-5]<R9C12),6371*ACOS(SIN(RC[-4])*SIN(R1C2)+COS(RC[-4])*COS(R1C2)*COS(R1C3-RC[-3])),""""))"
    ''Range("M10").FormulaR1C1 = _
        "=IF(AND(RC[-1]<>"""",R5C1<>""""),6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4])),IF(AND(RC[-1]<>"""",R5C1=""""),6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(R3C3-RC[-4])),""""))"
    ''Range("N10").FormulaR1C1 = "=IF(AND(R5C1<>"""",RC[-1]<>""""),RC[-2]+RC[-1]+R3C7,IF(AND(R5C1="""",RC[-1]<>""""),RC[-2]+RC[-1]+R4C7,""""))"
    ''Range("O10").FormulaR1C1 = "=IF(AND(R5C1<>"""",RC[-1]<>""""),SUM(RC[-3]:RC[-1]),IF(R5C1="""",RC[-1],""""))"
    'Range("L10").FormulaR1C1 = "=IF(RC[-5]<=R9C12,6371*ACOS(SIN(RC[-4])*SIN(R3C2)+COS(RC[-4])*COS(R3C2)*COS(R3C3-RC[-3])),"""")"
    'Range("M10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4])),"""")"
    'Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",R3C7,"""")"
    'Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",SUM(RC[-3]:RC[-1]),"""")"
    'Range("P10").FormulaR1C1 = _
        "=IF(RC[-1]="""","""",IF(OR(AND(RC[-1]<750,MIN(RC[-4]:RC[-2])>=0.28*RC[-1]),AND(RC[-1]>=750,MIN(RC[-4]:RC[-2])>=0.25*RC[-1],MAX(RC[-4]:RC[-2])<=0.45*RC[-1])),RC[-1],""""))"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R9C16,RC[-10],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-10],"""")"
    'Copy Ref G
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:U10").AutoFill Destination:=.Range("L10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P2:T2").Value = Range("Q9:U9").Value
  
  If Range("A5") = "" Then
         Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R1C2)+COS(RC[-4])*COS(R1C2)*COS(R1C3-RC[-3]))"
  ElseIf Range("A5") <> "" Then
    'TP2 of 3
    Range("L10").FormulaR1C1 = "=IF(AND(RC[-5]>R2C16,RC[-5]<=R8C12),6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3])),"""")"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-5])*SIN(R4C2)+COS(RC[-5])*COS(R4C2)*COS(R4C3-RC[-4])),"""")"
    Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(R4C2)*SIN(R2C17)+COS(R4C2)*COS(R2C17)*COS(R2C18-R4C3)),"""")"
    'Copy Ref G
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:N10").AutoFill Destination:=.Range("L10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P3:T3").Value = Range("Q9:U9").Value
    Range("U2").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    Range("U2").Value = Range("U2").Value
  End If
  
    'Last TP
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-5]>=R7C12,6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3])),"""")"
    Range("M10").FormulaR1C1 = _
        "=IF(AND(R5C1<>"""",RC[-1]<>""""),6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4])),IF(AND(R5C1="""",RC[-1]<>""""),6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4])),""""))"
    Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",R2C21,"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",SUM(RC[-3]:RC[-1]),"""")"
    'Range("L10").FormulaR1C1 = "=IF(RC[-5]>=R7C12,6371*ACOS(SIN(RC[-4])*SIN(R2C17)+COS(RC[-4])*COS(R2C17)*COS(R2C18-RC[-3])),"""")"
    'Range("M10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4])),"""")"
    'Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",R2C21,"""")"
    'Copy Ref G
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:O10").AutoFill Destination:=.Range("L10:O" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P4:T4").Value = Range("Q9:U9").Value
    
  If Range("A5") <> "" Then
    Range("U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
    
  ElseIf Range("A5") = "" Then
    Range("P1").Value = "This is a 2-Turn Point Triangle"
    Range("P3:T3").Value = Range("P2:T2").Value
    Range("P2:T2").Value = Range("A1:E1").Value
    Range("P5:T5").Value = Range("A4:E4").Value
    Range("U2:U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[1]C[-4])+COS(RC[-4])*COS(R[1]C[-4])*COS(R[1]C[-3]-RC[-3]))"
  End If
    
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-2]C[-4])+COS(RC[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-RC[-3]))"
    Range("V4").FormulaR1C1 = "=SUM(R[-2]C[-1]:RC[-1])"
    Range("W5").FormulaR1C1 = _
        "=IF(OR(AND(R[-1]C[-1]<750,MIN(R[-3]C[-2]:R[-1]C[-2])>=0.28*R[-1]C[-1]),AND(R[-1]C[-1]>=750,MIN(R[-3]C[-2]:R[-1]C[-2])>=0.25*R[-1]C[-1],MAX(R[-3]C[-2]:R[-1]C[-2])<=0.45*R[-1]C[-1])),""OK"",""NOPE"")"
    'Range("W5").Value = Range("W5").Value
    Range("U2:W5").Value = Range("U2:W5").Value
    
  If Range("W5") = "NOPE" Then
    Range("G5").Value = Range("F5").Value
    Range("P2:W5,G7:U10009").Clear
  
  ElseIf Range("W5") = "OK" Then
    Range("H2:L4").Value = Range("P2:T4").Value

    Range("G7:U10009").Clear
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("I3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("J3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("M2").Value = Sheets("YDWK3").Range("F37").Value

    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("M3").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("I2").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("J2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("M4").Value = Sheets("YDWK3").Range("F37").Value
    
    Range("N5").FormulaR1C1 = _
        "=IF(OR(AND(RC[-10]<>"""",R[-4]C[-10]-RC[-10]<=R9C4),AND(RC[-10]="""",R[-4]C[-10]-R[-1]C[-10]<=R9C4)),SUM(R[-3]C[-1]:R[-1]C[-1]),IF(RC[-10]<>"""",SUM(R[-3]C[-1]:R[-1]C[-1])-(R[-4]C[-10]-RC[-10]-R9C4)*0.1,SUM(R[-3]C[-1]:R[-1]C[-1])-(R[-4]C[-10]-R[-1]C[-10]-R[4]C[-10])*0.1))"
    'Range("N5").FormulaR1C1 = _
        "=IF(R[-4]C[-10]-RC[-10]<=R9C4,SUM(R[-3]C[-1]:R[-1]C[-1]),SUM(R[-3]C[-1]:R[-1]C[-1])-((R[-4]C[-10]-RC[-10]-R9C4)*0.1))"
    Range("N5").Value = Range("N5").Value

    Range("G2:G4").Clear
    
    If Range("N5") > Range("F5") Then
      If Range("A5") <> "" Then
        Range("A2:F4").Value = Range("H2:M4").Value
      Else:
        Range("A5:E5").Value = Range("A4:E4").Value
        Range("A2:F4").Value = Range("H2:M4").Value
        Range("A1:F1").Clear
        Range("A1").Value = "This is a 2-Turn Point Triangle"
      End If
      Range("F5").Value = Range("N5").Value
    End If
 End If
    Range("G6").FormulaR1C1 = _
        "=IF(R[-1]C[-1]<750,MIN(R[-4]C[-1]:R[-2]C[-1])-(0.28*R[-1]C[-1]),MIN(R[-4]C[-1]:R[-2]C[-1])-(0.25*R[-1]C[-1]))"
    Range("G6").Value = Range("G6").Value
        
If Range("G6") < 0.6 And Range("A1") <> "This is a 2-Turn Point Triangle" Then
    'Expamd to 2 up, 2 dn
    Range("G10").FormulaR1C1 = "=IF(OR(R[-2]C[-6]=R2C1,R[-1]C[-6]=R2C1,R[1]C[-6]=R2C1,R[2]C[-6]=R2C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Expand to two up, two down
    Range("M10").FormulaR1C1 = "=IF(OR(R[-2]C[-12]=R3C1,R[-1]C[-12]=R3C1,R[1]C[-12]=R3C1,R[2]C[-12]=R3C1),RC[-12],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    'Expand to 2 up, 2 dn
    Range("S10").FormulaR1C1 = "=IF(OR(R[-2]C[-18]=R4C1,R[-1]C[-18]=R4C1,R[1]C[-18]=R4C1,R[2]C[-18]=R4C1),RC[-18],"""")"
    Range("T10:W10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-18],"""")"
    'Copy Ref A
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:W10").AutoFill Destination:=.Range("G10:W" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:W60009").Value = Range("G10:W60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("M10:Q60009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("S10:W60009").Sort Key1:=Range("S10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("G15:G16").Value = Range("G10:G11").Value
    Range("G18:G19").Value = Range("G12:G13").Value
    Range("M15:M16").Value = Range("M10:M11").Value
    Range("M18:M19").Value = Range("M12:M13").Value
    Range("S15:S16").Value = Range("S10:S11").Value
    Range("S18:S19").Value = Range("S12:S13").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I3").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J3").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("H15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("H16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("H18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("H19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I3").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J3").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("T15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("T16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("T18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("T19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("N15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("N16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("N18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("N19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J4").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("I15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("I16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("I18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("H13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("I13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("I19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J4").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("O15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("O16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("O18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("N13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("O13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("O19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("I2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("J2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T10").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U10").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("U15").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U11").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("U16").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T12").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U12").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("U18").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("T13").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("U13").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("U19").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Activate
    Range("E39:E42").Value = 0
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Activate
    Range("J15:J16").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R3C6)"
    Range("J18:J19").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R3C6)"
    Range("P15:P16").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R4C6)"
    Range("P18:P19").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R4C6)"
    Range("V15:V16").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R2C6)"
    Range("V18:V19").FormulaR1C1 = "=SUM(RC[-2],RC[-1],R2C6)"
    
    Range("J15:J19").Value = Range("J15:J19").Value
    Range("P15:P19").Value = Range("P15:P19").Value
    Range("V15:V19").Value = Range("V15:V19").Value
    
    Range("K15:K16").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R3C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R3C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R3C6)<=0.45*RC[-1])),""OK"",""NO"")"
    Range("K18:K19").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R3C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R3C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R3C6)<=0.45*RC[-1])),""OK"",""NO"")"
    Range("Q15:Q16").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R4C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R4C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R4C6)<=0.45*RC[-1])),""OK"",""NO"")"
    Range("Q18:Q19").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R4C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R4C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R4C6)<=0.45*RC[-1])),""OK"",""NO"")"
    Range("W15:W16").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R2C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R2C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R2C6)<=0.45*RC[-1])),""OK"",""NO"")"
    Range("W18:W19").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]<750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R2C6)>=0.28*RC[-1]),AND(RC[-1]>=750,RC[-1]>R5C6,MIN(RC[-3],RC[-2],R2C6)>=0.25*RC[-1],MAX(RC[-3],RC[-2],R2C6)<=0.45*RC[-1])),""OK"",""NO"")"
    
    Range("G15:K19").Value = Range("G15:K19").Value
    Range("G20:K24").Value = Range("M15:Q19").Value
    'Range("M14:Q16").Clear
    Range("G25:K29").Value = Range("S15:W19").Value
    'Range("S14:W16").Clear
    
    Range("G15:K29").Sort Key1:=Range("G15"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("M15:W19").Clear
    
    Range("L15:L26").FormulaR1C1 = "=IF(RC[-1]=""OK"",RC[-5],"""")"
    Range("M15:P18").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-5]C[-5],"""")"
    Range("M19:P22").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-9]C[1],"""")"
    Range("M23:P26").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-13]C[7],"""")"
    
    Range("Q15:Q26").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    Range("R15:R26").FormulaR1C1 = "=IF(RC[-1]=MAX(R15C[-1]:R26C[-1]),1,"""")"
    Range("L15:R26").Value = Range("L15:R26").Value
    
    Range("L15:R26").Sort Key1:=Range("R15"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("N2").FormulaR1C1 = "=IF(OR(R[13]C[-2]=R[8]C[-7],R[13]C[-2]=R[9]C[-7],R[13]C[-2]=R[10]C[-7],R[13]C[-2]=R[11]C[-7]),R[13]C[-2],RC[-6])"
    Range("O2").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("P2").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("Q2").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("R2").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    
    Range("N3").FormulaR1C1 = "=IF(OR(R[12]C[-2]=R[7]C[-1],R[12]C[-2]=R[8]C[-1],R[12]C[-2]=R[9]C[-1],R[12]C[-2]=R[10]C[-1]),R[12]C[-2],RC[-6])"
    Range("O3").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("P3").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("Q3").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("R3").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    
    Range("N4").FormulaR1C1 = "=IF(OR(R[11]C[-2]=R[6]C[5],R[11]C[-2]=R[7]C[5],R[11]C[-2]=R[8]C[5],R[11]C[-2]=R[9]C[5]),R[11]C[-2],RC[-6])"
    Range("O4").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("P4").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("Q4").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    Range("R4").FormulaR1C1 = "=IF(RC14=R15C12,R15C[-2],RC[-6])"
    
    Range("N2:R4").Value = Range("N2:R4").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("O2").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("P2").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("O3").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("P3").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S2").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Sheet3").Range("O4").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Sheet3").Range("P4").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S3").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E41").Value = Sheets("Sheet3").Range("O2").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Sheet3").Range("P2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S4").Value = Sheets("YDWK3").Range("F37").Value
    
    Application.Run "F.xlsm!YDWK3clear"
    Sheets("Sheet3").Activate
    
    Range("S5").FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
    Range("S6").FormulaR1C1 = "=IF(R[-5]C[-15]-R[-1]C[-15]<=R9C4,R[-1]C,R[-1]C-((R[-5]C[-15]-R[-1]C[-15]-R9C4)*0.1))"
    Range("S5:S6").Value = Range("S5:S6").Value
    If Range("S6") > Range("F5") Then
        Range("A2:F4").Value = Range("N2:S4").Value
        Range("F5").Value = Range("S6").Value
    End If
    
End If
 
 If Range("A1") <> "This is a 2-Turn Point Triangle" Then
    Sheets("Sheet2").Range("H16:M20").Value = Sheets("Sheet3").Range("A1:F5").Value
 ElseIf Range("A1") = "This is a 2-Turn Point Triangle" Then
    Sheets("Sheet2").Range("H16:M19").Value = Sheets("Sheet3").Range("A2:F5").Value
 End If
    Columns("G:W").Clear
    Range("A1:F8").Clear
    Sheets("Sheet2").Activate
End Sub




-------------------------------------------------------------------------------
VBA MACRO Module3.bas 
in file: F_vbaProject.bin - OLE stream: 'VBA/Module3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
#If VBA7 And Win64 Then
    Dim LastRow As LongPtr
#Else
    Dim LastRow As Long
#End If

Sub ORDS()
'
' Works for Ramy 06
'
  Application.ScreenUpdating = False
    Range("A8:C8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("B7:C7").FormulaR1C1 = "=MIN(R[3]C:R[10002]C)"
   
    Range("G10").FormulaR1C1 = _
        "=IF(OR(RC[-6]=R8C1,RC[-5]=R7C2,RC[-5]=R8C2,RC[-4]=R7C3,RC[-4]=R8C3),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    'Remove ords within 2 minutes & 1km of each other
    Range("A7").Value = 1.38888888888889E-03
    Range("L11:L21").FormulaR1C1 = "=IF(RC[-5]<>"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    Range("M10:Q10").Value = Range("G10:K10").Value
    Range("F11:F21").FormulaR1C1 = _
        "=IF(AND(RC[1]<>"""",RC[1]-R[-1]C[1]<R7C[-5],RC[6]<=1),""X"","""")"
    Range("M11:M21").FormulaR1C1 = "=IF(AND(RC[-7]<>""X"",RC[-6]<>""""),RC[-6],"""")"
    Range("N11:Q21").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    ActiveSheet.Calculate
    Range("M10:Q21").Value = Range("M10:Q21").Value
    Range("M10:Q21").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("R11:R21").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    ActiveSheet.Calculate
    Range("A1:F5").Value = Range("M10:R14").Value
    Range("F6").FormulaR1C1 = "=SUM(R[-5]C:R[-1]C)"
    Range("F7").FormulaR1C1 = _
        "=IF(AND(R[-2]C[-2]<>"""",R[-6]C[-2]-R[-2]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),IF(AND(R[-2]C[-2]="""",R[-6]C[-2]-R[-3]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-3]C[-2]-R9C4)*0.1),IF(AND(R[-2]C[-2]="""",R[-3]C[-2]="""",R[-6]C[-2]-R[-4]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-4]C[-2]-R9C4)*0.1),R[-1]C)))"
    ActiveSheet.Calculate
    Range("F6:F7").Value = Range("F6:F7").Value
    Range("A7:C8,F10:R21").Clear
    Sheets("Tasks").Range("A40:E43").Value = Sheets("Sheet2").Range("A1:E4").Value
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R1C[-6],6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G8:L8").Value = Range("G8:L8").Value
    
  If Range("G8") > Range("F5") Then
    Range("A6:E6").Value = Range("H8:L8").Value
    Range("A5:E5").Clear
    Range("A1:E6").Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("F2:F5").FormulaR1C1 = _
        "=IF(RC[-5]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3])),"""")"
    Range("F6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("F7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("F2:F7").Value = Range("F2:F7").Value
  End If
    Columns("G:L").Clear

    Sheets("Sheet2").Range("A8").Value = Sheets("Tasks").Range("J11").Value
    Range("A7").FormulaR1C1 = "=MAX(R2C6:R5C6)"
      
 If Range("A7") < Range("A8") Then
    Application.Run "F.xlsm!Ordsa"

 ElseIf Range("A7") >= Range("A8") Then
 
    Range("G2").FormulaR1C1 = "=IF(RC[-1]=MIN(R2C6:R5C6),""A1"","""")"
    Range("G3").FormulaR1C1 = "=IF(RC[-1]=MIN(R2C6:R5C6),""A2"","""")"
    Range("G4").FormulaR1C1 = "=IF(RC[-1]=MIN(R2C6:R5C6),""A3"","""")"
    Range("G5").FormulaR1C1 = "=IF(RC[-1]=MIN(R2C6:R5C6),""A4"","""")"
    
    If Range("G2") = "A1" Then
        Range("H2:L2").Value = Range("A1:E1").Value
        Range("P1:T1").Value = Range("A1:E1").Value
        Range("P3:T4").Value = Range("A3:E4").Value
        Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R1C1,RC[-6]<R3C1),6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(RC[-4]-R1C3)),"""")"
    ElseIf Range("G3") = "A2" Then
        Range("H2:L2").Value = Range("A2:E2").Value
        Range("P1:T2").Value = Range("A1:E2").Value
        Range("P4:T4").Value = Range("A4:E4").Value
        Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R2C1,RC[-6]<R4C1),6371*ACOS(SIN(RC[-5])*SIN(R2C2)+COS(RC[-5])*COS(R2C2)*COS(RC[-4]-R2C3)),"""")"
    ElseIf Range("G4") = "A3" Then
        Range("H2:L2").Value = Range("A3:E3").Value
        Range("P1:T3").Value = Range("A1:E3").Value
        Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R3C1,RC[-6]<R5C1),6371*ACOS(SIN(RC[-5])*SIN(R3C2)+COS(RC[-5])*COS(R3C2)*COS(RC[-4]-R3C3)),"""")"
    End If
    ActiveSheet.Calculate
    If Range("G5") = "A4" Then
        Range("A1:G7").Clear
        Application.Run "F.xlsm!TP3a"
    ElseIf Range("G5") <> "A4" Then
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("H3:L3").Value = Range("H8:L8").Value
    
    Range("G8:L10009").Clear
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    'MAXIMUM off course after Selected ORD
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C[3],"""",IF(AND(RC1>R2C[1],RC1<R3C[1]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    If Range("G2") = "A1" Then
        Range("P2:T2").Value = Range("J8:N8").Value
    ElseIf Range("G3") = "A2" Then
        Range("P3:T3").Value = Range("J8:N8").Value
    ElseIf Range("G4") = "A3" Then
        Range("P4:T4").Value = Range("J8:N8").Value
    End If
    
    Range("G10:N10009").Clear
    Range("U2:U4").FormulaR1C1 = "=IF(SUM(RC[-5]:RC[-1])>0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
         "=IF(RC[-6]>R4C16,6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P5:T5").Value = Range("H8:L8").Value
   
    Range("U5").FormulaR1C1 = _
        "=IF(AND(SUM(RC[-5]:RC[-1])>0,SUM(R[-1]C[-5]:R[-1]C[-1])>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
    Range("G8:L10009").Clear
    Range("O2").FormulaR1C1 = "=IF(OR(RC[1]<R[-1]C[1],R[1]C[1]<RC[1],R[2]C[1]<R[1]C[1]),""NO"","""")"
    ActiveSheet.Calculate
    If Range("O2") = "NO" Then
        Range("O1:U7").Clear
    End If
 End If
    
    Application.Run "F.xlsm!ORDS1"
    Application.Run "F.xlsm!ORDS3"
    Application.Run "F.xlsm!ORDS2"
  
  If Range("U7") > Range("F7") Then
    Range("A1:E5").Value = Range("P1:T5").Value
    Range("F2:F7").Value = Range("U2:U7").Value
  End If
 End If
    
    Range("G2:L5,A7:E8,O1:U7").Clear
  
  Application.Run "F.xlsm!DH"
  Application.Run "F.xlsm!XCA"
  Application.Run "F.xlsm!ORDS4"
  Application.Run "F.xlsm!AllOrds"
  Application.Run "F.xlsm!TP3a"
  Application.Run "F.xlsm!TriZords"
  Application.Run "F.xlsm!Serk"
  Application.Run "F.xlsm!Essex"
  Application.Run "F.xlsm!Siba"
  
 If Range("F7") < Range("F6") Then
   Application.Run "F.xlsm!ORDS5"
 End If

    Application.Run "F.xlsm!CK3TP"
    Application.Run "F.xlsm!ORDS5"
  
  If Range("A9") = "REF" Then
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A1:F7").Value = Sheets("Sheet2").Range("A1:F7").Value
    Application.Run "F.xlsm!CK3TP"
    Application.Run "F.xlsm!ORDS5a"
    Sheets("Sheet2").Range("H7").Value = Sheets("Sheet3").Range("F7").Value
    Sheets("Sheet2").Activate
    If Range("H7") > Range("F7") Then
        Sheets("Sheet2").Range("A1:F7").Value = Sheets("Sheet3").Range("A1:F7").Value
    End If
    Sheets("Sheet2").Range("H7").Clear
  End If
  
   Sheets("Tasks").Activate
   Sheets("Tasks").Range("C20:E24").Value = Sheets("Sheet2").Range("A1:C5").Value
   Sheets("Tasks").Range("H20:I24").Value = Sheets("Sheet2").Range("D1:E5").Value
   Sheets("Tasks").Range("J24").Value = Sheets("Sheet2").Range("F7").Value
   Range("F20:G24").FormulaR1C1 = "=DEGREES(RC[-2])"
   ActiveSheet.Calculate
   Range("F20:G24").Value = Range("F20:G24").Value
   
   Application.Run "F.xlsm!Vince"
   Sheets("Sheet3").Range("A1:F7").Clear
   Sheets("Sheet3").Columns("G:L").Clear
   Sheets("Sheet2").Activate
   Range("A1:F8").Clear
   Range("A1").Activate
 
  Application.Run "F.xlsm!Triangle1"
End Sub

Sub ORDS1()
'
' Compares ords vs St Dist LEG and O&R - Fini Works for Doogie Amended 9/29/15 for better OCStd
' Amended G10 in FIRST Max OffCourse to avoid longitude conflict
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("P9:R9").Value = Sheets("TASKS").Range("C10:E10").Value
    Sheets("Sheet2").Range("S9:T9").Value = Sheets("TASKS").Range("H10:I10").Value
    Sheets("Sheet2").Range("P10:R10").Value = Sheets("TASKS").Range("C11:E11").Value
    Sheets("Sheet2").Range("S10:T10").Value = Sheets("TASKS").Range("H11:I11").Value
    Sheets("Sheet2").Range("P12:R12").Value = Sheets("TASKS").Range("C16:E16").Value
    Sheets("Sheet2").Range("S12:T12").Value = Sheets("Tasks").Range("H16:I16").Value
    
    Range("H2:L2").Value = Range("P10:T10").Value
    Range("H3:L3").Value = Range("P12:T12").Value
    
    'MAX Off course from St dist FINI to OR FINI
    Range("G10").FormulaR1C1 = "=IF(AND(RC1>R2C[1],RC[-6]<R3C8,RC[-4]<>R2C10),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("P11:T11").Value = Range("J8:N8").Value
    Range("G8:N10009").Clear
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R9C16,6371*ACOS(SIN(RC[-5])*SIN(R9C17)+COS(RC[-5])*COS(R9C17)*COS(R9C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
       
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("H8:L10009").Clear
    
    Range("U9:U12").FormulaR1C1 = _
        "=IF(AND(SUM(RC[-5]:RC[-1])>0,SUM(R[-1]C[-5]:R[-1]C[-1])>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U9:U14").Value = Range("U9:U14").Value
    
If Range("U14") = Range("U13") Then
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("TASKS").Range("H10:I11").Value
    
    Range("I4").FormulaR1C1 = "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MIN(R[6]C[-3]:R[10005]C[-3])"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C1,RC[-6]<=R5C[-6],RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI(),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R4C[2]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:N10009").Value = Range("G10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P15:T15").Value = Range("A1:E1").Value
    Range("P16:T17").Value = Range("J10:N11").Value
    Range("P18:T19").Value = Range("H2:L3").Value
    
    Range("P15:T19").Sort Key1:=Range("P15"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U16:U19").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U21").FormulaR1C1 = "=IF(OR(AND(R[-1]C>100,R[-6]C[-2]-R[-2]C[-2]<=R[-12]C[-17]),AND(R[-1]C<=100,R[-6]C[-2]-R[-2]C[-2]<=10*R[-1]C)),R[-1]C,0)"
    
ElseIf Range("U14") < Range("U13") Then
    Range("A7").Value = 2.08333333333333E-02
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R8C16-R7C1,RC[-6]<=R8C16+R7C1,RC[-3]-R12C19<=R9C4,RC[-4]<>R9C18),6371*ACOS(SIN(RC[-5])*SIN(R9C17)+COS(RC[-5])*COS(R9C17)*COS(R9C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:L10009").Value = Range("G10:L10009").Value
    
    Range("E7").FormulaR1C1 = "=R9C21-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R13C21-R14C21,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
  If Range("E7") < Range("E8") Then

    Range("P15:T15").Value = Range("H8:L8").Value
    Range("P16:T19").Value = Range("P9:T12").Value
    
    Range("U16:U19").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U21").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U16:U21").Value = Range("U16:U21").Value
    End If
  End If

    Range("A7:E7,E8,G8:L10009").Clear

    Range("O1").FormulaR1C1 = "=MAX(R[6]C[6],R[13]C[6],R[20]C[6])"
    ActiveSheet.Calculate
    Range("O1").Value = Range("O1").Value
    
    If Range("O1") = Range("U7") Then
        Range("P1:U7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = Range("U14") Then
        Range("P1:U7").Value = Range("P8:U14").Value
    ElseIf Range("O1") = Range("U21") Then
        Range("P1:U7").Value = Range("P15:U21").Value
    End If
    
    Range("P8:U28").Clear
    Columns("G:L").Clear
End Sub

Sub ORDS3()
'
' Works for Payne2013  /ROWS +7
'
Application.ScreenUpdating = False
    Range("P9:T9").Value = Range("A1:E1").Value
    Sheets("Sheet2").Range("P10:R10").Value = Sheets("TAsks").Range("C15:E15").Value
    Sheets("Sheet2").Range("S10:T10").Value = Sheets("TAsks").Range("H15:I15").Value
  
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(RC[-6]<R1C1,6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
   
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
   
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("H8:L8").Clear
    
    Range("H2:L2").Value = Range("P10:T10").Value
    Range("H3:L3").Value = Range("A3:E3").Value
    
    'MAXIMUM off course after Selected ORD
    Range("G10").FormulaR1C1 = "=IF(AND(RC1>R2C[1],RC1<R3C[1],RC[-4]<>R2C10),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    ActiveSheet.Calculate
    Range("P11:T11").Value = Range("J8:N8").Value
    Range("G8:N10009").Clear
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"

    Range("G10").FormulaR1C1 = _
        "=IF(RC1>R11C[9],6371*ACOS(SIN(R11C[10])*SIN(RC2)+COS(R11C[10])*COS(RC2)*COS(RC3-R11C[11])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P12:T12").Value = Range("H8:L8").Value
    Range("U9:U12").FormulaR1C1 = _
        "=IF(OR(SUM(R[-1]C[-5]:R[-1]C[-1])=0,SUM(RC[-5]:RC[-1])=0),0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(R[-1]C[-3]-RC[-3])))"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U9:U14").Value = Range("U9:U14").Value

If Range("U14") < Range("U13") Then
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]<=R9C16,RC[-3]-R12C[12]<R9C4),6371*ACOS(SIN(RC[-5])*SIN(R9C17)+COS(RC[-5])*COS(R9C17)*COS(R9C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("E7").FormulaR1C1 = "=R9C21-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R13C[16]-R14C21,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
  If Range("E7") < Range("E8") Then
    
    Range("P15:T15").Value = Range("H8:L8").Value
    Range("P16:T19").Value = Range("P9:T12").Value
    Range("U16:U19").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U21").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
  End If
 End If
    Range("O1").FormulaR1C1 = "=MAX(R[6]C[6],R[13]C[6],R[20]C[6])"
    ActiveSheet.Calculate
    Range("O1").Value = Range("O1").Value
    
    If Range("O1") = Range("U7") Then
        Range("P1:U7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = Range("U14") Then
        Range("P1:U7").Value = Range("P8:U14").Value
    ElseIf Range("O1") = Range("U21") Then
        Range("P1:U7").Value = Range("P15:U21").Value
    End If

    Range("P8:U28").Clear
    Columns("G:L").Clear
   
End Sub
Sub ORDS2()
'
' ORDS2 Macro First ORD > 1 hr after release
'
Application.ScreenUpdating = False
    Range("H2:L2").Value = Range("A1:E1").Value
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]<R2C8,RC[-4]<>R2C10),6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
   
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P9:T9").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]<R9C16,RC[-4]<>R9C18),6371*ACOS(SIN(RC[-5])*SIN(R9C17)+COS(RC[-5])*COS(R9C17)*COS(R9C18-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("P10:T10").Value = Range("A1:E1").Value
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R10C16,RC[-4]<>R10C18),6371*ACOS(SIN(RC[-5])*SIN(R10C17)+COS(RC[-5])*COS(R10C17)*COS(R10C18-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P11:T11").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R11C16,RC[-4]<>R11C18),6371*ACOS(SIN(RC[-5])*SIN(R11C17)+COS(RC[-5])*COS(R11C17)*COS(R11C18-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P12:T12").Value = Range("H8:L8").Value
    Range("G8:L10009").Clear
    Range("U9:U12").FormulaR1C1 = _
        "=IF(OR(SUM(R[-1]C[-5]:R[-1]C[-5])=0,SUM(RC[-5]:RC[-1])=0),0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U9:U14").Value = Range("U9:U14").Value
    
    Range("O1").FormulaR1C1 = "=MAX(R[6]C[6],R[13]C[6],R[20]C[6])"
    ActiveSheet.Calculate
    Range("O1").Value = Range("O1").Value
        
    If Range("O1") = Range("U7") Then
        Range("P1:U7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = Range("U14") Then
        Range("P1:U7").Value = Range("P8:U14").Value
    ElseIf Range("O1") = Range("U21") Then
        Range("P1:U7").Value = Range("P15:U21").Value
    End If
    
    Range("P8:U28").Clear
    Columns("G:L").Clear
    
End Sub
Sub DH()
'
' DH Macro in ORDS BEFORE XCA
'
    Range("P1:U7").Value = Range("A1:F7").Value
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R4C16,6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4]))>=R5C21),6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G8:L8").Value = Range("G8:L8").Value
    Range("P5:T5").Value = Range("H8:L8").Value
    
    Range("U5").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1))"
    ActiveSheet.Calculate
   
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    'First Try <= D9
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R2C16,RC[-3]-R5C19<=R9C4),6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    If Range("G8") = 0 Then
        Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R2C16,RC[-3]-R5C19<R1C19-R5C19),6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4])),"""")"
        'Copy Ref A
        With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    End If
    ActiveSheet.Calculate
    If Range("G8") <> 0 Then
    Range("G8:L8").Value = Range("G8:L8").Value
    Range("P1:T1").Value = Range("H8:L8").Value
    Range("U2").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R[2]C[-2])*0.1))"
    ActiveSheet.Calculate
End If

If Range("U7") > Range("F7") Then
    Range("A1:F7").Value = Range("P1:U7").Value
    Columns("G:U").Clear
End If
End Sub
Sub XCA()
'
' Cks min leg @ A3 PRIOR to ORDS4, move to A1:F7 10/12/14
'
Application.ScreenUpdating = False
    Range("P1:U5").Value = Range("A1:F5").Value

If Range("U3") < Range("U2") And Range("U3") < Range("U4") And Range("U3") < Range("U5") Then
    Range("H2:L3").Value = Range("P4:T5").Value
    
    Range("I4").FormulaR1C1 = "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    'Range("L4").FormulaR1C1 = "=MIN(R[6]C[-2]:R[10005]C[-2])"
    ActiveSheet.Calculate
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C[1],RC1<R3C[1],RC3<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P3:T3").Value = Range("J8:N8").Value
    Range("P1:T5").Select
    Range("P1:T5").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U5").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Columns("G:N").Clear
    
    If Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
        Range("P1:U7").Clear
    End If
 End If

End Sub

Sub ORDS4()
'
' FOR KEENE - needs LoH check - STR dist start = first ORD which is also O&R TP and 2nd 3-TP TP
'
 Application.ScreenUpdating = False
    Range("H1:U7").Clear
    
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("TASKS").Range("H10:I11").Value
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    'K4/K5 = Right & left Off Course
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("K5").FormulaR1C1 = "=MIN(R[5]C[-2]:R[10004]C[-2])"
    Range("L4").FormulaR1C1 = "=MIN(R[6]C[-2]:R[10005]C[-2])"
    Range("L5").FormulaR1C1 = "=MAX(R[5]C[-2]:R[10004]C[-2])"
    
    'Varies with the claim!
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1<R2C[1],RC3<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",(ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI()),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
  If Range("L4") < Range("H2") And Range("L5") < Range("H2") Then
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("P2:T3").Value = Range("J10:N11").Value
    Range("P4:T5").Value = Range("H2:L3").Value
    
    Range("U3:U6").FormulaR1C1 = _
        "=IF(OR(R[-1]C[-1]=0,RC[-1]=0,R[-1]C[-1]="""",RC[-1]=""""),0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    ActiveSheet.Calculate
    'Calculate Finish Point
    Range("P8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("P6:T6").FormulaR1C1 = "=MAX(R[4]C[1]:R[10003]C[1])"
    
    Range("P10").FormulaR1C1 = _
        "=IF(RC[-15]>R5C,6371*ACOS(SIN(RC[-14])*SIN(R5C[1])+COS(RC[-14])*COS(R5C[1])*COS(R5C[2]-RC[-13])),"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-16],"""")"
    Range("R10:U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-16],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("P10:U10").AutoFill Destination:=.Range("P10:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P6:T6").Value = Range("P6:T6").Value
    
    'Recalculate Start
    Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("P10").FormulaR1C1 = "=IF(RC[-15]<R2C,6371*ACOS(SIN(RC[-14])*SIN(R2C17)+COS(RC[-14])*COS(R2C17)*COS(R2C18-RC[-13])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("P10:P10").AutoFill Destination:=.Range("P10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:U8").Value = Range("P8:U8").Value
    
    Range("O8").FormulaR1C1 = "=SUM(RC[1]:RC[5])"
    ActiveSheet.Calculate
    Range("O8").Value = Range("O8").Value
    
  If Range("O8") <> 0 Then
    
    Range("V8").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-6]C[-5])+COS(RC[-4])*COS(R[-6]C[-5])*COS(R[-6]C[-4]-RC[-3]))"
    ActiveSheet.Calculate
    Range("V8").Value = Range("V8").Value
    Range("W8").FormulaR1C1 = "=SUM(RC[-1],R[-5]C[-2]:R[-3]C[-2])"
    ActiveSheet.Calculate
    Range("W8").Value = Range("W8").Value
    Range("V6").FormulaR1C1 = "=SUM(R[-3]C[-1]:RC[-1])"
    ActiveSheet.Calculate
    Range("V6").Value = Range("V6").Value
    
    If Range("W8") <= Range("V6") Then
        Range("P1:T1").Value = Range("P2:T2").Value
        Range("P2:T2").Value = Range("P3:T3").Value
        Range("P3:T3").Value = Range("P4:T4").Value
        Range("P4:T4").Value = Range("P5:T5").Value
        Range("P5:T5").Value = Range("P6:T6").Value
        Range("P6:U6").Clear
        Range("U2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    
    ElseIf Range("W8") > Range("V6") Then
        Range("P1:T1").Value = Range("Q8:U8").Value
        Range("P6:V6").Clear
        Range("U2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
        Range("P10").FormulaR1C1 = _
        "=IF(RC[-15]>R4C,6371*ACOS(SIN(RC[-14])*SIN(R4C17)+COS(RC[-14])*COS(R4C17)*COS(R4C18-RC[-13])),"""")"

    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("P10:P10").AutoFill Destination:=.Range("P10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
        Range("P8:U8").FormulaR1C1 = "=MAX(R[2]C:R[100008]C)"
    End If
        
        If Range("P8") > Range("U5") Then
        Range("P5:T5").Value = Range("Q8:U8").Value
        End If
    End If
    
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("P8:W10009").Clear
    Columns("G:N").Clear
    
    Application.Run "F.xlsm!ORDS4a"
    
    Range("O1").FormulaR1C1 = "=MAX(R7C[6],R14C[6])"
    ActiveSheet.Calculate
    Range("O1").Value = Range("O1").Value
    
    If Range("O1") = Range("U7") And Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = Range("U14") And Range("U14") > Range("F7") Then
        Range("A1:F7").Value = Range("P8:U14").Value
    End If
  End If
    Columns("G:U").Clear
   
End Sub
Sub ORDS4a()
'
' Works for Paul, data at P8:T14
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("M1").Value = Sheets("TASKS").Range("C10").Value
    Sheets("Sheet2").Range("M2").Value = Sheets("TASKS").Range("C15").Value
    
    If Range("M1") = Range("M2") Then
        Sheets("Sheet2").Range("H2:J4").Value = Sheets("TASKS").Range("C14:E16").Value
        Sheets("Sheet2").Range("K2:L4").Value = Sheets("TASKS").Range("H14:I16").Value
    Range("M1:M2").Clear
    
    Range("G5").FormulaR1C1 = "=(R[-1]C[1]-R[-2]C[1])/3"
    Range("G7").FormulaR1C1 = "=R[-4]C[1]+R[-2]C"
    Range("H7").FormulaR1C1 = "=RC[-1]+R[-2]C[-1]"
    Range("I7").FormulaR1C1 = "=RC[-1]+R[-2]C[-2]"
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
   
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R3C[1],RC[-6]<=R7C),6371*ACOS(SIN(RC[-5])*SIN(R3C[2])+COS(RC[-5])*COS(R3C[2])*COS(R3C[3]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T9").Value = Range("H2:L3").Value
    Range("P10:T10").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R7C,RC[-6]<=R7C[1]),6371*ACOS(SIN(RC[-5])*SIN(R10C[10])+COS(RC[-5])*COS(R10C[10])*COS(R10C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P11:T11").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R7C[1],6371*ACOS(SIN(RC[-5])*SIN(R11C[10])+COS(RC[-5])*COS(R11C[10])*COS(R11C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P12:T12").Value = Range("H8:L8").Value
  
    Range("U9:U12").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
   
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U9:U14").Value = Range("U9:U14").Value
  End If

End Sub
Sub ORDS5()
'
' LoHmatrix Macro Amended 9/29/2015 for <10K fixes @ 1 second interval
'
Application.ScreenUpdating = False
    Range("A7").Value = 1 / 48
    Range("B8").FormulaR1C1 = "=R[3]C[-1]-R[2]C[-1]"
    Range("C8").FormulaR1C1 = "=(1/24)/RC[-1]"
    ActiveSheet.Calculate
    If Range("C8") > 900 Then
        Range("A7").Value = 0.005208333
    Else: Range("A7").Value = 1 / 96
    End If
    ActiveSheet.Calculate
    Range("B8:C8").Clear
  
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R4C1,RC[-6]>=R5C1-R7C[-6],RC[-6]<=R5C1+R7C[-6]),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("G10:K509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=True
    Columns("G:K").Clear
    
    Range("G10").FormulaR1C1 = "=IF(RC[-6]<R2C1,RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC8)*SIN(R2C2)+COS(RC8)*COS(R2C2)*COS(R2C3-RC9)),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:L10009").Value = Range("G10:L10009").Value
    
    Range("N6:SS6").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=R[-2]C3),"""",6371*ACOS(SIN(R2C)*SIN(R[-2]C2)+COS(R2C)*COS(R[-2]C2)*COS(R[-2]C3-R3C)))"
    ActiveSheet.Calculate
    Range("N6:SS6").Value = Range("N6:SS6").Value
        
    'Matrix
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(R1C="""","""",IF(RC10-R4C>R9C4,(RC12+R6C)-((RC10-R4C-R9C4)*0.1),RC12+R6C))"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate

    Range("I5").FormulaR1C1 = "=MAX(R[5]C[5]:R[10004]C[504])"
    ActiveSheet.Calculate
    Range("I5").Value = Range("I5").Value
    Range("N10:SS10009").Value = Range("N10:SS10009").Value
    Range("N7:SS7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R5C9,1,"""")"
    ActiveSheet.Calculate
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C9,1,"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M10009").Value = Range("M10:M10009").Value
    
    Range("N10:SS10009").Clear
    
    Range("N10").FormulaR1C1 = "=IF(RC[-1]=1,RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("H1:L1").FormulaR1C1 = "=MAX(R[9]C[6]:R[10008]C[6])"
    ActiveSheet.Calculate
    Range("A1:E1").Value = Range("H1:L1").Value
    Range("N10:R10009").Clear
    
    Range("N10:SS10").FormulaR1C1 = "=IF(R[-3]C=1,R[-9]C,"""")"
    Range("N11:SS14").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-9]C,"""")"
    
    Range("H5").FormulaR1C1 = "=MAX(R[5]C[6]:R[5]C[505])"
    Range("I5").FormulaR1C1 = "=MAX(R[6]C[5]:R[6]C[504])"
    Range("J5").FormulaR1C1 = "=MAX(R[7]C[4]:R[7]C[503])"
    Range("K5").FormulaR1C1 = "=MAX(R[8]C[3]:R[8]C[502])"
    Range("L5").FormulaR1C1 = "=MAX(R[9]C[2]:R[9]C[501])"
    ActiveSheet.Calculate
    Range("A5:E5").Value = Range("H5:L5").Value
    
    Columns("G:SS").Clear
    Range("F2:F5").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    Range("F6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("F7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("F2:F7").Value = Range("F2:F7").Value
End Sub
Sub Ordsa()
'
' For semi, Mueller & Arcturas Amended 5/11/2018 for Howard!
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("P2:R3").Value = Sheets("Tasks").Range("C10:E11").Value
    Sheets("Sheet2").Range("S2:T3").Value = Sheets("Tasks").Range("H10:I11").Value
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R3C[9],6371*ACOS(SIN(RC[-5])*SIN(R3C[10])+COS(RC[-5])*COS(R3C[10])*COS(R3C[11]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
   
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
   
    Range("P4:T4").Value = Range("H8:L8").Value
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R4C[9],6371*ACOS(SIN(RC[-5])*SIN(R4C[10])+COS(RC[-5])*COS(R4C[10])*COS(R4C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
  If Range("G8") <> 0 Then
    
    Range("P5:T5").Value = Range("H8:L8").Value
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R2C[9],6371*ACOS(SIN(RC[-5])*SIN(R2C[10])+COS(RC[-5])*COS(R2C[10])*COS(R2C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
   If Range("G8") <> 0 Then
    
    Range("P1:T1").Value = Range("H8:L8").Value
    
    Range("U2:U5").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
    
    Range("B8").FormulaR1C1 = "=R[-7]C[14]-R[2]C[-1]"
    ActiveSheet.Calculate
    If Range("B8") >= 1 / 48 Then
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R1C[9],6371*ACOS(SIN(RC[-5])*SIN(R1C[10])+COS(RC[-5])*COS(R1C[10])*COS(R1C[11]-RC[-4])),"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("P9:T12").Value = Range("P1:T4").Value
    Range("U9:U12").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,((R[-6]C[-2]-R[-2]C[-2]-R9C4)*.1),R[-1]C)"
    ActiveSheet.Calculate
    If Range("U14") > Range("U7") Then
        Range("P1:U7").Value = Range("P8:U14").Value
        Range("P8:U14").Clear
    End If
   End If
   
   ElseIf Range("G8") = 0 Then
   
    Range("P2:T5").Cut Destination:=Range("P1:T4")
    Range("U2:U4").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("G10:G10009").FormulaR1C1 = "=IF(RC[-6]>R4C[9],6371*ACOS(SIN(RC[-5])*SIN(R4C[10])+COS(RC[-5])*COS(R4C[10])*COS(R4C[11]-RC[-4])),"""")"
    ActiveSheet.Calculate
    Range("P5:T5").Value = Range("H8:L8").Value
    Range("U5").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
   End If
   
    'Ck TP1 for Howard!
    Range("I7").FormulaR1C1 = "=SUM(R2C21:R3C21)"
    Range("I8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R1C16,RC[-6]<R3C16),6371*ACOS(SIN(RC[-5])*SIN(R1C17)+COS(RC[-5])*COS(R1C17)*COS(R1C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-6])*SIN(R3C17)+COS(RC[-6])*COS(R3C17)*COS(R3C18-RC[-5])),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-2]+RC[-1],"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R8C9,RC[-9],"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    If Range("I8") > Range("I7") Then
    
        Range("P2:T2").Value = Range("J8:N8").Value
        Range("U2:U3").FormulaR1C1 = "=6316*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
        Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
        Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,((R[-6]C[-2]-R[-2]C[-2]-R9C4)*.1),R[-1]C)"
        Range("G7:N10009").Clear
    End If

 ElseIf Range("G8") = 0 Then
 
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R2C[9],6371*ACOS(SIN(RC[-5])*SIN(R2C[10])+COS(RC[-5])*COS(R2C[10])*COS(R2C[11]-RC[-4])),"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P1:T1").Value = Range("H8:L8").Value
    
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("TASKS").Range("H10:I11").Value
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    'K4/K5 = Right & left Off Course
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("K5").FormulaR1C1 = "=MIN(R[5]C[-2]:R[10004]C[-2])"
    Range("L4").FormulaR1C1 = "=MIN(R[6]C[-2]:R[10005]C[-2])"
    Range("L5").FormulaR1C1 = "=MAX(R[5]C[-2]:R[10004]C[-2])"
    
    'Off ST Dist Course between St Dist Start & FIN
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C[1],RC1<R3C[1],RC3<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",(ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI()),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
  'If Range("L4") < Range("H2") And Range("L5") < Range("H2") Then
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("P5:T6").Value = Range("J10:N11").Value
    
    Range("P1:T6").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U6").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("T16").FormulaR1C1 = "=LARGE(R[-15]C[1]:R[-1]C[1],4)"
    Range("V1").FormulaR1C1 = "=IF(R[1]C[-1]>=R16C[-2],RC[-6],"""")"
    Range("V2:V6").FormulaR1C1 = "=IF(RC[-1]>=R16C[-2],RC[-6],"""")"
    ActiveSheet.Calculate
    Range("V1:V6").Value = Range("V1:V6").Value
    
    Range("P1:V6").Sort Key1:=Range("V1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P6:V16").Clear
    Range("V1:V6").Clear
    
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
  End If
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
   
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R1C[9],6371*ACOS(SIN(RC[-5])*SIN(R1C[10])+COS(RC[-5])*COS(R1C[10])*COS(R1C[11]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
   
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
   
    Range("O1").FormulaR1C1 = "=MIN(R1C21:R5C21)"
    ActiveSheet.Calculate
    
  If Range("G8") > Range("O1") Then
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("P9:T13").Value = Range("P1:T5").Value
    Range("U9:U14").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("T16").FormulaR1C1 = "=LARGE(R[-7]C[1]:R[-3]C[1],4)"
    Range("V8").FormulaR1C1 = "=IF(R[1]C[-1]>=R16C[-2],RC[-6],"""")"
    Range("V9:V13").FormulaR1C1 = "=IF(RC[-1]>=R16C[-2],RC[-6],"""")"
    ActiveSheet.Calculate
    Range("V8:V13").Value = Range("V8:V13").Value
    
    Range("P8:V14").Sort Key1:=Range("V8"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("P13:V19,V8:V13").Clear
    
    Range("U9:U12").FormulaR1C1 = _
        "=IF(AND(SUM(R[-1]C[-5],R[-1]C[-1])<>0,SUM(RC[-5],RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
  End If
   
    Range("O1").FormulaR1C1 = "=MAX(R[6]C[6],R[13]C[6])"
    ActiveSheet.Calculate
    If Range("O1") = Range("U7") And Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = Range("U14") And Range("U14") > Range("F7") Then
        Range("A1:F7").Value = Range("P8:U14").Value
    End If

    Columns("G:U").Clear
    Application.Run "F.xlsm!NoReturn2"

End Sub
Sub NoReturn2()
'
' For Franke Straight OCDist each of 2 halves of the flight
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("TASKS").Range("H10:I11").Value
    
    Range("A7").FormulaR1C1 = "=(R3C8-R2C8)/2"
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("K4").FormulaR1C1 = "=MIN(R[6]C[-2]:R[10005]C[-2])"
    Range("K5").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C[1],RC1<R3C[1],RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",(ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI()),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P1:T1").Value = Range("H2:L2").Value
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("P2:T3").Value = Range("J10:N11").Value
    
    Range("U2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-2]C[-4])*SIN(RC[-4])+COS(R[-2]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-2]C[-3]))"
    ActiveSheet.Calculate
    
    If Range("U3") > Range("U2") Then
        Range("P2:U2").Delete Shift:=xlUp
    ElseIf Range("U2") > Range("U3") Then
        Range("P3:T3").Clear
    End If
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C16,RC1<R2C16+R7C1,RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("P3:T4").Value = Range("J10:N11").Value
    
    Range("U3").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U4").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-2]C[-4])*SIN(RC[-4])+COS(R[-2]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-2]C[-3]))"
    ActiveSheet.Calculate
    
    If Range("U4") > Range("U3") Then
        Range("P3:U3").Delete Shift:=xlUp
    ElseIf Range("U3") > Range("U4") Then
        Range("P4:T4").Clear
    End If
    
    Range("P4:T4").Value = Range("H3:L3").Value
    Range("H3:L3").Value = Range("P2:T2").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R1C16,RC1<R2C16,RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC[-9],"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P5:T6").Value = Range("J10:N11").Value
    
    Range("P1:T6").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("U2:U5").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U6").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-2]C[-4])*SIN(RC[-4])+COS(R[-2]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-2]C[-3]))"
    ActiveSheet.Calculate
    
    If Range("U6") > Range("U5") Then
        Range("P5:U5").Delete Shift:=xlUp
    ElseIf Range("U5") > Range("U6") Then
        Range("P6:U6").Clear
    End If
    
    Range("O6:T6").FormulaR1C1 = "=MAX(R[4]C:R[10003]C)"
    Range("O10").FormulaR1C1 = _
        "=IF(RC[-14]>R5C[1],6371*ACOS(SIN(R5C[2])*SIN(RC[-13])+COS(R5C[2])*COS(RC[-13])*COS(RC[-12]-R5C[3])),"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]=R6C15,RC[-15],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-15],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("O10:T10").AutoFill Destination:=.Range("O10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P6:T6").Value = Range("P6:T6").Value
    Range("U6").Value = Range("O6").Value
    Range("O6").Clear
    
    Columns("G:O").Clear
    Range("P10:T10009").Clear

    Range("T16").FormulaR1C1 = "=LARGE(R[-14]C[1]:R[-10]C[1],4)"
    Range("V1").FormulaR1C1 = "=IF(R[1]C[-1]>=R16C[-2],RC[-6],"""")"
    Range("V2:V6").FormulaR1C1 = "=IF(RC[-1]>=R16C[-2],RC[-6],"""")"
    ActiveSheet.Calculate
    Range("V1:V6").Value = Range("V1:V6").Value
    Range("P1:V6").Sort Key1:=Range("V1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P5:V16").Clear
    
    Range("P1:T4").Cut Destination:=Range("P2:T5")
    Range("U1:V5").Clear
    
    Range("O1:T1").FormulaR1C1 = "=MAX(R[9]C:R[10009]C)"
    Range("O10").FormulaR1C1 = _
        "=IF(RC[-14]<R2C[1],6371*ACOS(SIN(RC[-13])*SIN(R2C[2])+COS(RC[-13])*COS(R2C[2])*COS(R2C[3]-RC[-12])),"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]=R1C[-1],RC[-15],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-15],"""")"
   
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("O10:T10").AutoFill Destination:=.Range("O10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P1:T1").Value = Range("P1:T1").Value
    
    Columns("O:O").Clear
    Range("A7,P10:T10009").Clear
    
    Range("U2:U5").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
    
    'LoH
  If Range("U7") < Range("U6") Then
    Sheets("Sheet2").Range("A7").Value = Sheets("TASKS").Range("C10").Value
    Range("O8:T8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("O10").FormulaR1C1 = _
        "=IF(AND(RC[-14]<R1C[1],RC[-11]-R5C[4]<R1C[4]-R5C[4],RC[-12]<>R2C[3]),6371*ACOS(SIN(RC[-13])*SIN(R2C[2])+COS(RC[-13])*COS(R2C[2])*COS(R2C[3]-RC[-12])),"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]=R8C15,RC[-15],"""")"
    Range("Q10:T10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-15],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("O10:T10").AutoFill Destination:=.Range("O10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T8").Value = Range("P8:T8").Value
    Range("O8:O10009,P10:T10009").Clear
    Range("P9:T12").Value = Range("P2:T5").Value
    
    Range("U9:U12").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    
    If Range("U14") < Range("U13") And Range("P8") <> Range("A7") Then
        Sheets("Sheet2").Range("P15:R15").Value = Sheets("TASKS").Range("C10:E10").Value
        Sheets("Sheet2").Range("S15:T15").Value = Sheets("TASKS").Range("H10:I10").Value
        Range("P16:T19").Value = Range("P2:T5").Value
        Range("U16:U19").FormulaR1C1 = _
            "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
        Range("U20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
        Range("U21").FormulaR1C1 = _
            "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
        ActiveSheet.Calculate
    End If
    
    Range("O1").Formula = "=IF(MAX(R7C21,R14C21,R21C21)=R7C21,""U7"",IF(MAX(R7C21,R14C21,R21C21)=R14C21,""U14"",IF(MAX(R7C21,R14C21,R21C21)=R21C21,""U21"")))"
    Range("A7").Clear
    
    If Range("O1") = "U7" And Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    ElseIf Range("O1") = "U14" And Range("U14") > Range("F7") Then
        Range("A1:F7").Value = Range("P8:U14").Value
    ElseIf Range("O1") = "U21" And Range("U21") > Range("F7") Then
        Range("A1:F7").Value = Range("P15:U21").Value
    End If
  End If
    Columns("O:U").Clear
    Application.Run "F.xlsm!Steve"
  
End Sub
Sub Steve()
'
' Macro1 Macro For Stevenson (PO: Start=Release, TP1=StDist Fin, TP2 OFFC StDist, wander!
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("H2:J3").Value = Sheets("TASKS").Range("C10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("TASKS").Range("H10:I11").Value
    
    Sheets("Sheet2").Range("P2:T3").Value = Sheets("Sheet2").Range("H2:L3").Value
    Range("U3").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("K4").FormulaR1C1 = "=MIN(R[6]C[-2]:R[10005]C[-2])"
    Range("K5").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    'OFFC ST Dist, after St Dist FINI
    Range("G10").FormulaR1C1 = "=IF(AND(RC1>R3C[1],RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",(ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI()),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P10:T11").Value = Range("J10:N11").Value
 
    'OFFC St Dist FINI to earlier TP1 Alternative
    Range("H2:L2").Value = Range("P3:T3").Value
    Range("H3:L3").Value = Range("P10:T10").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C[1],RC1<R3C[1],RC[-4]<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C11,RC[-1]=R5C11),RC[-9],"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P13:T14").Value = Range("J10:N11").Value
    
    Range("J10:N10009").Clear
    
    'OFFC St Dist FINI to later TP2 Alternative
    Range("H3:L3").Value = Range("P11:T11").Value
    
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C11,RC[-1]=R5C11),RC[-9],"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P16:T17").Value = Range("J10:N11").Value
    
    Range("U10,U11,U13,U14,U16,U17").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R3C17)+COS(RC[-4])*COS(R3C17)*COS(R3C18-RC[-3]))"
    ActiveSheet.Calculate
    Range("W10").FormulaR1C1 = "=IF(RC[-2]=MAX(RC[-2],R[1]C[-2]),RC[-7],R[1]C[-7])"
    Range("X10").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Y10").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Z10").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("AA10").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    ActiveSheet.Calculate
    Range("W13").FormulaR1C1 = "=IF(RC[-2]=MAX(RC[-2],R[1]C[-2]),RC[-7],R[1]C[-7])"
    Range("X13").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Y13").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Z13").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("AA13").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    ActiveSheet.Calculate
    Range("W16").FormulaR1C1 = "=IF(RC[-2]=MAX(RC[-2],R[1]C[-2]),RC[-7],R[1]C[-7])"
    Range("X16").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Y16").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("Z16").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    Range("AA16").FormulaR1C1 = "=IF(RC[-1]=RC[-8],RC[-7],R[1]C[-7])"
    ActiveSheet.Calculate
    Range("AB10").FormulaR1C1 = "=IF(RC[-5]=MIN(R10C[-5],R13C[-5],R16C[-5]),6371*ACOS(SIN(RC[-4])*SIN(R3C[-11])+COS(RC[-4])*COS(R3C[-11])*COS(R3C[-10]-RC[-3])),0)"
    Range("AB13").FormulaR1C1 = "=IF(RC[-5]=MIN(R10C[-5],R13C[-5],R16C[-5]),6371*ACOS(SIN(RC[-4])*SIN(R3C[-11])+COS(RC[-4])*COS(R3C[-11])*COS(R3C[-10]-RC[-3])),0)"
    Range("AB16").FormulaR1C1 = "=IF(RC[-5]=MIN(R10C[-5],R13C[-5],R16C[-5]),6371*ACOS(SIN(RC[-4])*SIN(R3C[-11])+COS(RC[-4])*COS(R3C[-11])*COS(R3C[-10]-RC[-3])),0)"
    ActiveSheet.Calculate
    Range("W7").FormulaR1C1 = "=IF(R[3]C[5]=MAX(R[3]C[5],R[6]C[5],R[9]C[5]),R[3]C,IF(R[6]C[5]=MAX(R[3]C[5],R[6]C[5],R[9]C[5]),R[6]C,R[9]C))"
    Range("X7").FormulaR1C1 = "=IF(RC[-1]=R[3]C[-1],R[3]C,IF(RC[-1]=R[6]C[-1],R[6]C,R[9]C))"
    Range("Y7").FormulaR1C1 = "=IF(RC[-2]=R[3]C[-2],R[3]C,IF(RC[-2]=R[6]C[-2],R[6]C,R[9]C))"
    Range("Z7").FormulaR1C1 = "=IF(RC[-3]=R[3]C[-3],R[3]C,IF(RC[-3]=R[6]C[-3],R[6]C,R[9]C))"
    Range("AA7").FormulaR1C1 = "=IF(RC[-4]=R[3]C[-4],R[3]C,IF(RC[-4]=R[6]C[-4],R[6]C,R[9]C))"
    ActiveSheet.Calculate
    Range("P4:T4").Value = Range("W7:AA7").Value
    Range("U4").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    ActiveSheet.Calculate
    Range("AB10").FormulaR1C1 = "=IF(AND(RC[-5]<>MIN(R10C[-5],R13C[-5],R16C[-5]),RC[-5]<>MAX(RC[-5],R[3]C[-5],R[6]C[-5])),6371*ACOS(SIN(RC[-4])*SIN(R4C[-11])+COS(RC[-4])*COS(R4C[-11])*COS(R4C[-10]-RC[-3])),0)"
    Range("AB13").FormulaR1C1 = "=IF(AND(RC[-5]<>MIN(R10C[-5],R13C[-5],R16C[-5]),RC[-5]<>MAX(R[-3]C[-5],RC[-5],R[3]C[-5])),6371*ACOS(SIN(RC[-4])*SIN(R4C[-11])+COS(RC[-4])*COS(R4C[-11])*COS(R4C[-10]-RC[-3])),0)"
    Range("AB16").FormulaR1C1 = "=IF(AND(RC[-5]<>MIN(R10C[-5],R13C[-5],R16C[-5]),RC[-5]<>MAX(R[-6]C[-5],R[-3]C[-5],RC[-5])),6371*ACOS(SIN(RC[-4])*SIN(R4C[-11])+COS(RC[-4])*COS(R4C[-11])*COS(R4C[-10]-RC[-3])),0)"
    Range("P5:T5").Value = Range("W7:AA7").Value
    Range("U5").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    ActiveSheet.Calculate
    Range("AB10").FormulaR1C1 = "=IF(RC[-5]=MAX(RC[-5],R[3]C[-5],R[6]C[-5]),6371*ACOS(SIN(RC[-4])*SIN(R5C[-11])+COS(RC[-4])*COS(R5C[-11])*COS(R5C[-10]-RC[-3])),0)"
    Range("AB13").FormulaR1C1 = "=IF(RC[-5]=MAX(R[-3]C[-5],RC[-5],R[3]C[-5]),6371*ACOS(SIN(RC[-4])*SIN(R5C[-11])+COS(RC[-4])*COS(R5C[-11])*COS(R5C[-10]-RC[-3])),0)"
    Range("AB16").FormulaR1C1 = "=IF(RC[-5]=MAX(R[-6]C[-5],R[-3]C[-5],RC[-5]),6371*ACOS(SIN(RC[-4])*SIN(R5C[-11])+COS(RC[-4])*COS(R5C[-11])*COS(R5C[-10]-RC[-3])),0)"
    Range("P6:T6").Value = Range("W7:AA7").Value
    Range("U6").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    ActiveSheet.Calculate
    Range("V6").FormulaR1C1 = "=SUM(R[-3]C[-1]:RC[-1])"
    Range("V7").FormulaR1C1 = "=IF(R[-5]C[-3]-R[-1]C[-3]<=R9C4,R[-1]C,R[-1]C-((R[-5]C[-3]-R[-1]C[-3]-R9C4)*0.1))"
    ActiveSheet.Calculate
    Range("U3:V7").Value = Range("U3:V7").Value
    Range("W7:AB16").Clear
    Columns("G:N").Clear
    Range("P10:U17").Clear
    'Reverse Ck
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R3C[9],RC[-6]<=R4C[9]),6371*ACOS(SIN(RC[-5])*SIN(R3C[10])+COS(RC[-5])*COS(R3C[10])*COS(R3C[11]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P4:T4").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R4C[9],RC[-6]<=R5C[9]),6371*ACOS(SIN(RC[-5])*SIN(R4C[10])+COS(RC[-5])*COS(R4C[10])*COS(R4C[11]-RC[-4])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("P5:T5").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R5C[9],6371*ACOS(SIN(RC[-5])*SIN(R5C[10])+COS(RC[-5])*COS(R5C[10])*COS(R5C[11]-RC[-4])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("P6:T6").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R6C[9],RC[-6]>R5C[9]),6371*ACOS(SIN(RC[-5])*SIN(R6C[10])+COS(RC[-5])*COS(R6C[10])*COS(R6C[11]-RC[-4])),"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P5:T5").Value = Range("H8:L8").Value
    Range("P2:T6").Sort Key1:=Range("P2"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U3:U6").FormulaR1C1 = "=IF(AND(SUM(R[-1]C[-5]:R[-1]C[-1])<>0,SUM(RC[-5]:RC[-1])<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("V6").FormulaR1C1 = "=SUM(R[-3]C[-1]:RC[-1])"
    Range("V7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1))"
    ActiveSheet.Calculate
    
    If Range("V7") > Range("F7") Then
    
        Range("A1:E5").Value = Range("P2:T6").Value
        Range("F2:F5").Value = Range("U3:U6").Value
        Range("F6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
        Range("F7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1))"
        ActiveSheet.Calculate
        Range("F6:F7").Value = Range("F6:F7").Value
    End If
    Columns("G:W").Clear

End Sub


Sub AllOrds2()
'
' Works for Doogie
'
Application.ScreenUpdating = False

    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R5C[9],6371*ACOS(SIN(RC[-5])*SIN(R5C[10])+COS(RC[-5])*COS(R5C[10])*COS(R5C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("B8").FormulaR1C1 = "=MIN(R[-6]C[19]:R[-3]C[19])"
    
  If Range("G8") > Range("B8") Then
    
        Range("P6:T6").Value = Range("H8:L8").Value
        Range("U6").Value = Range("G8").Value
        Range("T11").FormulaR1C1 = "=LARGE(R[-9]C[1]:R[-5]C[1],4)"
        Range("V1").FormulaR1C1 = "=IF(R[1]C[-1]>=R11C[-2],RC[-6],"""")"
        Range("V2:V6").FormulaR1C1 = "=IF(RC[-1]>=R11C[-2],RC[-6],"""")"
        ActiveSheet.Calculate
        Range("V1:V6").Value = Range("V1:V6").Value
    
        Range("P1:V6").Sort Key1:=Range("V1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
        Range("U1:V5,P5:V11").Clear
    
        Range("G10").FormulaR1C1 = _
            "=IF(RC[-6]<R1C[9],6371*ACOS(SIN(RC[-5])*SIN(R1C[10])+COS(RC[-5])*COS(R1C[10])*COS(R1C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P5:T5").Value = Range("H8:L8").Value
    Range("P1:T5").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U5").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
    
   End If
 'End If
End Sub

Sub ORbase()
'
' ORbase Macro works for Payne 2012 based on O&R task
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("P2:R4").Value = Sheets("TASKS").Range("C14:E16").Value
    Sheets("Sheet2").Range("S2:T4").Value = Sheets("TASKS").Range("H14:I16").Value
     
    Range("A8,G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=If(RC[-6]>R3C[9],6371*ACOS(SIN(RC[-5])*SIN(R3C[10])+COS(RC[-5])*COS(R3C[10])*COS(R3C[11]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Sheets("Sheet2").Cells.NumberFormat = "General"
    Range("P5:T5").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
            "=IF(AND(RC[-6]>R4C[9],RC[-6]<R5C[9]),6371*ACOS(SIN(RC[-5])*SIN(R4C[10])+COS(RC[-5])*COS(R4C[10])*COS(R4C[11]-RC[-4])),"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
       
 If Range("G8") <> 0 Then
    Range("P8:T8").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]<R8C[9],RC[-6]>R3C[9]),6371*ACOS(SIN(RC[-5])*SIN(R8C[10])+COS(RC[-5])*COS(R8C[10])*COS(R8C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P9:T9").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R8C[9],6371*ACOS(SIN(RC[-5])*SIN(R8C[10])+COS(RC[-5])*COS(R8C[10])*COS(R8C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P10:T10").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R9C[9],6371*ACOS(SIN(RC[-5])*SIN(R9C[10])+COS(RC[-5])*COS(R9C[10])*COS(R9C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P11:T11").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R11C[9],6371*ACOS(SIN(RC[-5])*SIN(R11C[10])+COS(RC[-5])*COS(R11C[10])*COS(R11C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P12:T12").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R2C[9],6371*ACOS(SIN(RC[-5])*SIN(R11C[10])+COS(RC[-5])*COS(R11C[10])*COS(R11C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T12").Sort Key1:=Range("P8"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
    Range("U9:U12").FormulaR1C1 = _
        "=IF(OR(R[-1]C[-4] = 0, RC[-4]=0),"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    Range("U13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U14").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("P1:U7").Value = Range("P8:U14").Value
    
    Range("P8:U14").Clear
    Columns("G:L").Clear
    
 ElseIf Range("G8") = 0 Then
    
    Range("P4:T4").Clear
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R5C[9],6371*ACOS(SIN(RC[-5])*SIN(R5C[10])+COS(RC[-5])*COS(R5C[10])*COS(R5C[11]-RC[-4])),"""")"
 
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P8:T8").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R2C[9],6371*ACOS(SIN(RC[-5])*SIN(R2C[10])+COS(RC[-5])*COS(R2C[10])*COS(R2C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P9:T9").Value = Range("H8:L8").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R9C[9],RC[-6]<R3C[9]),6371*ACOS(SIN(RC[-5])*SIN(R3C[10])+COS(RC[-5])*COS(R3C[10])*COS(R3C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P10:T10").Value = Range("H8:L8").Value
    
    Range("P2:T2").Clear
    
    Range("P1:T10").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
  
    Range("U2:U7").FormulaR1C1 = _
        "=IF(OR(R[-1]C[-4] = 0, RC[-4]=0),"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    ActiveSheet.Calculate
    Range("G10").FormulaR1C1 = "=IF(RC[-6]<R2C[9],6371*ACOS(SIN(RC[-5])*SIN(R2C[10])+COS(RC[-5])*COS(R2C[10])*COS(R2C[11]-RC[-4])),"""")"
  
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  
    If Range("G8") > Range("U2") Then
        Range("P2:T2").Value = Range("H8:L8").Value
    End If
  
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("P1:U7").Value = Range("P1:U7").Value
  
    Columns("G:L").Clear
       
 End If
    
    If Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    End If
        
    Range("P1:U7").Clear
    
End Sub


Sub Fixxer()
' 7/27/17 JLR Consolidated w/Fixxer2 for brevity
'
Application.ScreenUpdating = False
    
    Range("I8,J8,N8,O8").FormulaR1C1 = "=MAX(R[2]C:R[60001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R3C1,RC[-6]<R5C1),6371*ACOS(SIN(RC[-5])*SIN(R5C2)+COS(RC[-5])*COS(R5C2)*COS(R5C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-6])*SIN(R3C2)+COS(RC[-6])*COS(R3C2)*COS(R3C3-RC[-5])),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-2]+RC[-1],"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R8C9,RC[-9],"""")"
    Range("L10").FormulaR1C1 = "=IF(AND(RC[-11]>R1C1,RC[-11]<R3C1),6371*ACOS(SIN(RC[-10])*SIN(R3C2)+COS(RC[-10])*COS(R3C2)*COS(R3C3-RC[-9])),"""")"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-11])*SIN(R1C2)+COS(RC[-11])*COS(R1C2)*COS(R1C3-RC[-10])),"""")"
    Range("N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-2]+RC[-1],"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]=R8C14,RC[-14],"""")"
    'Copy Ref A
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:O10").AutoFill Destination:=.Range("G10:O" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J8").Value = Range("J8").Value
    Range("O8").Value = Range("O8").Value
  
    Range("G10:O60009").Clear
    
    Range("G10").FormulaR1C1 = "=IF(OR(RC[-6]=R8C15,RC[-6]=R3C1,RC[-6]=R8C10),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-1]="""",0,6371*ACOS(SIN(R[-9]C[-10])*SIN(RC[-4])+COS(R[-9]C[-10])*COS(RC[-4])*COS(RC[-3]-R[-9]C[-9])))"
    Range("L11:L12").FormulaR1C1 = _
        "=IF(RC[-1]="""",0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    Range("L13").FormulaR1C1 = _
        "=IF(RC[-1]="""",0,6371*ACOS(SIN(R[-1]C[-4])*SIN(R[-8]C[-10])+COS(R[-1]C[-4])*COS(R[-8]C[-10])*COS(R[-8]C[-9]-R[-1]C[-3])))"
    Range("L14").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("L15").FormulaR1C1 = _
        "=IF(R[-14]C[-8]-R[-10]C[-8]<=R9C4,R[-1]C,R[-1]C-((R[-14]C[-8]-R[-10]C[-8]-R9C4)*0.1))"
    ActiveSheet.Calculate
    
    If Range("L15") > Range("F7") Then
        Range("A2:E4").Value = Range("G10:K12").Value
        Range("F2:F7").Value = Range("L10:L15").Value
    End If
    
    Range("I6:N6").FormulaR1C1 = "=MAX(R[4]C:R[60003]C)"
    Range("J6").FormulaR1C1 = "=MAX(R[4]C:R[60003]C)"
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R2C1,RC[-6]<R4C1),6371*ACOS(SIN(RC[-5])*SIN(R2C2)+COS(RC[-5])*COS(R2C2)*COS(R2C3-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-6])*SIN(R4C2)+COS(RC[-6])*COS(R4C2)*COS(R4C3-RC[-5])),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-2]+RC[-1],"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R6C9,RC[-9],"""")"
    'Copy Ref A
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:J10").AutoFill Destination:=.Range("G10:J" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("I6:J6").Value = Range("I6:J6").Value

    Range("K10").FormulaR1C1 = "=IF(RC[-1]=R6C10,RC[-9],"""")"
    Range("L10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("K10:N10").AutoFill Destination:=.Range("K10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate

    Range("I5").FormulaR1C1 = "=R[-2]C[-3]+R[-1]C[-3]"
    ActiveSheet.Calculate
    If Range("I6") > Range("I5") Then
        Range("A3:E3").Value = Range("J6:N6").Value
        Range("F3:F4").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
        Range("F6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
        Range("F7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1))"
        ActiveSheet.Calculate
        Range("F2:F7").Value = Range("F2:F7").Value
    End If
    Columns("G:O").Clear
End Sub

Sub TP3a()
'
' OFF ST Dist Course
'
Application.ScreenUpdating = False
    Sheets("Sheet2").Range("H2:I3").Value = Sheets("Tasks").Range("C10:D11").Value
    Sheets("Sheet2").Range("J2:J3").Value = Sheets("Tasks").Range("E10:E11").Value
    Sheets("Sheet2").Range("K2:L3").Value = Sheets("Tasks").Range("H10:I11").Value
    
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    'L&R off course after ST DIST Fini
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C10,"""",IF(RC1>R3C[1],ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",(ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI()),"""")"
    Range("J10").FormulaR1C1 = "=IF(OR(RC[-1]=R4C[1],RC[-1]=R5C[1]),RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("K5").FormulaR1C1 = "=MIN(R[5]C[-2]:R[10004]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("G10:I10009").Clear
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("K4:L4").Clear
    
    Range("P4:T5").Value = Range("J10:N11").Value
    Range("J10:N11").Clear
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R2C8,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P1:T1").Value = Range("H8:L8").Value
    Range("P2:T3").Value = Range("H2:L3").Value
    
    Range("O2:O5").FormulaR1C1 = _
        "=IF(OR(R[-1]C[1]=0,RC[1]=0),0,6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])))"
    Range("O6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    ActiveSheet.Calculate
    Range("O1:T6").Value = Range("O1:T6").Value
    
    Range("G8:G10009").Clear
    
    'CK LoH, adjust Start
    Range("P6").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[-1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P6").Value = Range("P6").Value
 
 If Range("P6") <> Range("O6") Then
    Range("A7").Value = 2.08333333333333E-02
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    ActiveSheet.Calculate
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R1C16-R7C1,RC[-6]<=R1C16+R7C1,RC[-3]-R5C19<=R9C4),6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4])),"""")"
     Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("E7").FormulaR1C1 = "=R2C15-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R6C15-R6C16,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
    If Range("E7") < Range("E8") And Range("G8") <> 0 Then
    
    Range("P8:T8").Value = Range("H8:L8").Value
    Range("P9:T12").Value = Range("P2:T5").Value
    
    Range("O9:O12").FormulaR1C1 = _
        "=IF(OR(AND(R[-1]C[1]=0,R[-1]C[2]=0),AND(RC[1]=0,RC[2]=0)),0,6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])))"
    Range("O13").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    ActiveSheet.Calculate
    Range("O9:O13").Value = Range("O9:O13").Value
    
    Range("P13").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P13").Value = Range("P13").Value
 
    End If
 End If
 
    Range("E7,E8,G8:L10009").Clear
    
    Range("E7").FormulaR1C1 = "=MIN(R2C[10]:R5C[10],R9C[10]:R12C[10])"
    ActiveSheet.Calculate
    Range("E7").Value = Range("E7").Value
    
    'If for near-duplicate TPs, ElseIf when no TP3, relese hour(s) before start
    If Range("E7") < 5 And Range("E7") > 0 Then
        Application.Run "F.xlsm!TP3b"
    ElseIf Range("E7") > 5 Then
        Application.Run "F.xlsm!TP3c"
    End If
    
    Range("N1").FormulaR1C1 = "=MAX(R7C6,R6C16,R13C16,R20C16,R27C16,R34C16,R41C16)"
    ActiveSheet.Calculate
    Range("N1").Value = Range("N1").Value
    
    If Range("N1") = Range("F7") Then
        Range("O1:T41").Clear
    ElseIf Range("N1") = Range("P6") Then
        Range("A1:E5").Value = Range("P1:T5").Value
        Range("F2:F6").Value = Range("O2:O6").Value
        Range("F7").Value = Range("P6").Value
    ElseIf Range("N1") = Range("P13") Then
        Range("A1:E5").Value = Range("P8:T12").Value
        Range("F2:F6").Value = Range("O9:O13").Value
        Range("F7").Value = Range("P13").Value
    ElseIf Range("N1") = Range("P20") Then
        Range("A1:E5").Value = Range("P15:T19").Value
        Range("F2:F6").Value = Range("O16:O20").Value
        Range("F7").Value = Range("P20").Value
    ElseIf Range("N1") = Range("P27") Then
        Range("A1:E5").Value = Range("P22:T26").Value
        Range("F2:F6").Value = Range("O23:O27").Value
        Range("F7").Value = Range("P27").Value
    ElseIf Range("N1") = Range("P34") Then
        Range("A1:E5").Value = Range("P29:T33").Value
        Range("F2:F6").Value = Range("O30:O34").Value
        Range("F7").Value = Range("P34").Value
    ElseIf Range("N1") = Range("P41") Then
        Range("A1:E5").Value = Range("P36:T40").Value
        Range("F2:F6").Value = Range("O37:O41").Value
        Range("F7").Value = Range("P41").Value
    End If
    
    Range("A7,E7:E8").Clear
    Columns("G:T").Clear
 
End Sub

Sub TP3c()
'
' JLR 12/4/13 works for Scutter Based on O&R
'
Application.ScreenUpdating = False
    Range("P17:T19").Value = Range("P8:T10").Value
    Range("O18:O19").Value = Range("O9:O10").Value
    Sheets("Sheet2").Range("H2:J2").Value = Sheets("Tasks").Range("C14:E14").Value
    Sheets("Sheet2").Range("K2:L2").Value = Sheets("Tasks").Range("H14:I14").Value
    Range("H3:L3").Value = Range("P17:T17").Value
    Range("P15:T15").Value = Range("H2:L2").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1<R3C[1],RC3<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("G10:I10009").Clear
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P16:T16").Value = Range("J10:N10").Value
    Range("J10:N10").Clear
    'need to sort
    Range("P15:T19").Sort Key1:=Range("P15"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("O16:O19").FormulaR1C1 = _
        "=IF(AND(RC[1]<>"""",R[-1]C[1]<>0,RC[1]<>0),6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(R[-1]C[3]-RC[3])),0)"
    Range("O20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("P20").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[-1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("O16:O20").Value = Range("O16:O20").Value
    Range("P20").Value = Range("P20").Value
    
    If Range("P20") < Range("O20") Then
    Range("A7").Value = 2.08333333333333E-02
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R15C16-R7C1,RC[-6]<=R15C16+R7C1,RC[-3]-R19C19<=R9C4),6371*ACOS(SIN(RC[-5])*SIN(R16C17)+COS(RC[-5])*COS(R16C17)*COS(R16C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("E7").FormulaR1C1 = "=R16C15-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R20C15-R20C16,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
    If Range("E7") < Range("E8") And Range("G8") <> 0 Then

    Range("P22:T22").Value = Range("H8:L8").Value
    Range("P23:T26").Value = Range("P16:T19").Value
    
    Range("O23:O26").FormulaR1C1 = _
        "=IF(AND(RC[1]<>"""",R[-1]C[1]<>0,RC[1]<>0),6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])),0)"
    Range("O27").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    ActiveSheet.Calculate
    Range("O23:O27").Value = Range("O23:O27").Value
    
    Range("P27").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P27").Value = Range("P27").Value
    End If
  End If
      
End Sub
Sub Serk()
'
' Works for Serkowski, Ords 1,2,3 then wing it! (Funky)
'
 Application.ScreenUpdating = False
    'Copy ORDS from TASKS to P1:T4
    Sheets("Sheet2").Range("P1:T4").Value = Sheets("TASKS").Range("A40:E43").Value
    
    Range("A7").Value = 1 / 24
    Range("O2").FormulaR1C1 = "=RC[1]-R[-1]C[1]"
    Range("O3").FormulaR1C1 = "=RC[1]-R[-1]C[1]"
    Range("O4").FormulaR1C1 = "=RC[1]-R[-1]C[1]"
    Range("N4").FormulaR1C1 = "=R[-1]C[2]+(RC[1]/2)+R[3]C[-13]"
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R3C16,RC[-6]<=R4C14,RC[-4]<>R3C18),6371*ACOS(SIN(RC[-5])*SIN(R3C17)+COS(RC[-5])*COS(R3C17)*COS(R3C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P4:T4").Value = Range("H8:L8").Value
    
    Range("U2:U4").FormulaR1C1 = "=IF(AND(RC[-5]<>0,R[-1]C[-5]<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    ActiveSheet.Calculate
    Range("G10:G10009").Clear
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R4C18,"""",IF(RC[-6]>R4C16,6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4])),""""))"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P5:T5").Value = Range("H8:L8").Value
    
    Range("U5").FormulaR1C1 = "=IF(AND(RC[-5]<>0,R[-1]C[-5]<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2])*0.1))"
    ActiveSheet.Calculate
    Range("U2:U7").Value = Range("U2:U7").Value
    
    Range("G1:O10009").Clear
    
    If Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    End If
    Range("A7:A8,P1:U7").Clear
    
End Sub
Sub Essex()
'
' Chk Ords, amending S&F only
'
Application.ScreenUpdating = False
    
    Sheets("Sheet2").Range("P2:T4").Value = Sheets("Tasks").Range("A41:E43").Value
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(RC[-6]<R2C16,6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P1:T1").Value = Range("H8:L8").Value
    Range("G8:L10009").Clear
    
    Range("N8:S8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("N10").FormulaR1C1 = "=IF(RC[-13]>R4C16,6371*ACOS(SIN(RC[-12])*SIN(R4C17)+COS(RC[-12])*COS(R4C17)*COS(R4C18-RC[-11])),"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]=R8C14,RC[-14],"""")"
    Range("P10:S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-14],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:S10").AutoFill Destination:=.Range("N10:S" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P5:T5").Value = Range("O8:S8").Value
    Range("N8:S10009").Clear
    
    Range("U2:U5").FormulaR1C1 = "=IF(AND(RC[-5]<>0,R[-1]C[-5]<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(AND(R[-2]C[-2]<>"""",R[-6]C[-2]-R[-2]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),IF(AND(R[-2]C[-2]="""",R[-6]C[-2]-R[-3]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-3]C[-2]-R9C4)*0.1),IF(AND(R[-2]C[-2]="""",R[-3]C[-2]="""",R[-6]C[-2]-R[-4]C[-2]>R9C4),R[-1]C-((R[-6]C[-2]-R[-4]C[-2]-R9C4)*0.1),R[-1]C)))"
    ActiveSheet.Calculate
    
        If Range("U7") > Range("F7") Then
            Range("A1:E5").Value = Range("P1:T5").Value
            Range("F2:F7").Value = Range("U2:U7").Value
        End If
    Range("P1:U8").Clear
End Sub

Sub Siba()
'
' Siba Macro
'
'Longest ORDS Leg = TP2 & TP3; JLR added 3/20/18

    Range("G2").FormulaR1C1 = "=MIN(RC[-1]:R[4]C[-1])"
    Range("H2").FormulaR1C1 = "=R7C6*.1"
    ActiveSheet.Calculate
    If Range("F2") = Range("G2") And Range("F2") < Range("H2") Then
        Range("P1:U2").Value = Range("A2:F3").Value
        Range("U1").Clear
    
    'CK TP3 & FIN within 10 mins of ORDS 2 & 3
    Range("H5").FormulaR1C1 = "=ABS(R[-1]C[-7]-TASKS!R[36]C[-7])"
    Range("H6").FormulaR1C1 = "=ABS(R[-1]C[-7]-TASKS!R[36]C[-7])"
    Range("J6").Value = 6.94444444444444E-03
    ActiveSheet.Calculate
    
    If Range("H5") < Range("J6") And Range("H6") < Range("J6") Then
        Sheets("Sheet2").Range("P4:T5").Value = Sheets("Tasks").Range("A41:E42").Value
        Range("U5").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    
        
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R2C16,RC[-6]<R4C16),6371*ACOS(SIN(RC[-5])*SIN(R2C17)+COS(RC[-5])*COS(R2C17)*COS(R2C18-RC[-4]))+6371*ACOS(SIN(RC[-5])*SIN(R4C17)+COS(RC[-5])*COS(R4C17)*COS(R4C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P3:T3").Value = Range("H8:L8").Value

Range("U2:U5").FormulaR1C1 = "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R[2]C[-17],R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R[2]C[-17])*0.1))"
    Columns("G:L").Clear
    
    If Range("U7") > Range("F7") Then
    Range("A1:F7").Value = Range("P1: U7").Value
    End If
  End If
 End If
    
    Range("P1:U7").Clear
    
End Sub

Sub AllOrds()
'
' Works for Boettger - no ref to StrDist or O&R
'
Application.ScreenUpdating = False
    Range("B7:C7").FormulaR1C1 = "=MIN(R[3]C:R[10002]C)"
    Range("A8:C8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
   
    Range("G10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=R7C[-5],RC[-5]=R8C[-5],RC[-4]=R7C[-4],RC[-4]=R8C[-4],RC[-6]=R8C[-6]),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P1:T12").Value = Range("G10:L21").Value
    Range("U2:U5").FormulaR1C1 = _
        "=IF(SUM(RC[-5]:RC[-1])<>0,6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    ActiveSheet.Calculate
    Range("A7:C8,G10:K22").Clear

    'Ck dist before Ord 1
  If Range("P1") > Range("A10") Then
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]<R1C[9],6371*ACOS(SIN(RC[-5])*SIN(R1C[10])+COS(RC[-5])*COS(R1C[10])*COS(R1C[11]-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    If Range("G8") > Range("U2") Then
        Range("P13:T13").Value = Range("H8:L8").Value
        
    'Ck dist before above
    Range("A7").FormulaR1C1 = "=R[1]C[7]-R[3]C"
    ActiveSheet.Calculate
    Range("A7").Value = Range("A7").Value
    If Range("A7") >= 1 / 48 Then
        Range("G10").FormulaR1C1 = _
            "=IF(RC[-6]<R13C[9],6371*ACOS(SIN(RC[-5])*SIN(R13C[10])+COS(RC[-5])*COS(R13C[10])*COS(R13C[11]-RC[-4])),"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
        Range("P14:T14").Value = Range("H8:L8").Value
    End If
   End If
  End If
    'Ck dist before landing, if last ord >= 1/48 earlier
    Range("A7").FormulaR1C1 = "=MAX(R[3]C:R[10002]C)-R[-2]C[15]"
    ActiveSheet.Calculate
    Range("A7").Value = Range("A7").Value
    
    If Range("A7") >= 1 / 48 Then
        Range("G10").FormulaR1C1 = _
            "=IF(RC[-6]>R5C[9],6371*ACOS(SIN(RC[-5])*SIN(R5C[10])+COS(RC[-5])*COS(R5C[10])*COS(R5C[11]-RC[-4])),"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P15:T15").Value = Range("H8:L8").Value
    End If
    
    Range("P1:T15").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    'Copy ref P
    Application.Calculation = xlCalculationManual
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "P").End(xlUp).Row
.Range("U2:U2").AutoFill Destination:=.Range("U2:U" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("U2:U15").Value = Range("U2:U15").Value
    
    Range("T16").FormulaR1C1 = "=LARGE(R[-15]C[1]:R[-1]C[1],4)"
    Range("V1").FormulaR1C1 = "=IF(R[1]C[-1]>=R16C[-2],RC[-6],"""")"
    Range("V2:V15").FormulaR1C1 = "=IF(RC[-1]>=R16C[-2],RC[-6],"""")"
    ActiveSheet.Calculate
    Range("V1:V15").Value = Range("V1:V15").Value
    
    Range("P1:V15").Sort Key1:=Range("V1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P6:V16").Clear
    Range("V1:V6").Clear
    
    Range("P1:T5").Sort Key1:=Range("P1"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("U2:U5").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate
    'Test for later Fini
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-6]>R4C[9],6371*ACOS(SIN(RC[-5])*SIN(R4C[10])+COS(RC[-5])*COS(R4C[10])*COS(R4C[11]-RC[-4])),"""")"

 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    If Range("G8") > Range("U5") Then
        Range("P5:T5").Value = Range("H8:L8").Value
    End If
    
    'Range("A1:F5").Value = Range("P1:U5").Value   16DEC
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U6:U7").Value = Range("U6:U7").Value
    
    If Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
    
    Range("A8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)-R[-3]C[15]"
    ActiveSheet.Calculate
    If Range("A8") > 1 / 48 Then
        Application.Run "F.xlsm!AllOrds2"
        If Range("U7") > Range("F7") Then
        Range("A1:F7").Value = Range("P1:U7").Value
        End If
    End If
   End If
    Range("A7:C8").Clear
    Columns("G:U").Clear
    
    Application.Run "F.xlsm!ORBase"

End Sub

Sub TriZords()
'
' Pure ORDS assumes release & landing are NOT ORDs
'
Application.ScreenUpdating = False
    Range("A8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("A8").Value = Range("A8").Value
    Sheets("Sheet2").Range("P10:T13").Value = Sheets("TASKS").Range("A40:E43").Value
    
    Range("I4").FormulaR1C1 = "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("I5").FormulaR1C1 = "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(RC[-4]=R2C[3],"""",IF(AND(RC1>R2C[1],RC1<R3C[1]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("H2:L3").Value = Range("P10:T11").Value
    Range("P14:T14").Value = Range("J8:N8").Value
    
    Range("H2:L3").Value = Range("P11:T12").Value
    Range("P15:T15").Value = Range("J8:N8").Value
    
    Range("H2:L3").Value = Range("P12:T13").Value
    Range("P16:T16").Value = Range("J8:N8").Value
    
    Columns("G:N").Clear
    
    Range("P10:T16").Sort Key1:=Range("P10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    If Range("P1") <> Range("A10") And Range("P16") <> Range("A8") Then
    
    Range("P10:T16").Copy
    Range("H1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("A10:E10").Copy
    Range("G1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("G10:N16").FormulaR1C1 = "=IF(R3C=RC18,0,6371*ACOS(SIN(R2C)*SIN(RC17)+COS(R2C)*COS(RC17)*COS(RC18-R3C)))"
    ActiveSheet.Calculate
    Range("G10:N16").Value = Range("G10:N16").Value
    Range("U19").FormulaR1C1 = "=R[-8]C[-13]+R[-7]C[-12]"
    Range("V19").Value = "123"
    Range("W19").FormulaR1C1 = "=RC[-2]+R[-9]C[-16]"
    Range("U20").FormulaR1C1 = "=R[-8]C[-12]+R[-7]C[-11]"
    Range("V20").Value = "234"
    Range("W20").FormulaR1C1 = "=RC[-2]+R[-9]C[-16]"
    Range("U21").FormulaR1C1 = "=R[-8]C[-11]+R[-7]C[-10]"
    Range("V21").Value = "345"
    Range("W21").FormulaR1C1 = "=RC[-2]+R[-9]C[-16]"
    Range("U22").FormulaR1C1 = "=R[-8]C[-10]+R[-7]C[-9]"
    Range("V22").Value = "456"
    Range("W22").FormulaR1C1 = "=RC[-2]+R[-9]C[-16]"
    Range("U23").FormulaR1C1 = "=R[-8]C[-9]+R[-7]C[-8]"
    Range("V23").Value = "567"
    Range("W23").FormulaR1C1 = "=RC[-2]+R[-9]C[-16]"
    Range("U24").FormulaR1C1 = "=R[-12]C[-13]+R[-11]C[-11]"
    Range("V24").Value = "134"
    Range("W24").FormulaR1C1 = "=RC[-2]+R[-14]C[-16]"
    Range("U25").FormulaR1C1 = "=R[-13]C[-13]+R[-11]C[-11]"
    Range("V25").Value = "135"
    Range("W25").FormulaR1C1 = "=RC[-2]+R[-15]C[-16]"
    Range("U26").FormulaR1C1 = "=R[-14]C[-13]+R[-11]C[-11]"
    Range("V26").Value = "136"
    Range("W26").FormulaR1C1 = "=RC[-2]+R[-16]C[-16]"
    Range("U27").FormulaR1C1 = "=R[-15]C[-13]+R[-11]C[-11]"
    Range("V27").Value = "137"
    Range("W27").FormulaR1C1 = "=RC[-2]+R[-17]C[-16]"
    Range("U28").FormulaR1C1 = "=R[-17]C[-13]+R[-15]C[-12]"
    Range("V28").Value = "124"
    Range("W28").FormulaR1C1 = "=RC[-2]+R[-18]C[-16]"
    Range("U29").FormulaR1C1 = "=R[-18]C[-13]+R[-15]C[-12]"
    Range("V29").Value = "125"
    Range("W29").FormulaR1C1 = "=RC[-2]+R[-19]C[-16]"
    Range("U30").FormulaR1C1 = "=R[-19]C[-13]+R[-15]C[-12]"
    Range("V30").Value = "126"
    Range("W30").FormulaR1C1 = "=RC[-2]+R[-20]C[-16]"
    Range("U31").FormulaR1C1 = "=R[-20]C[-13]+R[-15]C[-12]"
    Range("V31").Value = "127"
    Range("W31").FormulaR1C1 = "=RC[-2]+R[-21]C[-16]"
    Range("U32").FormulaR1C1 = "=R[-20]C[-12]+R[-18]C[-11]"
    Range("V32").Value = "235"
    Range("W32").FormulaR1C1 = "=RC[-2]+R[-21]C[-16]"
    Range("U33").FormulaR1C1 = "=R[-21]C[-12]+R[-18]C[-11]"
    Range("V33").Value = "236"
    Range("W33").FormulaR1C1 = "=RC[-2]+R[-22]C[-16]"
    Range("U34").FormulaR1C1 = "=R[-22]C[-12]+R[-18]C[-11]"
    Range("V34").Value = "237"
    Range("W34").FormulaR1C1 = "=RC[-2]+R[-23]C[-16]"
    Range("U35").FormulaR1C1 = "=R[-22]C[-12]+R[-21]C[-10]"
    Range("V35").Value = "245"
    Range("W35").FormulaR1C1 = "=RC[-2]+R[-24]C[-16]"
    Range("U36").FormulaR1C1 = "=R[-23]C[-12]+R[-21]C[-10]"
    Range("V36").Value = "246"
    Range("W36").FormulaR1C1 = "=RC[-2]+R[-25]C[-16]"
    Range("U37").FormulaR1C1 = "=R[-24]C[-12]+R[-21]C[-10]"
    Range("V37").Value = "247"
    Range("W37").FormulaR1C1 = "=RC[-2]+R[-26]C[-16]"
    Range("U38").FormulaR1C1 = "=R[-24]C[-12]+R[-23]C[-9]"
    Range("V38").Value = "256"
    Range("W38").FormulaR1C1 = "=RC[-2]+R[-27]C[-16]"
    Range("U39").FormulaR1C1 = "=R[-25]C[-12]+R[-23]C[-9]"
    Range("V39").Value = "257"
    Range("W39").FormulaR1C1 = "=RC[-2]+R[-28]C[-16]"
    Range("U40").FormulaR1C1 = "=R[-27]C[-11]+R[-25]C[-10]"
    Range("V40").Value = "346"
    Range("W40").FormulaR1C1 = "=RC[-2]+R[-28]C[-16]"
    Range("U41").FormulaR1C1 = "=R[-28]C[-11]+R[-25]C[-10]"
    Range("V41").Value = "347"
    Range("W41").FormulaR1C1 = "=RC[-2]+R[-29]C[-16]"
    Range("U42").FormulaR1C1 = "=R[-29]C[-13]+R[-28]C[-10]"
    Range("V42").Value = "145"
    Range("W42").FormulaR1C1 = "=RC[-2]+R[-32]C[-16]"
    Range("U43").FormulaR1C1 = "=R[-30]C[-13]+R[-28]C[-10]"
    Range("V43").Value = "146"
    Range("W43").FormulaR1C1 = "=RC[-2]+R[-33]C[-16]"
    Range("U44").FormulaR1C1 = "=R[-31]C[-13]+R[-28]C[-10]"
    Range("V44").Value = "147"
    Range("W44").FormulaR1C1 = "=RC[-2]+R[-34]C[-16]"
    Range("U45").FormulaR1C1 = "=R[-31]C[-13]+R[-30]C[-9]"
    Range("V45").Value = "156"
    Range("W45").FormulaR1C1 = "=RC[-2]+R[-35]C[-16]"
    Range("U46").FormulaR1C1 = "=R[-32]C[-13]+R[-30]C[-9]"
    Range("V46").Value = "157"
    Range("W46").FormulaR1C1 = "=RC[-2]+R[-36]C[-16]"
    Range("U47").FormulaR1C1 = "=R[-32]C[-13]+R[-31]C[-8]"
    Range("V47").Value = "167"
    Range("W47").FormulaR1C1 = "=RC[-2]+R[-37]C[-16]"
    ActiveSheet.Calculate
    Range("U19:W47").Value = Range("U19:W47").Value
    Range("U19:W47").Sort Key1:=Range("W19"), Order1:=xlDescending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("V1").Value = Range("V19").Value
    Range("U19:W47").Clear
    
    Range("V1").TextToColumns Destination:=Range("V1"), DataType:=xlFixedWidth, FieldInfo:=Array(Array(0, 1), Array(1, 1), Array(2, 1)), TrailingMinusNumbers:=True
    
    Range("G1:G5").Copy
    Range("P2").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("P3").FormulaR1C1 = "=IF(R1C[6]=1,R[-2]C[-8],IF(R1C[6]=2,R[-2]C[-7],IF(R1C[6]=3,R[-2]C[-6],IF(R1C[6]=4,R[-2]C[-5],IF(R1C[6]=5,R[-2]C[-4],IF(R1C[6]=6,R[-2]C[-3],R[-2]C[-2]))))))"
    Range("Q3").FormulaR1C1 = "=IF(R1C22=1,R[-1]C8,IF(R1C22=2,R[-1]C9,IF(R1C22=3,R[-1]C10,IF(R1C22=4,R[-1]C11,IF(R1C22=5,R[-1]C12,IF(R1C22=6,R[-1]C13,R[-1]C14))))))"
    Range("R3").FormulaR1C1 = "=IF(R1C22=1,RC8,IF(R1C22=2,RC9,IF(R1C22=3,RC10,IF(R1C22=4,RC11,IF(R1C22=5,RC12,IF(R1C22=6,RC13,RC14))))))"
    Range("S3").FormulaR1C1 = "=IF(R1C22=1,R[1]C8,IF(R1C22=2,R[1]C9,IF(R1C22=3,R[1]C10,IF(R1C22=4,R[1]C11,IF(R1C22=5,R[1]C12,IF(R1C22=6,R[1]C13,R[1]C14))))))"
    Range("T3").FormulaR1C1 = "=IF(R1C22=1,R[2]C8,IF(R1C22=2,R[2]C9,IF(R1C22=3,R[2]C10,IF(R1C22=4,R[2]C11,IF(R1C22=5,R[2]C12,IF(R1C22=6,R[2]C13,R[2]C14))))))"
    Range("P4").FormulaR1C1 = "=IF(R1C[7]=2,R[-3]C[-7],IF(R1C[7]=3,R[-3]C[-6],IF(R1C[7]=4,R[-3]C[-5],IF(R1C[7]=5,R[-3]C[-4],IF(R1C[7]=6,R[-3]C[-3],R[-3]C[-2])))))"
    Range("Q4").FormulaR1C1 = "=IF(R1C[6]=2,R[-2]C[-8],IF(R1C[6]=3,R[-2]C[-7],IF(R1C[6]=4,R[-2]C[-6],IF(R1C[6]=5,R[-2]C[-5],IF(R1C[6]=6,R[-2]C[-4],R[-2]C[-3])))))"
    Range("R4").FormulaR1C1 = "=IF(R1C[5]=2,R[-1]C[-9],IF(R1C[5]=3,R[-1]C[-8],IF(R1C[5]=4,R[-1]C[-7],IF(R1C[5]=5,R[-1]C[-6],IF(R1C[5]=6,R[-1]C[-5],R[-1]C[-4])))))"
    Range("S4").FormulaR1C1 = "=IF(R1C[4]=2,RC[-10],IF(R1C[4]=3,RC[-9],IF(R1C[4]=4,RC[-8],IF(R1C[4]=5,RC[-7],IF(R1C[4]=6,RC[-6],RC[-5])))))"
    Range("T4").FormulaR1C1 = "=IF(R1C[3]=2,R[1]C[-11],IF(R1C[3]=3,R[1]C[-10],IF(R1C[3]=4,R[1]C[-9],IF(R1C[3]=5,R[1]C[-8],IF(R1C[3]=6,R[1]C[-7],R[1]C[-6])))))"
    Range("P5").FormulaR1C1 = "=IF(R1C24=3,R[-4]C10,IF(R1C24=4,R[-4]C11,IF(R1C24=5,R[-4]C12,IF(R1C24=6,R[-4]C13,R[-4]C14))))"
    Range("Q5").FormulaR1C1 = "=IF(R1C24=3,R[-3]C10,IF(R1C24=4,R[-3]C11,IF(R1C24=5,R[-3]C12,IF(R1C24=6,R[-3]C13,R[-3]C14))))"
    Range("R5").FormulaR1C1 = "=IF(R1C24=3,R[-2]C10,IF(R1C24=4,R[-2]C11,IF(R1C24=5,R[-2]C12,IF(R1C24=6,R[-2]C13,R[-2]C14))))"
    Range("S5").FormulaR1C1 = "=IF(R1C24=3,R[-1]C10,IF(R1C24=4,R[-1]C11,IF(R1C24=5,R[-1]C12,IF(R1C24=6,R[-1]C13,R[-1]C14))))"
    Range("T5").FormulaR1C1 = "=IF(R1C24=3,RC10,IF(R1C24=4,RC11,IF(R1C24=5,RC12,IF(R1C24=6,RC13,RC14))))"
    ActiveSheet.Calculate
    Range("P2:T5").Value = Range("P2:T5").Value
    
    Columns("G:N").Clear
    
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R5C16,6371*ACOS(SIN(RC[-5])*SIN(R5C17)+COS(RC[-5])*COS(R5C17)*COS(R5C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
ActiveSheet.Calculate
    
    Range("P6:T6").Value = Range("H8:L8").Value
    
    Range("U3:U6").FormulaR1C1 = "=IF(AND(R[-1]C[-5]<>0, RC[-5]<>0),6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("U7").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U8").FormulaR1C1 = "=IF(R[-6]C[-2]-R[-2]C[-2]<=R9C4,R[-1]C,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1))"
    ActiveSheet.Calculate
    Range("U3:U8").Value = Range("U3:U8").Value
    Range("V1:X1,P10:T16").Clear
    Columns("G:L").Clear
    
    If Range("U8") > Range("F7") Then
        Range("A1:F7").Value = Range("P2:U8").Value
        Range("P2:U8").Clear
    End If
  End If
  
End Sub
Sub TP3b()
'
' For Jonker (TP3 = max off course TP2 / St Dist Fini) Revised 7/17/2018 remove conflicting longitudes
'
Application.ScreenUpdating = False
    Range("P15:T16").Value = Range("P1:T2").Value
  
   'MAX off course before ST DIST Fini
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1<R3C[1],RC3<>R2C[3]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-2]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N10009").Value = Range("J10:N10009").Value
    Range("G10:I10009").Clear
    Range("J10:N10009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("P17:T17").Value = Range("J10:N10").Value
    Range("J10:N10").Clear
    'Off course from previous to ST DIST FINI
    Range("H2:L2").Value = Range("P17:T17").Value
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC1>R2C[1],RC[-6]<R3C8,RC3<>R2C10),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),"""")"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-2]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("P18:T18").Value = Range("J8:N8").Value
    Range("P19:T19").Value = Range("H3:L3").Value
    
    Range("P15:T19").Sort Key1:=Range("P15"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("O16:O19").FormulaR1C1 = _
        "=IF(OR(R[-1]C[1]=0,RC[1]=0),0,6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(R[-1]C[3]-RC[3])))"
    Range("O20").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("P20").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[-1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P18:T20").Value = Range("P18:T20").Value
    Range("M8:N10009").Clear
 
 If Range("P20") < Range("O20") Then
    Range("A7").Value = 2.08333333333333E-02
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R15C16-R7C1,RC[-6]<=R15C16+R7C1,RC[-3]-R19C19<=R9C4),6371*ACOS(SIN(RC[-5])*SIN(R16C17)+COS(RC[-5])*COS(R16C17)*COS(R16C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("E7").FormulaR1C1 = "=R16C15-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R20C15-R20C16,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
    If Range("E7") < Range("E8") And Range("G8") <> 0 Then

    Range("P22:T22").Value = Range("H8:L8").Value
    Range("P23:T26").Value = Range("P16:T19").Value
    
    Range("O23:O26").FormulaR1C1 = _
        "=IF(OR(R[-1]C[1]=0,RC[1]=0),0,6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])))"
    Range("O27").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    ActiveSheet.Calculate
    Range("O23:O27").Value = Range("O23:O27").Value
    
    Range("P27").FormulaR1C1 = _
        "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P27").Value = Range("P27").Value
    End If
  End If
   
'For Vihlen eg OFC Ord 2/3
    Range("H2:L3").Value = Range("P2:T3").Value
    Range("G10").FormulaR1C1 = _
        "=IF(RC3=R2C[3],"""",IF(AND(RC1>R2C8,RC1<R3C8),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J8:N8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("P29:T30").Value = Range("P1:T2").Value
    Range("P31:T31").Value = Range("J8:N8").Value
    Range("P32:T32").Value = Range("H3:L3").Value
    
    Range("G10:N10009").Clear
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = "=IF(RC[-6]>R32C[9],6371*ACOS(SIN(RC[-5])*SIN(R32C17)+COS(RC[-5])*COS(R32C17)*COS(R32C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    'Copy Ref A
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("P33:T33").Value = Range("H8:L8").Value
    
    Range("O30:O33").FormulaR1C1 = "=IF(AND(RC[1]<>"""",R[-1]C[1]<>0,RC[1]<>0),6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])),0)"
    Range("O34").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("P34").FormulaR1C1 = "=IF(R[-5]C[3]-R[-1]C[3]<=R9C4,RC[-1],RC[-1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1))"
    ActiveSheet.Calculate
    Range("O30:P34").Value = Range("O30:P34").Value
    
    Range("G8:N10009").Clear
    
    If Range("P34") < Range("O34") Then
    Range("A7").Value = 2.08333333333333E-02
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R29C16-R7C1,RC[-6]<=R29C16+R7C1,RC[-3]-R33C19<=R9C4),6371*ACOS(SIN(RC[-5])*SIN(R30C17)+COS(RC[-5])*COS(R30C17)*COS(R30C18-RC[-4])),"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
 With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("E7").FormulaR1C1 = "=R30C15-R8C7"
    Range("E8").FormulaR1C1 = "=IF(R[-1]C>0,R34C15-R34C16,0)"
    ActiveSheet.Calculate
    Range("E7:E8").Value = Range("E7:E8").Value
    
    If Range("E7") < Range("E8") And Range("G8") <> 0 Then

    Range("P36:T36").Value = Range("H8:L8").Value
    Range("P37:T40").Value = Range("P30:T34").Value
    
    Range("O37:O40").FormulaR1C1 = _
        "=IF(AND(RC[1]<>"""",R[-1]C[1]<>0,RC[1]<>0),6371*ACOS(SIN(R[-1]C[2])*SIN(RC[2])+COS(R[-1]C[2])*COS(RC[2])*COS(RC[3]-R[-1]C[3])),0)"
    Range("O41").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    ActiveSheet.Calculate
    Range("O37:O41").Value = Range("O37:O41").Value
    
    Range("P41").FormulaR1C1 = "=IF(R[-5]C[3]-R[-1]C[3]>R9C4,RC[1]-((R[-5]C[3]-R[-1]C[3]-R9C4)*0.1),RC[-1])"
    ActiveSheet.Calculate
    Range("P41").Value = Range("P41").Value
    End If
  End If
  
End Sub

Sub CK3TP()
'
' 7/27/17 JLR Consolidated w/ Refine3TP for brevity; 8/24/17 corrected "Ref" to "REF" for proper checking
'
Application.ScreenUpdating = False
    Range("H12:L16").Value = Range("A1:E5").Value
    Range("G10").FormulaR1C1 = "=SUM(R13C:R16C)"
    Range("G11").FormulaR1C1 = "=IF(R12C[4]-R16C[4]>R9C4,R10C-((R12C[4]-R16C[4]-R9C4)*.1),R10C)"
    Range("G13:G16").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[2])*SIN(R[-1]C[2])+COS(RC[2])*COS(R[-1]C[2])*COS(R[-1]C[3]-RC[3]))"
    ActiveSheet.Calculate
    'Check TP1
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("G20").FormulaR1C1 = _
        "=IF(AND(R[-10]C1>R12C[1],R[-10]C1<R14C[1]),6371*ACOS(SIN(R[-10]C2)*SIN(R12C[2])+COS(R[-10]C2)*COS(R12C[2])*COS(R12C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate

    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    
    Range("G20").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[2])*SIN(R[-6]C[2])+COS(R[-1]C[2])*COS(R[-6]C[2])*COS(R[-6]C[3]-R[-1]C[3]))"
    Range("G22").FormulaR1C1 = "=R[-3]C+R[-2]C+R[-7]C+R[-6]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        Range("H13:L13").Value = Range("H19:L19").Value
    End If
    
    'Check TP2
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    
    Range("G20").FormulaR1C1 = _
        "=IF(AND(R[-10]C1>R13C[1],R[-10]C1<R15C[1]),6371*ACOS(SIN(R[-10]C2)*SIN(R13C[2])+COS(R[-10]C2)*COS(R13C[2])*COS(R13C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
 
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    Range("G20").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-1]C[2])*SIN(R[-5]C[2])+COS(R[-1]C[2])*COS(R[-5]C[2])*COS(R[-5]C[3]-R[-1]C[3]))"
    Range("G22").FormulaR1C1 = "=R[-3]C+R[-2]C+R[-9]C+R[-6]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        Range("H14:L14").Value = Range("H19:L19").Value
    End If
    
    'CK TP3
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("G20").FormulaR1C1 = _
        "=IF(AND(R[-10]C1>R14C[1],R[-10]C1<R16C[1]),6371*ACOS(SIN(R[-10]C2)*SIN(R14C[2])+COS(R[-10]C2)*COS(R14C[2])*COS(R14C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
    
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    Range("G20").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-6]C[2])*SIN(R[-1]C[2])+COS(R[-6]C[2])*COS(R[-1]C[2])*COS(R[-1]C[3]-R[-6]C[3]))"
    'next 2 lines changed 1/7/13 to consider effect on leg 4 (Jonker)
    Range("G21").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-5]C[2])*SIN(R[-2]C[2])+COS(R[-5]C[2])*COS(R[-2]C[2])*COS(R[-2]C[3]-R[-5]C[3]))"
    Range("G22").FormulaR1C1 = "=R[-9]C+R[-8]C+R[-2]C+R[-1]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        Range("H15:L15").Value = Range("H19:L19").Value
    End If
   
    'CK Start
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("G20").FormulaR1C1 = _
        "=IF(R[-10]C1<R13C[1],6371*ACOS(SIN(R[-10]C2)*SIN(R13C[2])+COS(R[-10]C2)*COS(R13C[2])*COS(R13C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
 
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    
    Range("G22").FormulaR1C1 = "=R[-8]C+R[-7]C+R[-6]C+R[-3]C"
    Range("G23").FormulaR1C1 = "=IF(R[-4]C[4]-R[-7]C[4]>R9C4,R[-1]C-(R[-4]C[4]-R[-7]C[4]-R9C4)*.1,R[-1]C)"
    ActiveSheet.Calculate
    
    If Range("G23") > Range("G11") Then
        Range("H12:L12").Value = Range("H19:L19").Value
    End If
    
    'Reverse CK
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("M19").FormulaR1C1 = "=SUM(RC[-5]:RC[-1])"
    Range("G20").FormulaR1C1 = _
        "=IF(AND(R[-10]C[-6]>R15C[1],R[-10]C[-6]<R16C[1]),6371*ACOS(SIN(R[-10]C[-5])*SIN(R16C[2])+COS(R[-10]C[-5])*COS(R16C[2])*COS(R16C[3]-R[-10]C[-4])),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C[-7],"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
  If Range("M19") <> 0 Then
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G21").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-7]C[2])*SIN(R[-2]C[2])+COS(R[-7]C[2])*COS(R[-2]C[2])*COS(R[-2]C[3]-R[-7]C[3]))"
    Range("G22").FormulaR1C1 = "=R[-1]C+R[-3]C+R[-8]C+R[-9]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        Range("H15:L15").Value = Range("H19:L19").Value
    End If
   End If
    Range("G20:L60019").Clear
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    
    Range("G20").FormulaR1C1 = _
        "=IF(AND(R[-10]C[-6]>R13C[1],R[-10]C[-6]<R14C[1]),6371*ACOS(SIN(R[-10]C[-5])*SIN(R14C[2])+COS(R[-10]C[-5])*COS(R14C[2])*COS(R14C[3]-R[-10]C[-4])),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C[-7],"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
  If Range("M19") <> 0 Then
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G21").FormulaR1C1 = _
        "=6371*ACOS(SIN(R[-9]C[2])*SIN(R[-2]C[2])+COS(R[-9]C[2])*COS(R[-2]C[2])*COS(R[-2]C[3]-R[-9]C[3]))"
    Range("G22").FormulaR1C1 = "=R[-1]C+R[-3]C+R[-6]C+R[-7]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        Range("H13:L13").Value = Range("H19:L19").Value
    End If
   End If
    Range("G20:L60019").Clear
    'CK FINI
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("G20").FormulaR1C1 = _
        "=IF(R[-10]C1>R15C[1],6371*ACOS(SIN(R[-10]C2)*SIN(R15C[2])+COS(R[-10]C2)*COS(R15C[2])*COS(R15C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
 
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    
    Range("G22").FormulaR1C1 = "=R[-9]C+R[-8]C+R[-7]C+R[-3]C"
    ActiveSheet.Calculate
    
    If Range("G22") > Range("G10") Then
        'Range("H16:L16").Value = Range("H19:L19").Value
        Range("G16:L16").Value = Range("G19:L19").Value
    End If
    
    If Range("G11") > Range("F7") Then
        Range("A1:E5").Value = Range("H12:L16").Value
        Range("F2:F5").Value = Range("G13:G16").Value
        Range("F6:F7").Value = Range("G10:G11").Value
    End If
     Range("G20:L60019").Clear
    'CK later Fini
    Range("G19:L19").FormulaR1C1 = "=MAX(R[1]C:R[60000]C)"
    Range("G20").FormulaR1C1 = _
        "=IF(R[-10]C1>R16C[1],6371*ACOS(SIN(R[-10]C2)*SIN(R16C[2])+COS(R[-10]C2)*COS(R16C[2])*COS(R16C[3]-R[-10]C3)),"""")"
    Range("H20").FormulaR1C1 = "=IF(RC[-1]=R19C[-1],R[-10]C1,"""")"
    Range("I20:L20").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-10]C[-7],"""")"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G20:L20").AutoFill Destination:=.Range("G20:L" & LastRow), Type:=xlFillDefault
    End With
 ActiveSheet.Calculate
 
  If Range("M19") <> 0 Then
    Range("G19:L19").Value = Range("G19:L19").Value
    Range("G20:L60019").Clear
    
    Range("G22").FormulaR1C1 = "=R[-8]C+R[-7]C+R[-6]C+R[-3]C"
    Range("G23").FormulaR1C1 = "=IF(R[-10]C[4]-R[-4]C[4]>R9C4,R[-1]C-(R[-10]C[4]-R[-4]C[4]-R9C4)*.1,R[-1]C)"
    ActiveSheet.Calculate
    
    If Range("G23") > Range("G11") Then
        Range("G12:L12").Value = Range("G13:L13").Value
        Range("G13:L13").Value = Range("G14:L14").Value
        Range("G14:L14").Value = Range("G15:L15").Value
        Range("G15:L15").Value = Range("G16:L16").Value
        Range("G16:L16").Value = Range("G19:L19").Value
    End If
    
    Range("G19").FormulaR1C1 = "=6371*ACOS(SIN(RC[2])*SIN(R[-4]C[2])+COS(RC[2])*COS(R[-4]C[2])*COS(R[-4]C[3]-RC[3]))"
    ActiveSheet.Calculate
    
    If Range("G19") > Range("G16") Then
        Range("G16:L16").Value = Range("G19:L19").Value
    End If
   End If
    If Range("G11") > Range("F7") Then
        Range("A1:E5").Value = Range("H12:L16").Value
        Range("F2:F5").Value = Range("G13:G16").Value
        Range("F6:F7").Value = Range("G10:G11").Value
    End If
     
    Range("P1:T3").Value = Range("H12:L14").Value
    Range("U2:U3").Value = Range("G13:G14").Value
    Columns("G:L").Clear
  
    Range("H2:L2").Value = Range("P3:T3").Value
    Range("H3:L3").Value = Range("A5:E5").Value
    'OffCourse TP2 to Fini
    Range("I4").FormulaR1C1 = _
        "=ACOS(SIN(R2C)*SIN(R3C)+COS(R2C)*COS(R3C)*COS(R3C[1]-R2C[1]))"
    Range("I5").FormulaR1C1 = _
        "=ACOS((SIN(R3C)-SIN(R2C)*COS(R[-1]C))/(SIN(R[-1]C)*COS(R2C)))"
    'MAX Off Course
     Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C[3],"""",IF(AND(RC1>R2C[1],RC1<R3C[1]),ACOS(SIN(R2C[2])*SIN(RC2)+COS(R2C[2])*COS(RC2)*COS(RC3-R2C[3])),""""))"
    Range("H10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ACOS((SIN(RC2)-SIN(R2C[1])*COS(RC[-1]))/(SIN(RC[-1])*COS(R2C[1]))),"""")"
    Range("I10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",ABS((ASIN(SIN(RC[-2])*SIN(RC[-1]-R5C))*180*60*1.852/PI())),"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]=R4C[1],RC1,"""")"
    Range("K10:N10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-9],"""")"
    
    Range("K4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    Range("L4").FormulaR1C1 = "=MAX(R[6]C[-2]:R[10005]C[-2])"
    
 With ActiveSheet
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:N10").AutoFill Destination:=.Range("G10:N" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("J10:N60009").Value = Range("J10:N60009").Value
    Range("G10:I60009").Clear
    Range("J10:N60009").Sort Key1:=Range("J10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("P4:T4").Value = Range("J10:N10").Value
    Range("P5:T5").Value = Range("A5:E5").Value
    Range("U4").FormulaR1C1 = _
        "=IF(RC[-4]<>"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),"""")"
    Range("U5").FormulaR1C1 = _
        "=IF(OR(RC[-4]="""",R[-1]C[-4]=""""),"""",6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    Range("U6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("U7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("U4:U7").Value = Range("U4:U7").Value
  
    If Range("U7") > Range("F7") Then
        Range("A1:E5").Value = Range("P1:T5").Value
        Range("F2:F7").Value = Range("U2:U7").Value
    End If
  
    Columns("G:U").Clear
    Application.Run "F.xlsm!Fixxer"

End Sub

Sub ORDS5a()
'
' LoHmatrix after ORDS5,testing +/-18 seconds
'
Application.ScreenUpdating = False
    Sheets("Sheet3").Activate
    Range("A7").Value = 2.08333333333333E-04
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>R4C1,RC[-6]>=R5C1-R7C1,RC[-6]<=R5C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
 With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("G10:K50").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=True
    Columns("G:K").Clear
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C1-R7C1,RC[-6]<=R1C1+R7C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC8)*SIN(R2C2)+COS(RC8)*COS(R2C2)*COS(R2C3-RC9)),"""")"
    
 With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G10:L60009").Value = Range("G10:L60009").Value
    Range("G10:L60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N6:AY6").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=R[-2]C3),"""",6371*ACOS(SIN(R2C)*SIN(R[-2]C2)+COS(R2C)*COS(R[-2]C2)*COS(R[-2]C3-R3C)))"
    ActiveSheet.Calculate
    Range("N6:AY6").Value = Range("N6:AY6").Value
        
    'Matrix
    Range("N10:AY50").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC8=""""),"""",IF(RC10-R4C>R9C4,(RC12+R6C)-((RC10-R4C-R9C4)*0.1),RC12+R6C))"
    Range("I5").FormulaR1C1 = "=MAX(R[5]C[5]:R[55]C[42])"
    ActiveSheet.Calculate
    Range("I5").Value = Range("I5").Value
    Range("N10:AY60").Value = Range("N10:AY60").Value
    Range("N7:AY7").FormulaR1C1 = "=IF(MAX(R[3]C:R[10002]C)=R5C9,1,"""")"
    ActiveSheet.Calculate
    Range("N7:AY7").Value = Range("N7:AY7").Value
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C9,1,"""")"
    
 With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M10009").Value = Range("M10:M10009").Value
    
    Range("N10:AY60").Clear
    
    Range("N10").FormulaR1C1 = "=IF(RC[-1]=1,RC[-7],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"

 With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("H1:L1").FormulaR1C1 = "=MAX(R[9]C[6]:R[10008]C[6])"
    ActiveSheet.Calculate
    Range("A1:E1").Value = Range("H1:L1").Value
    Range("N10:R10009").Clear
    
    Range("N10:AY10").FormulaR1C1 = "=IF(R[-3]C=1,R[-9]C,"""")"
    Range("N11:AY14").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-9]C,"""")"
    
    Range("H5").FormulaR1C1 = "=MAX(R[5]C[6]:R[5]C[44])"
    Range("I5").FormulaR1C1 = "=MAX(R[6]C[5]:R[6]C[43])"
    Range("J5").FormulaR1C1 = "=MAX(R[7]C[4]:R[7]C[42])"
    Range("K5").FormulaR1C1 = "=MAX(R[8]C[3]:R[8]C[41])"
    Range("L5").FormulaR1C1 = "=MAX(R[9]C[2]:R[9]C[40])"
    ActiveSheet.Calculate
    Range("A5:E5").Value = Range("H5:L5").Value
    
    Columns("G:AY").Clear
    Range("F2:F5").FormulaR1C1 = _
        "=6371*ACOS(SIN(RC[-4])*SIN(R[-1]C[-4])+COS(RC[-4])*COS(R[-1]C[-4])*COS(R[-1]C[-3]-RC[-3]))"
    Range("F6").FormulaR1C1 = "=SUM(R[-4]C:R[-1]C)"
    Range("F7").FormulaR1C1 = _
        "=IF(R[-6]C[-2]-R[-2]C[-2]>R9C4,R[-1]C-((R[-6]C[-2]-R[-2]C[-2]-R9C4)*0.1),R[-1]C)"
    ActiveSheet.Calculate
    Range("F2:F7").Value = Range("F2:F7").Value

End Sub

Sub Vince()
'
' Geodetic Official distances
'
Application.ScreenUpdating = False
Range("A1").FormulaR1C1 = "=Sheet2!R[8]C[3]"
Range("A2").FormulaR1C1 = "=Sheet2!R[7]C[4]"
Range("A1:A2").Value = Range("A1:A2").Value

    'Straight
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D10").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E10").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D11").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E11").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L11:M11").Value = Sheets("YDWK3").Range("F37").Value
    
    'O&R
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D14").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E14").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D15").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E15").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L15").Value = Sheets("YDWK3").Range("F37").Value
    Sheets("Tasks").Range("M15").FormulaR1C1 = "=2*RC[-1]"
    ActiveSheet.Calculate
    Sheets("Tasks").Range("M15").Value = Sheets("Tasks").Range("M15").Value
    
    'PilotOption
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D20").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E20").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D21").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E21").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L21").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D21").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E21").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D22").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E22").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L22").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D22").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E22").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D23").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E23").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L23").Value = Sheets("YDWK3").Range("F37").Value
    
    Sheets("YDWK3").Range("E39").Value = Sheets("Tasks").Range("D23").Value
    Sheets("YDWK3").Range("E40").Value = Sheets("Tasks").Range("E23").Value
    Sheets("YDWK3").Range("E41").Value = Sheets("Tasks").Range("D24").Value
    Sheets("YDWK3").Range("E42").Value = Sheets("Tasks").Range("E24").Value
    Sheets("YDWK3").Calculate
    Sheets("Tasks").Range("L24").Value = Sheets("YDWK3").Range("F37").Value
    Sheets("Tasks").Range("M24").FormulaR1C1 = "=SUM(R[-3]C[-1]:RC[-1])"
    Sheets("Tasks").Range("M24").Value = Sheets("Tasks").Range("M24").Value
    
    Application.Run "F.xlsm!YDWK3clear"
    
    Sheets("TASKS").Activate
    Range("N11").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,ROUND(R[-1]C[-6]-RC[-6],0)<=R1C1),AND(RC[-1]<=100,R2C1<>""PR"",ROUND(R[-1]C[-6]-RC[-6],0)<=10*RC[-1]),AND(RC[-1]<=100,R2C1=""PR"",ROUND(R[-1]C[-6]-RC[-6],0)<10*RC[-1]-100)),RC[-1],IF(AND(RC[-1]>100,ROUND(R[-1]C[-6]-RC[-6],0)>R1C1),RC[-1]-((ROUND(R[-1]C[-6]-RC[-6],0)-R1C1)*0.1),0))"
    Range("M12").FormulaR1C1 = "=IF(R[-1]C[1]<R[-1]C,""LoH"","""")"
    ActiveSheet.Calculate
    Range("M12").Value = Range("M12").Value
    Range("M11").Value = Range("N11").Value
    
    Range("N15").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,ROUND(R[-1]C[-6]-R[2]C[-6],0)<=R1C1),AND(RC[-1]<=100,R2C1<>""PR"",ROUND(R[-1]C[-6]-R[2]C[-6],0)<=10*RC[-1]),AND(RC[-1]<=100,R2C1=""PR"",ROUND(R[-1]C[-6]-R[2]C[-6],0)<10*RC[-1]-100)),RC[-1],IF(AND(RC[-1]>100,ROUND(R[-1]C[-6]-R[2]C[-6],0)>R1C1),RC[-1]-((ROUND(R[-1]C[-6]-R[2]C[-6],0)-R1C1)*0.1),0))"
    Range("M17").FormulaR1C1 = "=IF(R[-2]C[1]<R[-2]C,""LoH"","""")"
    ActiveSheet.Calculate
    Range("M17").Value = Range("M17").Value
    Range("M15").Value = Range("N15").Value
    
    Range("N24").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,ROUND(R[-4]C[-6]-RC[-6],0)<=R1C1),AND(RC[-1]<=100,R2C1<>""PR"",ROUND(R[-4]C[-6]-RC[-6],0)<=10*RC[-1]),AND(RC[-1]<=100,R2C1=""PR"",ROUND(R[-4]C[-6]-RC[-6],0)<10*RC[-1]-100)),RC[-1],IF(AND(RC[-1]>100,ROUND(R[-4]C[-6]-RC[-6],0)>R1C1),RC[-1]-((ROUND(R[-4]C[-6]-RC[-6],0)-R1C1)*0.1),0))"
    Range("M25").FormulaR1C1 = "=IF(R[-1]C[1]<R[-1]C,""LoH"","""")"
    ActiveSheet.Calculate
    Range("M25").Value = Range("M25").Value
    Range("M24").Value = Range("N24").Value
    
    Range("N11,N15,N24").Clear
    
    If Range("F17") = "   FINISH SECTOR" And Range("C10") >= 42278 Then
            Range("C18:M18").Value = "Note: Per SC3 rules on this flight date, Out & Return courses require Finish Line crossing"
    End If
End Sub



-------------------------------------------------------------------------------
VBA MACRO Module2.bas 
in file: F_vbaProject.bin - OLE stream: 'VBA/Module2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
#If VBA7 And Win64 Then
    Dim LastRow As LongPtr
#Else
    Dim LastRow As Long
#End If

Sub NewOR1()
'
' Ck STDstartTP (all options) AMENDED 1/19/14 for start accuracy Schmelzer tested w/JP 2013 OK Amended 7/24/2017 for brevity See '''
' JLR 4/5/20218 Amended for SibLap, reversed Leg ck order; Matrix includes LoH; 4/17/2018 Amended Last Leg calc N10 relative to max Leg 1
' JLR 5/15/2018 Matric revised""; 5/16/2018 Matrix revised
'
    Application.ScreenUpdating = False
If Range("A10") = Range("A1") Then
    Application.Run "F.xlsm!NewOR2"
    Exit Sub
ElseIf Range("A10") < Range("A1") Then
    
    'First Leg longest 1000 if >1000, longest 500 if 500 - 999, > medidan if < 500
    Range("F10:F10009").FormulaR1C1 = "=IF(AND(RC[-5]<>"""",RC[-5]<R1C1),6371*ACOS(SIN(RC[-4])*SIN(R1C2)+COS(RC[-4])*COS(R1C2)*COS(R1C3-RC[-3])),"""")"
    
    Range("F7").FormulaR1C1 = "=MAX(R[3]C:R[10002]C)"
    Range("F8").FormulaR1C1 = "=IF(R1009C6<>"""",LARGE(R[2]C:R[10001]C,1000),IF(R509C6<>"""",LARGE(R[2]C:R[501]C,500),MEDIAN(R[2]C:R[501]C)))"
    ActiveSheet.Calculate
    Range("F7:F10009").Value = Range("F7:F10009").Value
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-1]<>"""",RC[-1]>=R8C6),RC[-6],"""")"
    Range("H10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R1C2)+COS(RC[-10])*COS(R1C2)*COS(R1C3-RC[-9])),"""")"
    'Copy Ref A Value
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("F10:F10009").Clear
    
    'LAST Legs >= nth First Leg
    Range("M10:M10009").FormulaR1C1 = "=IF(AND(RC[-12]<>"""",RC[-12]>R1C1),6371*ACOS(SIN(RC[-11])*SIN(R1C2)+COS(RC[-11])*COS(R1C2)*COS(R1C3-RC[-10])),"""")"
    Range("M8").Value = Range("F8").Value
    ActiveSheet.Calculate
    
    Range("N10").FormulaR1C1 = "=IF(AND(RC[-13]>R1C1,RC[-1]<>"""",RC[-1]>=R8C13,RC[-1]<=R7C6),RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:S10").AutoFill Destination:=.Range("N10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("N10:S10009").Value = Range("N10:S10009").Value
    Range("N10:S10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("M10:M10009").Clear
    
    ''''NEXT FOUR LINES 7/24/2017; amended w/conditional 8/27/17; amended 4/15/2018
    If Range("G500") <> "" Then
        Range("L8").FormulaR1C1 = "=2*(RC[1]-5)"
        ActiveSheet.Calculate
        Range("L8").Value = Range("L8").Value
    ElseIf Range("G500") = "" Then
        Range("L8").FormulaR1C1 = "=2*(MAX(R[2]C:R[10001]C))"
        ActiveSheet.Calculate
        Range("L8").Value = Range("L8").Value
        If Range("L8") < 50 Then
           Range("G8:L500").Clear
           Application.Run "F.xlsm!NewOR2"
           Exit Sub
        End If
    End If
    
    Range("G10:L509").Copy
    Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    'MATRIX
    'Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    ''Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,R[1]C19<RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    'Range("U10:SZ10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",2*R6C))"
    'Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19, AND(R[-1]C19<RC19,R[1]C19<RC19),6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    ''Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19, AND(R[-1]C19<RC19,R[1]C19<RC19),6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,R6C+RC19,(R6C+RC19)-((R4C-RC17-R9C4)*0.1))))"
    Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,R[1]C19<RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,R6C+RC19,(R6C+RC19)-((R4C-RC17-R9C4)*0.1))))"
    'Copy Ref N
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "N").End(xlUp).Row
.Range("U10:SZ10").AutoFill Destination:=.Range("U10:SZ" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N1").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
    Range("O1").FormulaR1C1 = "=MAX(R7C21:R7C520)"
    Range("P1").FormulaR1C1 = "=MIN(R10C20:R10009C20)"

    Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(R[3]C:R[10002]C)=R1C14),R[-6]C,"""")"
    Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(RC[1]:RC[500])=R1C14),RC[-6],"""")"
    ActiveSheet.Calculate
    Range("N1:P1").Value = Range("N1:P1").Value
    
    If Range("G510") <> "" Then
        Range("G510:L1009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(R[3]C:R[10002]C)=R2C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(RC[1]:RC[500])=R2C14),RC[-6],"""")"
        Range("N2").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("O2").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("P2").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("N2:P2").Value = Range("N2:P2").Value
    Else: Range("N2:P2").Clear
    End If
    
    If Range("G1010") <> "" Then
        Range("G1010:L1509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(R[3]C:R[10002]C)=R3C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(RC[1]:RC[500])=R3C14),RC[-6],"""")"
        Range("N3").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("O3").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("P3").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("N3:P3").Value = Range("N3:P3").Value
    Else: Range("N3:P3").Clear
    End If
    
    If Range("G1510") <> "" Then
        Range("G1510:L2009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(R[3]C:R[10002]C)=R4C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(RC[1]:RC[500])=R4C14),RC[-6],"""")"
        Range("N4").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("O4").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("P4").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("N4:P4").Value = Range("N4:P4").Value
    Else: Range("N4:P4").Clear
    End If
    
    If Range("G2010") <> "" Then
        Range("G2010:L2509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(R[3]C:R[10002]C)=R5C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(RC[1]:RC[500])=R5C14),RC[-6],"""")"
        Range("N5").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("O5").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("P5").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("N5:P5").Value = Range("N5:P5").Value
    Else: Range("N5:P5").Clear
    End If
    
    If Range("G2510") <> "" Then
        Range("G2510:L3009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C17<>0,MAX(R[3]C:R[10002]C)=R1C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C17<>0,MAX(RC[1]:RC[500])=R1C17),RC[-6],"""")"
        Range("Q1").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("R1").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("S1").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("Q1:S1").Value = Range("Q1:S1").Value
    Else: Range("Q1:S1").Clear
    End If
    
    If Range("G3010") <> "" Then
        Range("G3010:L3509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R2C17<>0,MAX(R[3]C:R[10002]C)=R2C17),R[-6]C,"""")"
        Range("T10:T0009").FormulaR1C1 = "=IF(AND(R2C17<>0,MAX(RC[1]:RC[500])=R2C17),RC[-6],"""")"
        Range("Q2").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("R2").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("S2").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("Q2:S2").Value = Range("Q2:S2").Value
    Else: Range("Q2:S2").Clear
    End If
    
    If Range("G3510") <> "" Then
        Range("G3510:L4009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R3C17<>0,MAX(R[3]C:R[10002]C)=R3C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R3C17<>0,MAX(RC[1]:RC[500])=R3C17),RC[-6],"""")"
        Range("Q3").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("R3").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("S3").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("Q3:S3").Value = Range("Q3:S3").Value
    Else: Range("Q3:S3").Clear
    End If
    
    If Range("G4010") <> "" Then
        Range("G4010:L4509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R4C17<>0,MAX(R[3]C:R[10002]C)=R4C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R4C17<>0,MAX(RC[1]:RC[500])=R4C17),RC[-6],"""")"
        Range("Q4").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("R4").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("S4").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("Q4:S4").Value = Range("Q4:S4").Value
    Else: Range("Q4:S4").Clear
    End If
    
    If Range("G4510") <> "" Then
        Range("G4510:L5009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R5C17<>0,MAX(R[3]C:R[10002]C)=R5C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R5C17<>0,MAX(RC[1]:RC[500])=R5C17),RC[-6],"""")"
        Range("Q5").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("R5").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("S5").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
        ActiveSheet.Calculate
        Range("Q5:S5").Value = Range("Q5:S5").Value
    Else: Range("Q5:S5").Clear
    End If
    
    Range("L8,L9,U1:SZ10009").Clear
    Range("G10:T10009").Clear
    
    Range("T1:T5").FormulaR1C1 = "=IF(MAX(R1C14:R5C14,R1C17:R5C17)=RC[-6],RC[-5],IF(MAX(R1C14:R5C14,R1C17:R5C17)=RC[-3],RC[-2],""""))"
    Range("U1:U5").FormulaR1C1 = "=IF(RC[-1]=RC[-6],RC[-5],IF(RC[-1]=RC[-4],RC[-2],""""))"
    
    Range("H1").FormulaR1C1 = "=MAX(RC[12]:R[4]C[12])"
    ActiveSheet.Calculate
    Range("H1").Value = Range("H1").Value
    Range("H3").FormulaR1C1 = "=MAX(R[-2]C[13]:R[2]C[13])"
    ActiveSheet.Calculate
    Range("H3").Value = Range("H3").Value
    
    Range("H2:L2").Value = Range("A1:E1").Value
    
    Range("N1:U5").Clear
    
    Range("G7:J7").FormulaR1C1 = "=MAX(R[3]C:R[10002]C)"
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R1C8,RC[-5],"""")"
    Range("H10:J10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-5],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:J10").AutoFill Destination:=.Range("G10:J" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("I1:L1").Value = Range("G7:J7").Value
    
    Range("G10:G10009").FormulaR1C1 = "=IF(RC[-6]=R3C8,RC[-5],"""")"
    ActiveSheet.Calculate
    Range("I3:L3").Value = Range("G7:J7").Value
    
    Range("F8,M8,G7:J10009").Clear
    
    Range("M2").FormulaR1C1 = _
        "=IF(AND(R[-1]C[-5]<>0,R[1]C[-5]<>0),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    Range("M2").Value = Range("M2").Value
    
 End If

Application.Run "F.xlsm!AORc"

End Sub

Sub AORc()
'
' 10/20/13 needed for JP 2013 REVISED 2/1/15 (lingering data, amended matrix)
' 5/15/18 Revised Matrix""; 5/16/2018 Revised Matrix
'
Application.ScreenUpdating = False
    Range("A5").Value = 0.041666667
    'Save prior TP
    Range("A7:E7").Value = Range("H2:L2").Value
    Range("G7").FormulaR1C1 = "=MIN(R[3]C:R[10012]C)"
    Range("H7:L7").FormulaR1C1 = "=MAX(R[3]C:R[10012]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C3,"""",IF(RC1<R2C1-R5C1,6371*ACOS(SIN(RC[-5])*SIN(R2C2)+COS(RC[-5])*COS(R2C2)*COS(R2C3-RC[-4])),""""))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R[-3]C[-1],RC[-7],"""")"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R7C7,RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
  If Range("G7") = 0 Or Range("H7") = Range("H1") Then
      Range("H2:L2").Value = Range("A7:E7").Value
      Range("A5:E7,G7:L10009").Clear
      
  ElseIf Range("G7") <> 0 Then
    Range("G2:L2").Value = Range("G7:L7").Value

    'Fini
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R1C3,"""",IF(AND(RC[-6]>R2C8,RC[-6]<R2C1),6371*ACOS(SIN(RC[-5])*SIN(R1C2)+COS(RC[-5])*COS(R1C2)*COS(R1C3-RC[-4])),""""))"
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G7:L7").Value = Range("G7:L7").Value
    Range("G10:H10019").Clear
    Range("A4").Value = 0.003472222
      
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C10,"""",IF(AND(RC[-6]>=R7C8-R4C1,RC[-6]<=R7C8+R4C1),6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4])),""""))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:H10").AutoFill Destination:=.Range("G10:H" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("H10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Range("H10:L509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("G10:G509").Copy
    Range("N6").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("G10:L10009").Clear

'Starts
    Range("L6").FormulaR1C1 = "=MAX(RC[2]:RC[501])"
    Range("M6").FormulaR1C1 = "=MIN(RC[1]:RC[500])"
    Range("L6:M6").Value = Range("L6:M6").Value
    
    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R2C10,"""",IF(AND(RC[-6]<R2C8,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4]))>R6C13,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4]))<=R6C12+1),RC[-6],""""))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("I10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("J10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R2C9)+COS(RC[-10])*COS(R2C9)*COS(R2C10-RC[-9])),"""")"
    
     Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
'Revert to Aorb if no Start found
If Range("G10") = "" Then
    Range("H2:L2").Value = Range("A7:E7").Value
    Range("A7:E7,G2,G5:M10009").Clear
    Columns("N:SS").Clear
    
ElseIf Range("G10") <> "" Then
'Matrix Amended 2/1/15 to add R1C<R2C8)
    'Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9,R1C<R2C8),"""",IF(OR(6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,AND(R6C>RC12,R6C<SQRT(RC12^2+0.25)),RC12>R6C),"""",IF(RC10-R4C<=R9C4,RC12,"""")))"
    ''Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",R3C=RC9,R1C<R2C8),"""",IF(OR(6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,AND(R6C>RC12,R6C<SQRT(RC12^2+0.25)),RC12>R6C,R6C[1]<R6C),"""",IF(RC10-R4C<=R9C4,RC12,"""")))"
    ''Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",R3C=RC9,R1C<R2C8),"""",IF(OR(6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,AND(R6C>RC12,R6C<SQRT(RC12^2+0.25)),RC12>R6C,AND(R6C[-1]<R6C,R6C[1]<R6C)),"""",IF(RC10-R4C<=R9C4,RC12,"""")))"
    Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",R3C=RC9,R1C<R2C8),"""",IF(OR(6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,AND(R6C>RC12,R6C<SQRT(RC12^2+0.25)),RC12>R6C,R6C[1]<R6C),"""",IF(RC10-R4C<=R9C4,RC12,"""")))"
    'Copy Ref G
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("I5").FormulaR1C1 = "=MAX(R[5]C[5]:R[10014]C[504])"
    Range("H5").FormulaR1C1 = "=2*RC[1]"
    Range("H5:I5").Value = Range("H5:I5").Value
    
  'Revert to Aorb if no Finish or shorter distance found
  If Range("H5") = 0 Or Range("H5") <= Range("M2") Then
    Range("H2:L2").Value = Range("A7:E7").Value
    Range("G2,G5:M10019").Clear
    Columns("N:SS").Clear
  
  ElseIf Range("H5") > Range("M2") Then
  
    Range("N10:SS3000").Value = Range("N10:SS3000").Value
    
    Range("N8:SS8").FormulaR1C1 = _
        "=IF(R[-7]C="""","""",IF(MAX(R[2]C:R[2992]C)=R5C9,R1C,""""))"
    Range("N8:SS8").Value = Range("N8:SS8").Value
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C9,RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M3009").Value = Range("M10:M3009").Value
    
    Range("H1").FormulaR1C1 = "=MAX(R[9]C[5]:R[2999]C[5])"
    Range("H3").FormulaR1C1 = "=MIN(R[5]C[6]:R[5]C[505])"
    Range("H1:H3").Value = Range("H1:H3").Value
    Range("N10:SS10009").Clear
                
    Range("N9:SS9").FormulaR1C1 = "=IF(R1C="""","""",IF(R[-1]C=R3C8,R2C,""""))"
    Range("N10:SS10").FormulaR1C1 = "=IF(R9C<>"""",R3C,"""")"
    Range("N11:SS11").FormulaR1C1 = "=IF(R10C<>"""",R4C,"""")"
    Range("N12:SS12").FormulaR1C1 = "=IF(R11C<>"""",R5C,"""")"
    
    Range("I3").FormulaR1C1 = "=MAX(R[6]C[5]:R[6]C[504])"
    Range("J3").FormulaR1C1 = "=MAX(R[7]C[4]:R[7]C[503])"
    Range("K3").FormulaR1C1 = "=MAX(R[8]C[3]:R[8]C[502])"
    Range("L3").FormulaR1C1 = "=MAX(R[9]C[2]:R[9]C[501])"
    Range("I3:L3").Value = Range("I3:L3").Value
    
    Range("N9:SS12").Clear
    
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:Q3009").Value = Range("N10:Q3009").Value
    
    Range("I1:L1").FormulaR1C1 = "=MAX(R[9]C[5]:R[2999]C[5])"
    Range("I1:L1").Value = Range("I1:L1").Value
    
    Range("A4:E7,G2,G5:M3000,N1:SS3000").Clear
    
    Range("M2").FormulaR1C1 = _
        "=IF(OR(SUM(R1C8:R1C12)=0,SUM(R2C8:R2C12)=0),0,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])))"
    Range("M2").Value = Range("M2").Value
    End If
  End If
End If

Application.Run "F.xlsm!NewOR2"

End Sub

Sub NewOR2()
'
' OR2redux Macro
' JLR 4/5/2018 For speed?
' JLR 5/15/18 Revised Matrix""; 5/16/2018 Revised Matrix
'
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]<>"""",RC[-12]>R2C1),6371*ACOS(SIN(RC[-11])*SIN(R2C2)+COS(RC[-11])*COS(R2C2)*COS(R2C3-RC[-10])),"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[1]<>"""",1,"""")"
    Range("L8").FormulaR1C1 = "=SUM(R[2]C:R[10001]C)"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("L10:M10").AutoFill Destination:=.Range("L10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("M8").FormulaR1C1 = "=(2*(MAX(R[1]C:R[10000]C)))"
    Range("M7").FormulaR1C1 = "=IF(R[1]C[-1]>1000,LARGE(R[3]C:R[10002]C,1000),IF(AND(R[1]C[-1]<1000,R[1]C[-1]>500),LARGE(R[3]C:R[10002]C,500),1))"

    If Range("M8") > Range("M2") Then
    
    Range("N10").FormulaR1C1 = "=IF(AND(RC[-1]<>"""",RC[-1]>=R7C13,RC[-13]<>""""),RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A, Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:S10").AutoFill Destination:=.Range("N10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:S10009").Value = Range("M10:S10009").Value
    Range("N10:S10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("M7:M8").Value = Range("M7:M8").Value
    Range("L10:M10009").Clear
    Range("S7").FormulaR1C1 = "=Median(R[3]C:R[1002]C)"
    Range("S8").FormulaR1C1 = "=MIN(R[2]C:R[10001]C)"
    Range("S9").FormulaR1C1 = "=MAX(R[1]C:R[10000]C)"
    ActiveSheet.Calculate
    
    Range("F10:F10009").FormulaR1C1 = "=IF(AND(RC[-5]<>"""",RC[-5]<R2C1),6371*ACOS(SIN(RC[-4])*SIN(R2C2)+COS(RC[-4])*COS(R2C2)*COS(RC[-3]-R2C3)),"""")"
    ActiveSheet.Calculate
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]<R2C1,RC[-1]>=R8C19,RC[-1]<=R9C19),RC[-6],"""")"
    Range("H10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("F10:F10009").Clear
    
    Range("G10:L509").Copy
    Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    'MATRIX
    'Range("U10:SZ10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    ''Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,R[1]C19<RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    ''' Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,AND(R[-1]C19<RC19,R[1]C19<RC19),6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,2*R6C,2*R6C-((R4C-RC17-R9C4)*0.1))))"
    ''Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,AND(R[-1]C19<RC19,R[1]C19<RC19),6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,R6C+RC19,(R6C+RC19)-((R4C-RC17-R9C4)*0.1))))"
    Range("U10:SZ10").FormulaR1C1 = "=IF(OR(R1C="""",RC16=R3C),"""",IF(OR(R6C>RC19,R[1]C19<RC19,6371*ACOS(SIN(RC15)*SIN(R2C)+COS(RC15)*COS(R2C)*COS(R3C-RC16))>0.5),"""",IF(R4C-RC17<=R9C4,R6C+RC19,(R6C+RC19)-((R4C-RC17-R9C4)*0.1))))"
     'Copy Ref N
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "N").End(xlUp).Row
.Range("U10:SZ10").AutoFill Destination:=.Range("U10:SZ" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("N1:N5,Q1:Q5").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
    Range("O1:O5,R1:R5").FormulaR1C1 = "=MAX(R7C21:R7C520)"
    Range("P1:P5,S1:S5").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
    
    Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(R[3]C:R[10002]C)=R1C14),R[-6]C,"""")"
    Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(RC[1]:RC[500])=R1C14),RC[-6],"""")"
    ActiveSheet.Calculate
    Range("N1:P1").Value = Range("N1:P1").Value
    
    Range("N1:N5,Q1:Q5").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
    Range("O1:O5,R1:R5").FormulaR1C1 = "=MAX(R7C21:R7C520)"
    Range("P1:P5,S1:S5").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
    
    Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(R[3]C:R[10002]C)=R1C14),R[-6]C,"""")"
    Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(RC[1]:RC[500])=R1C14),RC[-6],"""")"
    ActiveSheet.Calculate
    Range("N1:P1").Value = Range("N1:P1").Value
    
    If Range("G510") <> "" Then
        Range("G510:L1009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(R[3]C:R[10002]C)=R2C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(RC[1]:RC[500])=R2C14),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("N2:P2").Value = Range("N2:P2").Value
    Else: Range("N2:P2").Clear
    End If
    
    If Range("G1010") <> "" Then
        Range("G1010:L1509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(R[3]C:R[10002]C)=R3C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(RC[1]:RC[500])=R3C14),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("N3:P3").Value = Range("N3:P3").Value
    Else: Range("N3:P3").Clear
    End If
    
    If Range("G1510") <> "" Then
        Range("G1510:L2009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(R[3]C:R[10002]C)=R4C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(RC[1]:RC[500])=R4C14),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("N4:P4").Value = Range("N4:P4").Value
    Else: Range("N4:P4").Clear
    End If
    
    If Range("G2010") <> "" Then
        Range("G2010:L2509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(R[3]C:R[10002]C)=R5C14),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(RC[1]:RC[500])=R5C14),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("N5:P5").Value = Range("N5:P5").Value
    Else: Range("N5:P5").Clear
    End If
    
    If Range("G2510") <> "" Then
        Range("G2510:L3009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C17<>0,MAX(R[3]C:R[10002]C)=R1C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C17<>0,MAX(RC[1]:RC[500])=R1C17),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("Q1:S1").Value = Range("Q1:S1").Value
    Else: Range("Q1:S1").Clear
    End If
    
    If Range("G3010") <> "" Then
        Range("G3010:L3509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R2C17<>0,MAX(R[3]C:R[10002]C)=R2C17),R[-6]C,"""")"
        Range("T10:T0009").FormulaR1C1 = "=IF(AND(R2C17<>0,MAX(RC[1]:RC[500])=R2C17),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("Q2:S2").Value = Range("Q2:S2").Value
    Else: Range("Q2:S2").Clear
    End If
    
    If Range("G3510") <> "" Then
        Range("G3510:L4009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R3C17<>0,MAX(R[3]C:R[10002]C)=R3C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R3C17<>0,MAX(RC[1]:RC[500])=R3C17),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("Q3:S3").Value = Range("Q3:S3").Value
    Else: Range("Q3:S3").Clear
    End If
    
    If Range("G4010") <> "" Then
        Range("G4010:L4509").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R4C17<>0,MAX(R[3]C:R[10002]C)=R4C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R4C17<>0,MAX(RC[1]:RC[500])=R4C17),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("Q4:S4").Value = Range("Q4:S4").Value
    Else: Range("Q4:S4").Clear
    End If
    
    If Range("G4510") <> "" Then
        Range("G4510:L5009").Copy
        Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R5C17<>0,MAX(R[3]C:R[10002]C)=R5C17),R[-6]C,"""")"
        Range("T10:T10009").FormulaR1C1 = "=IF(AND(R5C17<>0,MAX(RC[1]:RC[500])=R5C17),RC[-6],"""")"
        ActiveSheet.Calculate
        Range("Q5:S5").Value = Range("Q5:S5").Value
    Else: Range("Q5:S5").Clear
    End If
        
    'Ck thru 7509 Starts(!)
    Range("T6").FormulaR1C1 = "=SUM(R1C[-6]:R5C[-1])"
    ActiveSheet.Calculate
    Range("T6").Value = Range("T6").Value
    
    If Range("T6") = 0 Then
        Range("N1:N5,Q1:Q5").FormulaR1C1 = "=MAX(R10C21:R10009C520)"
        Range("O1:O5,R1:R5").FormulaR1C1 = "=MAX(R7C21:R7C520)"
        Range("P1:P5,S1:S5").FormulaR1C1 = "=MIN(R10C20:R10009C20)"
    
        If Range("G5010") <> "" Then
            Range("G5010:L5509").Copy
            Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
            Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(R[3]C:R[10002]C)=R1C14),R[-6]C,"""")"
            Range("T10:T10009").FormulaR1C1 = "=IF(AND(R1C14<>0,MAX(RC[1]:RC[500])=R1C14),RC[-6],"""")"
            ActiveSheet.Calculate
            Range("N1:P1").Value = Range("N1:P1").Value
        Else: Range("N1:P1").Clear
        End If
        
        If Range("G5510") <> "" Then
            Range("G5510:L6009").Copy
            Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
            Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(R[3]C:R[10002]C)=R2C14),R[-6]C,"""")"
            Range("T10:T10009").FormulaR1C1 = "=IF(AND(R2C14<>0,MAX(RC[1]:RC[500])=R2C14),RC[-6],"""")"
            ActiveSheet.Calculate
            Range("N2:P2").Value = Range("N2:P2").Value
        Else: Range("N2:P2").Clear
        End If
        
        If Range("G6010") <> "" Then
            Range("G6010:L6509").Copy
            Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
            Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(R[3]C:R[10002]C)=R3C14),R[-6]C,"""")"
            Range("T10:T10009").FormulaR1C1 = "=IF(AND(R3C14<>0,MAX(RC[1]:RC[500])=R3C14),RC[-6],"""")"
            ActiveSheet.Calculate
            Range("N3:P3").Value = Range("N3:P3").Value
        Else: Range("N3:P3").Clear
        End If
        
        If Range("G6510") <> "" Then
            Range("G6510:L7009").Copy
            Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
            Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(R[3]C:R[10002]C)=R4C14),R[-6]C,"""")"
            Range("T10:T10009").FormulaR1C1 = "=IF(AND(R4C14<>0,MAX(RC[1]:RC[500])=R4C14),RC[-6],"""")"
            ActiveSheet.Calculate
            Range("N4:P4").Value = Range("N4:P4").Value
        Else: Range("N4:P4").Clear
        End If
        
        If Range("G7010") <> "" Then
            Range("G7010:L7509").Copy
            Range("U1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
            Range("U7:SZ7").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(R[3]C:R[10002]C)=R5C14),R[-6]C,"""")"
            Range("T10:T10009").FormulaR1C1 = "=IF(AND(R5C14<>0,MAX(RC[1]:RC[500])=R5C14),RC[-6],"""")"
            ActiveSheet.Calculate
            Range("N5:P5").Value = Range("N5:P5").Value
        Else: Range("N5:P5").Clear
        End If
    End If
    
    Range("U1:SZ5009").Clear
    Range("G10:T5009").Clear
    
    Range("T1:T5").FormulaR1C1 = "=IF(MAX(R1C14:R5C14,R1C17:R5C17)=RC[-6],RC[-5],IF(MAX(R1C14:R5C14,R1C17:R5C17)=RC[-3],RC[-2],""""))"
    Range("U1:U5").FormulaR1C1 = "=IF(RC[-1]=RC[-6],RC[-5],IF(RC[-1]=RC[-4],RC[-2],""""))"
    
    Range("H5").FormulaR1C1 = "=MAX(R[-4]C[12]:RC[12])"
    Range("H5").Value = Range("H5").Value
    Range("H7").FormulaR1C1 = "=MAX(R[-6]C[13]:R[-2]C[13])"
    Range("H7").Value = Range("H7").Value
    
    Range("H6:L6").Value = Range("A2:E2").Value
    
    Range("N1:U5").Clear
    
    Range("G8:J8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R5C8,RC[-5],"""")"
    Range("H10:J10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-5],"""")"
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:J10").AutoFill Destination:=.Range("G10:J" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("I5:L5").Value = Range("G8:J8").Value
    
    Range("G10:G10009").FormulaR1C1 = "=IF(RC[-6]=R7C8,RC[-5],"""")"
    ActiveSheet.Calculate
    Range("I7:L7").Value = Range("G8:J8").Value
    
    Range("G8:J10009").Clear
    
    Range("M6").FormulaR1C1 = _
        "=IF(AND(R[-1]C[-5]<>0,R[1]C[-5]<>0),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),0)"
    ActiveSheet.Calculate
    Range("M6").Value = Range("M6").Value
    
    If Range("M6") > Range("M2") Then
        Range("H1:M3").Value = Range("H5:M7").Value
    End If
    
    Range("T6,H5:M8,S7:S9").Clear
    'Application.Run "F.xlsm!AORc"
    
  End If
    Application.Run "F.xlsm!ORredeemer"

End Sub
Sub ORredeemer()
'
' Android - OR TP NOT at St Start, Fini or via AORc
' JLR 5/15/18 Revised Matrix""; 5/16/2018 Revised Matrix; 8/6/2018 Returned Matrix formula to prior
'
Application.ScreenUpdating = False
    'Ck TP
    Range("A7").Value = Range("H2").Value
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(OR(RC[-6]<=R1C8,RC[-6]>=R3C8),"""",IF(R1C11-R3C11<=R9C4,2*6371*ACOS(SIN(RC[-5])*SIN(R1C9)+COS(RC[-5])*COS(R1C9)*COS(R1C10-RC[-4])),2*6371*ACOS(SIN(RC[-5])*SIN(R1C9)+COS(RC[-5])*COS(R1C9)*COS(R1C10-RC[-4]))-((R1C11-R3C11-R9C4)*.1)))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"

    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G8:L8").Value = Range("G8:L8").Value
    Range("G10:L10009").Clear
    
  If Range("G8") > Range("M2") Then
    Range("H2:L2").Value = Range("H8:L8").Value
    Range("M2").FormulaR1C1 = _
        "=IF(OR(SUM(R1C8:R1C12)=0,SUM(R2C8:R2C12)=0),0,IF(R[-1]C[-2]-R[1]C[-2]<=R9C4,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))-((R[-1]C[-2]-R[1]C[-2]-R9C4)*0.1)))"
    Range("M2").Value = Range("M2").Value
  End If
    Range("G8:L8").Clear

    Range("A6").Value = 3.47222222222222E-03
    'Starts
    Range("G10").FormulaR1C1 = "=IF(RC[-4]=R2C10,"""",IF(AND(RC[-6]>=R1C8-R6C1,RC[-6]<=R1C8+R6C1),RC[-6],""""))"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R2C9)+COS(RC[-10])*COS(R2C9)*COS(R2C10-RC[-9])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
   
    Range("L6").FormulaR1C1 = "=MIN(R[4]C:R[10003]C)"
    Range("L6").Value = Range("L6").Value
    
    'FINIS TO TOP
    Range("N10").FormulaR1C1 = _
        "=IF(RC[-11]=R2C10,"""",IF(AND(RC[-13]>=R3C8-R6C1,RC[-13]<=R3C8+R6C1,6371*ACOS(SIN(RC[-12])*SIN(R2C9)+COS(RC[-12])*COS(R2C9)*COS(R2C10-RC[-11]))>R6C12),RC[-13],""""))"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("S10").FormulaR1C1 = _
        "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-17])*SIN(R2C9)+COS(RC[-17])*COS(R2C9)*COS(R2C10-RC[-16])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:S10").AutoFill Destination:=.Range("N10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:S10009").Value = Range("N10:S10009").Value
    Range("N10:S10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("N10:S509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N10:S10009").Clear
    
    'MATRIX Amended 7/29/17 to restore .5km radius OZSector/Line length
    'Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,2*RC12,"""")))"
    ''Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,R6C[1]<R6C,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,2*RC12,"""")))"
    'Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,AND(R6C[1]<R6C,R6C[-1]<R6C),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,2*RC12,"""")))"
    ''Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,AND(R6C[1]<R6C,R6C[-1]<R6C),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,RC12+R6C,"""")))"
    '''Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,R6C[1]<R6C,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,RC12+R6C,"""")))"
    Range("N10:SS10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,AND(R6C[1]<R6C,R6C[-1]<R6C),6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C<SQRT(RC12^2+0.25)),"""",IF(RC10-R4C<=R9C4,2*RC12,"""")))"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("I5").FormulaR1C1 = "=MAX(R[5]C[5]:R[3004]C[504])"
    Range("I5").Value = Range("I5").Value
    
    Range("N10:SS3009").Value = Range("N10:SS3009").Value
    Range("N7:SS7").FormulaR1C1 = "=IF(AND(R[-6]C<>"""",MAX(R[3]C:R[3002]C)=R5C9,RC[-1]=""""),R[-6]C,"""")"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("M10:M3009").FormulaR1C1 = "=IF(MAX(RC[1]:RC[500])=R5C9,RC[-6],"""")"
    ActiveSheet.Calculate
    Range("M10:M3009").Value = Range("M10:M3009").Value
    
    Range("H7").FormulaR1C1 = "=MIN(RC[6]:RC[505])"
    Range("N8:SS11").FormulaR1C1 = "=IF(R7C=R7C8,R[-6]C,"""")"
    Range("I7").FormulaR1C1 = "=MAX(R[1]C[5]:R[1]C[504])"
    Range("J7").FormulaR1C1 = "=MAX(R[2]C[4]:R[2]C[503])"
    Range("K7").FormulaR1C1 = "=MAX(R[3]C[3]:R[3]C[502])"
    Range("L7").FormulaR1C1 = "=MAX(R[4]C[2]:R[4]C[501])"
    Range("H7:L7").Value = Range("H7:L7").Value
    Range("H6:L6").Value = Range("H2:L2").Value
   
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:Q10").AutoFill Destination:=.Range("N10:Q" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("H5:L5").FormulaR1C1 = "=MAX(R[5]C[5]:R[3004]C[5])"
    Range("H5:L5").Value = Range("H5:L5").Value
    Range("M6").FormulaR1C1 = "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("M6").Value = Range("M6").Value
    
    If Range("M6") > Range("M2") Then
        Range("H1:M3").Value = Range("H5:M7").Value
    End If
    
    Range("A6,A7,H5:M8,G10:M10009").Clear
    Columns("N:SS").Clear
    Application.Run "F.xlsm!FLine1"
End Sub

Sub Fline1()
'
'Setup to ck FINISH LINE @ AORb Start
'
Application.ScreenUpdating = False
    
'Ck TP
    Range("G8:L8").FormulaR1C1 = "=MAX(R[2]C:R[10001]C)"
    Range("G10").FormulaR1C1 = _
        "=IF(OR(RC[-6]<=R1C8,RC[-6]>=R3C8),"""",IF(R1C11-R3C11<=R9C4,2*6371*ACOS(SIN(RC[-5])*SIN(R1C9)+COS(RC[-5])*COS(R1C9)*COS(R1C10-RC[-4])),2*6371*ACOS(SIN(RC[-5])*SIN(R1C9)+COS(RC[-5])*COS(R1C9)*COS(R1C10-RC[-4]))-((R1C11-R3C11-R9C4)*.1)))"
    Range("H10").FormulaR1C1 = "=IF(RC[-1]=R8C[-1],RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"

    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G8:L8").Value = Range("G8:L8").Value
    Range("G10:L10009").Clear
    
  If Range("G8") > Range("M2") Then
    Range("H2:L2").Value = Range("H8:L8").Value
    Range("M2").FormulaR1C1 = _
        "=IF(OR(SUM(R1C8:R1C12)=0,SUM(R2C8:R2C12)=0),0,IF(R[-1]C[-2]-R[1]C[-2]<=R9C4,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))-((R[-1]C[-2]-R[1]C[-2]-R9C4)*0.1)))"
    Range("M2").Value = Range("M2").Value
  End If
    Range("G8:L8").Clear
 'Resume as before
    Range("A1:F2").Clear
    Range("A1:F3").Value = Range("H1:M3").Value
    
'Select AORb FINI + 2 fixes before, 2 fixes after
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R3C1,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    'Copy Ref A
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("H2:L2").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H1:L1").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

    Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("A4").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("B4").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("B4").Value = Range("B4").Value
    Sheets("Sheet2").Range("D4:E4").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear

Application.Run "F.xlsm!YDWK3clear"

If Range("B4") = "        FINISH LINE" Then
    Application.Run ("F.xlsm!OZSectorB")
ElseIf Range("B4") <> "        FINISH LINE" Then
    Application.Run "F.xlsm!OZSector"
End If

End Sub
Sub FINlines()
'
Application.ScreenUpdating = False
' DGfinfix1to2
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N25:O25").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("M35").Value = Range("F37").Value

    Range("N26:O26").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("N35").Value = Range("F37").Value
    
    Range("N25:O25").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("O35").Value = Range("F37").Value
    
    Range("N22:O22").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N23:O23").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("Q35").Value = Range("C36").Value
    
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
   
    Range("N25:O25").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P44").Value = Range("C36").Value
    
    Range("N26:O26").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P46").Value = Range("C36").Value

' DGfinfix2to3
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N26:O26").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("M50").Value = Range("F37").Value

    Range("N27:O27").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("N50").Value = Range("F37").Value
    
    Range("N26:O26").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("O50").Value = Range("F37").Value
    
    Range("N22:O22").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N23:O23").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("Q50").Value = Range("C36").Value
    
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
   
    Range("N26:O26").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P59").Value = Range("C36").Value
    
    Range("N27:O27").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P61").Value = Range("C36").Value
    
' DGfinfix3to4
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N27:O27").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("M65").Value = Range("F37").Value

    Range("N28:O28").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("N65").Value = Range("F37").Value
    
    Range("N27:O27").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("O65").Value = Range("F37").Value
    
    Range("N22:O22").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N23:O23").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("Q65").Value = Range("C36").Value
    
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
   
    Range("N27:O27").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P74").Value = Range("C36").Value
    
    Range("N28:O28").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P76").Value = Range("C36").Value
    
' DGfinfix4to5
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N28:O28").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("M80").Value = Range("F37").Value

    Range("N29:O29").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("N80").Value = Range("F37").Value
    
    Range("N28:O28").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("O80").Value = Range("F37").Value
    
    Range("N22:O22").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N23:O23").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("Q80").Value = Range("C36").Value
    
    Range("N23:O23").Copy
    Range("E39").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
   
    Range("N28:O28").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P89").Value = Range("C36").Value
    
    Range("N29:O29").Copy
    Range("E41").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("E81").FormulaR1C1 = "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("P91").Value = Range("C36").Value
    
    Range("M17").FormulaR1C1 = _
        "=IF(AND(R[20]C[3]=""GOOD FINISH"",R[21]C[3]=""GOOD FINISH""),R[28]C[1],IF(AND(R[35]C[3]=""GOOD FINISH"",R[36]C[3]=""GOOD FINISH""),R[43]C[1],IF(AND(R[50]C[3]=""GOOD FINISH"",R[51]C[3]=""GOOD FINISH""),R[58]C[1],IF(AND(R[65]C[3]=""GOOD FINISH"",R[66]C[3]=""GOOD FINISH""),R[73]C[1],""NO FIN LINE""))))"
    Range("N17").FormulaR1C1 = _
        "=IF(AND(R[20]C[2]=""GOOD FINISH"",R[21]C[2]=""GOOD FINISH""),R[28]C[1],IF(AND(R[35]C[2]=""GOOD FINISH"",R[36]C[2]=""GOOD FINISH""),R[43]C[1],IF(AND(R[50]C[2]=""GOOD FINISH"",R[51]C[2]=""GOOD FINISH""),R[58]C[1],IF(AND(R[65]C[2]=""GOOD FINISH"",R[66]C[2]=""GOOD FINISH""),R[73]C[1],""""))))"
    Range("O17").FormulaR1C1 = _
        "=IF(RC[-1]="""","""",IF(AND(R[20]C[1]=""GOOD FINISH"",R[21]C[1]=""GOOD FINISH""),R[28]C[1],IF(AND(R[35]C[1]=""GOOD FINISH"",R[36]C[1]=""GOOD FINISH""),R[43]C[1],IF(AND(R[50]C[1]=""GOOD FINISH"",R[51]C[1]=""GOOD FINISH""),R[58]C[1],IF(AND(R[65]C[1]=""GOOD FINISH"",R[66]C[1]=""GOOD FINISH""),R[73]C[1])))))"
    ActiveSheet.Calculate
    Range("M17:O17").Value = Range("M17:O17").Value
    Range("A1").Activate
''Application.Calculation = xlCalculationManual
End Sub
Sub YDWK3clear()
'
' Clears YDWK3
'

Application.ScreenUpdating = False
    Sheets("YDWK3").Activate
    Range("C5:D6").Value = 0
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Range("M17:O17,M22:Q29").Clear
    Range("E39:E42").Value = 0
    Range("M35:O35,Q35").Clear
    Range("P44,P46").Clear
    Range("M50:O50,Q50").Clear
    Range("P59,P61").Clear
    Range("M65:O65,Q65").Clear
    Range("P74,P76").Clear
    Range("M80:O80,Q80").Clear
    Range("P89,P91").Clear
    Range("E81").FormulaR1C1 = _
        "=R47C[-2]+(1-R79C)*R46C[-2]*R67C*(ACOS(R62C)+R79C*SIN(ACOS(R62C))*(R69C+R79C*R62C*(-1+2*R69C*R69C)))"
    ActiveSheet.Calculate
    Range("A1").Activate
    Sheets("Sheet2").Activate
    Range("A1").Activate
Application.Calculation = xlCalculationManual
End Sub

Sub Fline2()
'
' Sets up to ck Fin Line after OZ Sector
'
Application.ScreenUpdating = False
    
If Range("M3") = "Sector" Then
 
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R3C8,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("G10:K10009").Clear
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("H2:L2").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H1:L1").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

    Application.Run "F.xlsm!FINLINES"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H4").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I4").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I4").Value = Range("I4").Value
    Sheets("Sheet2").Range("K4:L4").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear
    Range("M4").FormulaR1C1 = _
        "=IF(RC[-5]=""NO FIN LINE"","""",IF(R[-3]C[-2]-RC[-2]<=R9C4,2*6371*ACOS(SIN(R[-3]C[-4])*SIN(R[-2]C[-4])+COS(R[-3]C[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-R[-3]C[-3])),2*6371*ACOS(SIN(R[-3]C[-4])*SIN(R[-2]C[-4])+COS(R[-3]C[-4])*COS(R[-2]C[-4])*COS(R[-2]C[-3]-R[-3]C[-3]))-((R[-3]C[-2]-RC[-2]-R9C4)*0.1)))"
    Range("M4").Value = Range("M4").Value

    Application.Run "F.xlsm!YDWK3clear"

    If Range("H4") = "NO FIN LINE" Then
    
    Range("A6").Value = 4.16666666666667E-02
     Range("H1:L1").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N7").FormulaR1C1 = "=6371*ACOS(SIN(R[-5]C)*SIN(R2C9)+COS(R[-5]C)*COS(R2C9)*COS(R2C10-R[-4]C))"
    Range("N8").FormulaR1C1 = "=SQRT(R[-1]C^2+0.25)"
    ActiveSheet.Calculate
    Range("N7:N8").Value = Range("N7:N8").Value

    Range("G10").FormulaR1C1 = _
        "=IF(RC[-4]=R3C14,"""",IF(AND(RC[-6]>=R3C8-R6C1/2,RC[-6]<=R3C8+R6C1/2,6371*ACOS(SIN(RC[-5])*SIN(R2C14)+COS(RC[-5])*COS(R2C14)*COS(R3C14-RC[-4]))<=0.5),RC[-6],""""))"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
 If Range("G10") = "" Or Range("G11") = "" And Range("G12") = "" Then
    Range("N1:N8").Clear
 
 ElseIf Range("G10") <> "" Then
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R[-1]C[-4]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3]))>=R7C14,6371*ACOS(SIN(R[-1]C[-4])*SIN(R2C9)+COS(R[-1]C[-4])*COS(R2C9)*COS(R2C10-R[-1]C[-3]))<=R8C14),AND(R[1]C[-4]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3]))<=R8C14,6371*ACOS(SIN(R[1]C[-4])*SIN(R2C9)+COS(R[1]C[-4])*COS(R2C9)*COS(R2C10-RC[-3]))>=R7C14)),1,0)"
    Range("M10").FormulaR1C1 = "=IF(RC[-1]=1,RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:M10").AutoFill Destination:=.Range("L10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:M10009").Value = Range("L10:M10009").Value
    
    Range("F9").FormulaR1C1 = "=MIN(R[1]C13:R[1000]C13)"
    ActiveSheet.Calculate
    Range("F9").Value = Range("F9").Value
    Range("G10:M10009").Clear
    
  If Range("F9") > 0 Then
  
  'Select new FINI + 2 fixes before, 2 fixes after
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R9C6,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    'Sibylle fails with this IF
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:P10").AutoFill Destination:=.Range("G10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("F6:F9,G10:K10009,N1:N8").Clear
    
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal

    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("H2:L2").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H1:L1").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value

Application.Run "F.xlsm!FINlines"
    
    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H4").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I4").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I4").Value = Range("I4").Value
    Sheets("Sheet2").Range("K4:L4").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("L10:P14").Clear

    Application.Run "F.xlsm!YDWK3clear"
  
ElseIf Range("G10") = "" Or Range("F9") = 0 Then
    
    Range("N1:N8,F9:M10009").Clear
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>=R1C8-R6C1,RC[-6]<=R1C8+R6C1,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4]))<R2C13/2),6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4])),"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:G10").AutoFill Destination:=.Range("G10:G" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("F10:F10009").FormulaR1C1 = "=IF(RC[1]<>"""",1,"""")"
    ActiveSheet.Calculate
    Range("F8").FormulaR1C1 = "=SUM(R[2]C:R[10001]C)"
    Range("F8").Value = Range("F8").Value
    Range("F10:F10009").Clear
    
    Range("G8").FormulaR1C1 = "=IF(R8C[-1]>500,MEDIAN(R[2]C:R[10001]C),MIN(R[2]C:R[10001]C))"
    ActiveSheet.Calculate
    Range("G8").Value = Range("G8").Value
    Range("H10").FormulaR1C1 = _
        "=IF(AND(RC[-1]<>"""",RC[-1]>=R8C7,RC[-1]<=R2C13/2),RC[-7],"""")"
    Range("I10:L10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("H10:L10009").Sort Key1:=Range("H10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("H10:L509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("F8:L10009").Clear
    Range("N6:SS6").FormulaR1C1 = _
        "=IF(R[-5]C<>"""",6371*ACOS(SIN(R[-4]C)*SIN(R2C9)+COS(R[-4]C)*COS(R2C9)*COS(R2C10-R[-3]C)),"""")"
    ActiveSheet.Calculate
    Range("N6:SS6").Value = Range("N6:SS6").Value
    Range("M6").FormulaR1C1 = "=MIN(RC[1]:RC[500])"
    Range("M6").Value = Range("M6").Value
    
    'FINISHES within an hour of sector Fin, >= M6 AFTER H2
    Range("G10").FormulaR1C1 = _
        "=IF(AND(RC[-6]>R2C8,RC[-6]>=R3C8-R6C1,RC[-6]<=R3C8+R6C1,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4]))>R6C13,6371*ACOS(SIN(RC[-5])*SIN(R2C9)+COS(RC[-5])*COS(R2C9)*COS(R2C10-RC[-4]))<=R2C13/2),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"

    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K10009").Value = Range("G10:K10009").Value
    Range("G10:K10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'MATRIX
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R[1]C7="""",RC9=R3C,R[1]C9=R3C),"""",IF(OR(AND(6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))<=0.5,6371*ACOS(SIN(R[1]C8)*SIN(R2C)+COS(R[1]C8)*COS(R2C)*COS(R3C-R[1]C9))<=0.7),AND(6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))<=0.7,6371*ACOS(SIN(R[1]C8)*SIN(R2C)+COS(R[1]C8)*COS(R2C)*COS(R3C-R[1]C9))<=0.5)),1,""""))"
   
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:SS600").Value = Range("N10:SS600").Value
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-6]C,"""")"
    Range("N7:SS7").Copy
    Range("N1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-5]C,"""")"
    Range("N7:SS7").Copy
    Range("O1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-4]C,"""")"
    Range("N7:SS7").Copy
    Range("P1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-3]C,"""")"
    Range("N7:SS7").Copy
    Range("Q1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-2]C,"""")"
    Range("N7:SS7").Copy
    Range("R1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N7:SS7").FormulaR1C1 = "=IF(SUM(R[3]C:R[593]C)>=2,R[-1]C,"""")"
    Range("N7:SS7").Copy
    Range("S1000").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("N1000:S1599").Sort Key1:=Range("N1000"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N1:SS700").Clear
   
    Range("N1000:S1499").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("N1000:S1499").Clear
    
If Range("N1") <> "" Then
    
    Range("N7:SS7").FormulaR1C1 = "=IF(R1C="""","""",SQRT(R[-1]C^2+0.25))"
    Range("N7:SS7").Value = Range("N7:SS7").Value
    
    Range("L10").FormulaR1C1 = "=6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3]))"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:L10009").Value = Range("L10:L10009").Value
    Range("N10:SS10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC9=R3C),"""",IF(AND(RC12>R6C,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))<0.7,R[1]C12>RC12),1,""""))"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:SS10").AutoFill Destination:=.Range("N10:SS" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:SS600").Value = Range("N10:SS600").Value
    
    Range("N8:SS8").FormulaR1C1 = "=IF(R1C="""","""",IF(SUM(R[2]C:R[592]C)>1,R[-2]C,""""))"
    Range("M8").FormulaR1C1 = "=MAX(RC[1]:RC[500])"
    Range("M8:SS8").Value = Range("M8:SS8").Value
    
    Range("L10").FormulaR1C1 = "=IF(MAX(RC[2]:RC[501])=1,6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3])),0)"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:L10009").Value = Range("L10:L1009").Value
    Range("N10:SS600").Clear
    
    Range("N9:SS9").FormulaR1C1 = "=IF(R[-1]C=R8C13,R1C,"""")"
    Range("N10:SS10").FormulaR1C1 = "=IF(R[-1]C<>"""",R2C,"""")"
    Range("N11:SS11").FormulaR1C1 = "=IF(R[-1]C<>"""",R3C,"""")"
    Range("N12:SS12").FormulaR1C1 = "=IF(R[-1]C<>"""",R4C,"""")"
    Range("N13:SS13").FormulaR1C1 = "=IF(R[-1]C<>"""",R5C,"""")"
    
    Range("H6").FormulaR1C1 = "=MAX(R9C[6]:R9C[505])"
    Range("I6").FormulaR1C1 = "=MAX(R10C[5]:R10C[504])"
    Range("J6").FormulaR1C1 = "=MAX(R11C[4]:R11C[503])"
    Range("K6").FormulaR1C1 = "=MAX(R12C[3]:R12C[502])"
    Range("L6").FormulaR1C1 = "=MAX(R13C[2]:R13C[501])"
    Range("H6:L6").Value = Range("H6:L6").Value
    Columns("N:SS").Clear
    Range("M6").Clear
    
    Range("H7:L7").Value = Range("H2:L2").Value
    
    Range("M10").FormulaR1C1 = "=IF(RC[-1]>=R8C13,RC[-6],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G9").FormulaR1C1 = "=MIN(R[1]C[6]:R[1000]C[6])"
    ActiveSheet.Calculate
    Range("G9").Value = Range("G9").Value
    Range("G10:M10009").Clear
    Range("F10").FormulaR1C1 = "=IF(RC1=R9C7,1,"""")"
    Range("G10").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[-1]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[-2]C[-1]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[-1]C[-1]=1,1,"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("F10:J10").AutoFill Destination:=.Range("F10:J" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("F10:J10009").Value = Range("F10:J10009").Value
    
    Range("L10").FormulaR1C1 = "=IF(OR(RC[-6]=1,RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1),RC[-11],"""")"
    Range("M10:P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("L10:P10").AutoFill Destination:=.Range("L10:P" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("L10:P10009").Value = Range("L10:P10009").Value
    Range("L10:P10009").Sort Key1:=Range("L10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("F9:J10009").Clear
    
    Range("H8:L8").Value = Range("L12:P12").Value
    
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet2").Range("H7:L7").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet2").Range("H6:L6").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet2").Range("L10:P14").Value
    
    Application.Run "F.xlsm!FINlines"

    Sheets("Sheet2").Activate
    Sheets("Sheet2").Range("H9").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet2").Range("I9").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    Range("I9").Value = Range("I9").Value
    Sheets("Sheet2").Range("K9:L9").Value = Sheets("YDWK3").Range("N17:O17").Value

    Range("M7").FormulaR1C1 = _
        "=IF(R[2]C[-5]=""NO FIN LINE"","""",IF(R[-1]C[-2]-R[2]C[-2]<=R9C4,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))-((R[-1]C[-2]-R[2]C[-2]-R9C4)*0.1)))"
    Range("M7").Value = Range("M7").Value

    Range("M8,L10:P14").Clear

Application.Run "F.xlsm!YDWK3clear"
        End If
    End If
    
''''''Sib: N1 Nothing
ElseIf Range("N1") = "" Then
    Range("A5:E7,G6:M100009").Clear
            
    If Range("M3") <> "SECTOR" And ("H4") = "NO FIN LINE" Then
        Application.Run ("F.xlsm!NearestSF")
    
    ElseIf Range("A1") >= 42278 And Range("A4") = "NO FIN LINE" And Range("H4") = "NO FIN LINE" Then
        Application.Run ("F.xlsm!FLineLast")
    End If

    End If
  End If
End If

 Application.Run "F.xlsm!OZSectorB"
End Sub

Sub OZSector()
'
' Tests for OZ Sector On Sheet2 after AORb; Tests for/finds OZ Sector; revised 10/1/2015 for FlineLAST
'
Application.ScreenUpdating = False
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B2:C2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("C6:C7").Value = Sheets("YDWK3").Range("E2:E3").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Activate
    'CK OZ for AORb result
    Range("H1:L4").Value = Range("A1:E4").Value
   
   'Find 7 Fixes - 3 before & 3 after raw Fin
    Range("G10").FormulaR1C1 = "=IF(RC[-6]=R3C1,1,"""")"
    Range("H10").FormulaR1C1 = "=IF(R[3]C[-1]=1,1,"""")"
    Range("I10").FormulaR1C1 = "=IF(R[2]C[-2]=1,1,"""")"
    Range("J10").FormulaR1C1 = "=IF(R[1]C[-3]=1,1,"""")"
    Range("K10").FormulaR1C1 = "=IF(R[-1]C[-4]=1,1,"""")"
    Range("L10").FormulaR1C1 = "=IF(R[-2]C[-5]=1,1,"""")"
    Range("M10").FormulaR1C1 = "=IF(R[-3]C[-6]=1,1,"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:M10").AutoFill Destination:=.Range("G10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:M10009").Value = Range("G10:M10009").Value
    Range("N10").FormulaR1C1 = _
        "=IF(OR(RC[-7]=1,RC[-6]=1,RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-13],"""")"
    Range("O10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("P10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
      
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:R10009").Value = Range("N10:R10009").Value
    Range("G10:M10009").Clear
    Range("N10:R10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'Test 3 earlier, 3 later than A3
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O10:P10").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M10").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O11:P11").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M11").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O12:P12").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M12").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O13:P13").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M13").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O14:P14").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M14").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O15:P15").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M15").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("O16:P16").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet2").Range("B1:C1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet2").Range("M16").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Application.Run "F.xlsm!YDWK3clear"
    
    Range("G10:G16").FormulaR1C1 = _
        "=IF(OR(6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))>1,RC[6]=""""),"""",IF(OR(AND(R6C3>R7C3,RC[6]>=R7C3,RC[6]<=R6C3),AND(R6C3<R7C3,OR(RC[6]<=R6C3,RC[6]>=R7C3))),RC[7],""""))"
    Range("H10:K16").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[7],"""")"
    Range("G6").FormulaR1C1 = "=MAX(R[4]C[3]:R[10]C[3])"
    Range("G6").Value = Range("G6").Value
    Range("H7").FormulaR1C1 = _
        "=IF(R[3]C[2]=R6C7,R[3]C[-1],IF(R[4]C[2]=R6C7,R[4]C[-1],IF(R[5]C[2]=R6C7,R[5]C[-1],IF(R[6]C[2]=R6C7,R[6]C[-1],""""))))"
    Range("H8").FormulaR1C1 = _
        "=IF(R[6]C[2]=R6C7,R[6]C[-1],IF(R[7]C[2]=R6C7,R[7]C[-1],IF(R[8]C[2]=R6C7,R[8]C[-1],"""")))"
    Range("H7:H8").Value = Range("H7:H8").Value
    Range("G6").FormulaR1C1 = "=MAX(R[1]C[1],R[2]C[1])"
    Range("G6").Value = Range("G6").Value
    Range("H10:H16").FormulaR1C1 = "=IF(R6C7=0,"""",IF(RC[-1]=R6C7,RC[7],""""))"
    Range("H6:K6").FormulaR1C1 = "=MAX(R[4]C:R[10]C)"
    Range("G6:K6").Value = Range("G6:K6").Value
    
    If Range("G6") > 0 Then
        Range("D6").Value = "OK"
        Range("H3:L3").Value = Range("G6:K6").Value
        Range("M2").FormulaR1C1 = _
            "=IF(R[-1]C[-2]-R[1]C[-2]<=R9C4,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))-((R[-1]C[-2]-R[1]C[-2]-R9C4)*0.1))"
        Range("M2").Value = Range("M2").Value
        Range("M3").Value = "SECTOR"
        Range("G6:R16").Clear
           
    ElseIf Range("G6") = 0 Then
      Range("G6:K6,G10:K16").Clear
      Range("G10:K16").Value = Range("N10:R16").Value
    Range("M10:R16").Clear
    
    'Find Revised Start candidates
    Range("A5").Value = 0.00347222222222
    'find distance to TP @ each fix within 5 mins & 1.5km of Aorb Start
    Range("M10").FormulaR1C1 = _
        "=IF(RC[-10]=R1C3,"""",IF(AND(RC[-12]>=R1C1-R5C1,RC[-12]<=R1C1+R5C1,6371*ACOS(SIN(RC[-11])*SIN(R1C2)+COS(RC[-11])*COS(R1C2)*COS(R1C3-RC[-10]))<1.5),6371*ACOS(SIN(RC[-11])*SIN(R2C2)+COS(RC[-11])*COS(R2C2)*COS(R2C3-RC[-10])),""""))"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M10019").Value = Range("M10:M10019").Value
    
    Range("L10:L10019").FormulaR1C1 = "=IF(RC[1]<>"""",1,"""")"
    ActiveSheet.Calculate
    Range("L9").FormulaR1C1 = "=SUM(R[1]C:R[10010]C)"
    Range("L9").Value = Range("L9").Value
    Range("L10:L10019").Clear
    
    'find at most 50 longest first legs
    Range("L8").FormulaR1C1 = _
        "=IF(R[1]C<=50,MIN(R[2]C[1]:R[10011]C[1]),LARGE(R[2]C[1]:R[10011]C[1],50))"
    ActiveSheet.Calculate
    Range("N10").FormulaR1C1 = "=IF(AND(RC[-1]<>"""",RC[-1]>=R8C12),RC[-13],"""")"
    Range("O10:R10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("N10:R10").AutoFill Destination:=.Range("N10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:R10009").Value = Range("N10:R10009").Value
    Range("N10:R10009").Sort Key1:=Range("N10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("N10:R59").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False
    
    Range("F9,L8:R10019").Clear

    Range("N8:BK8").FormulaR1C1 = "=IF(R1C<>"""",0.0033528107,"""")"
    Range("N9:BK9").FormulaR1C1 = "=IF(R1C<>"""",R2C3-R[-6]C,"""")"
    Range("N10:BK10").FormulaR1C1 = "=IF(R1C<>"""",(1-R[-2]C)*TAN(R2C),"""")"
    Range("N11:BK11").FormulaR1C1 = "=IF(R1C<>"""",ATAN(R[-1]C),"""")"
    Range("N12:BK12").FormulaR1C1 = "=IF(R1C<>"""",SIN(R[-1]C),"""")"
    Range("N13:BK13").FormulaR1C1 = "=IF(R1C<>"""",COS(R[-2]C),"""")"
    Range("N14:BK14").FormulaR1C1 = "=IF(R1C<>"""",(1-R[-6]C)*TAN(R2C2),"""")"
    Range("N15:BK15").FormulaR1C1 = "=IF(R1C<>"""",ATAN(R[-1]C),"""")"
    Range("N16:BK16").FormulaR1C1 = "=IF(R1C<>"""",SIN(R[-1]C),"""")"
    Range("N17:BK17").FormulaR1C1 = "=IF(R1C<>"""",COS(R[-2]C),"""")"
    Range("N18:BK18").FormulaR1C1 = "=R[6]C"
    Range("N19:BK19").FormulaR1C1 = _
        "=IF(R1C<>"""",(R[-2]C*SIN(R[-1]C)*R[-2]C*SIN(R[-1]C))+(R[-6]C*R[-3]C-R[-7]C*R[-2]C*COS(R[-1]C))*(R[-6]C*R[-3]C-R[-7]C*R[-2]C*COS(R[-1]C)),"""")"
    Range("N20:BK20").FormulaR1C1 = "=IF(R1C<>"""",(R[-8]C*R[-4]C)+(R[-7]C*R[-3]C*COS(R[-2]C)),"""")"
    Range("N21:BK21").FormulaR1C1 = _
        "=IF(R1C="""","""",IF(R[-2]C=0,0,R[-8]C*R[-4]C*SIN(R[-3]C)/SQRT(R[-2]C)))"
    Range("N22:BK22").FormulaR1C1 = _
        "=IF(R1C<>"""",R[-2]C-2*R[-10]C*R[-6]C/(COS(ASIN(R[-1]C))*COS(ASIN(R[-1]C))),"""")"
    Range("N23:BK23").FormulaR1C1 = _
        "=IF(R1C<>"""",R[-15]C/16*COS(ASIN(R[-2]C))*COS(ASIN(R[-2]C))*(4+R[-15]C*(4-3*COS(ASIN(R[-2]C))*COS(ASIN(R[-2]C)))),"""")"
    Range("N24:BK24").FormulaR1C1 = _
        "=IF(R1C<>"""",R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C))),"""")"
    Range("N25:BK25").FormulaR1C1 = _
        "=IF(R1C<>"""",ATAN2((R[-12]C*R[-9]C-R[-13]C*R[-8]C*COS(R[-1]C)),R[-8]C*SIN(R[-1]C)),"""")"
    Range("N26:BK26").FormulaR1C1 = _
        "=IF(R1C<>"""",ATAN2((-R[-14]C*R[-9]C+R[-13]C*R[-10]C*COS(R[-2]C)),R[-13]C*SIN(R[-2]C)),"""")"
    Range("N27:BK27").FormulaR1C1 = "=IF(R1C="""","""",IF(AND(R2C=R2C2,R3C=R2C3),""samepoint"",""N.A. "" ))"
    Range("N28:BK28").FormulaR1C1 = "=IF(R1C="""","""",IF(AND(R3C=R2C3,R2C2>R2C),""northsouth"",""N.A. ""))"
    Range("N29:BK29").FormulaR1C1 = "=IF(R1C="""","""",IF(AND(R3C=R2C3,R2C>R2C2),""southnorth"",""N.A. ""))"
    Range("N30:BK30").FormulaR1C1 = _
        "=IF(R1C="""","""",IF(R[-3]C=""samepoint"",0,IF(R[-2]C=""northsouth"",0,IF(R[-1]C=""southnorth"",180,IF(R[-5]C<0,R[-5]C*180/PI()+360,R[-5]C*180/PI())))))"
    Range("N31:BK31").FormulaR1C1 = _
        "=IF(R1C="""","""",IF(R[-4]C=""samepoint"",0,IF(R[-3]C=""northsouth"",180,IF(R[-2]C=""southnorth"",0,R[-5]C*180/PI()+180))))"
    Range("N32:BK32").FormulaR1C1 = "=IF(R1C="""","""",IF(R[-2]C+45>360,R[-2]C+45-360,R[-2]C+45))"
    Range("N33:BK33").FormulaR1C1 = "=IF(R1C="""","""",IF(R[-3]C-45<0,R[-3]C-45+360,R[-3]C-45))"
    ActiveSheet.Calculate
    Range("N8:BK33").Value = Range("N8:BK33").Value
    Range("N6:BK7").Value = Range("N32:BK33").Value
    
    Range("N8:BK10008").Clear
    
    Application.Run "F.xlsm!Sect1"
    Application.Run "F.xlsm!Last"

    If Range("A1") < 42278 And Range("M3") <> "" Then
        Application.Run "F.xlsm!OZsectorB"
        Exit Sub
    
    ElseIf Range("A4") = "NO FIN LINE" And Range("H4") = "NO FIN LINE" And Range("H9") = "NO FIN LINE" And Range("M3") = "" Then
        Application.Run "F.xlsm!NearestSF"
        Exit Sub
    
    ElseIf Range("A1") >= 42278 And Range("A4") = "NO FIN LINE" And Range("H4") = "NO FIN LINE" Then
        Application.Run "F.xlsm!FlineLast"
        Exit Sub
    End If
        
End If

Application.Run "F.xlsm!Fline2"
'Application.Run "F.xlsm!OZSectorB"
End Sub

Sub Sect1()
'
' CK for FIN OZ BY COLUMN  10/7/13 Cks 7 Finish Alternatives only 2 flaws corrected 11/1/13
'
'Column N
Application.ScreenUpdating = False
If Range("N1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("N2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("N3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("N16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("N8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[2]>R7C[2],RC[2]>=R7C[2],RC[2]<=R6C[2]),AND(R6C[2]<R7C[2],OR(RC[2]>=R7C[2],RC[2]<=R6C[2]))),RC[2],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N8").Value = Range("N8").Value

If Range("N8") < 0 Then
    Range("N10:N500").ClearContents
End If
End If

'Column O
If Range("O1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("O2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("O3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("O16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("O8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[3]>R7C[3],RC[3]>=R7C[3],RC[3]<=R6C[3]),AND(R6C[3]<R7C[3],OR(RC[3]>=R7C[3],RC[3]<=R6C[3]))),RC[3],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("O8").Value = Range("O8").Value

If Range("O8") < 0 Then
    Range("O10:O500").ClearContents
End If
End If

'Column P
If Range("P1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("P2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("P3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("P16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("P8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[4]>R7C[4],RC[4]>=R7C[4],RC[4]<=R6C[4]),AND(R6C[4]<R7C[4],OR(RC[4]>=R7C[4],RC[4]<=R6C[4]))),RC[4],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("P8").Value = Range("P8").Value

If Range("P8") < 0 Then
    Range("P10:P500").ClearContents
End If
End If

'Column Q
If Range("Q1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("Q2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("Q3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Q16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("Q8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[5]>R7C[5],RC[5]>=R7C[5],RC[5]<=R6C[5]),AND(R6C[5]<R7C[5],OR(RC[5]>=R7C[5],RC[5]<=R6C[5]))),RC[5],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Q8").Value = Range("Q8").Value

If Range("Q8") < 0 Then
    Range("Q10:Q500").ClearContents
End If
End If

'Column R
If Range("R1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("R2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("R3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("R16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("R8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[6]>R7C[6],RC[6]>=R7C[6],RC[6]<=R6C[6]),AND(R6C[6]<R7C[6],OR(RC[6]>=R7C[6],RC[6]<=R6C[6]))),RC[6],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R8").Value = Range("R8").Value

If Range("R8") < 0 Then
    Range("R10:R500").ClearContents
End If
End If

'Column S
If Range("S1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("S2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("S3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("S16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("S8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[7]>R7C[7],RC[7]>=R7C[7],RC[7]<=R6C[7]),AND(R6C[7]<R7C[7],OR(RC[7]>=R7C[7],RC[7]<=R6C[7]))),RC[7],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("S8").Value = Range("S8").Value

If Range("S8") < 0 Then
    Range("S10:S500").ClearContents
End If
End If

'Column T
If Range("T1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("T2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("T3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T13").Value = Sheets("YDWK3").Range("C2").Value

     Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("T16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("T8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[8]>R7C[8],RC[8]>=R7C[8],RC[8]<=R6C[8]),AND(R6C[8]<R7C[8],OR(RC[8]>=R7C[8],RC[8]<=R6C[8]))),RC[8],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("T8").Value = Range("T8").Value

If Range("T8") < 0 Then
    Range("T10:T500").ClearContents
End If
End If

'Column U
If Range("U1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("U2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("U3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("U16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("U8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[9]>R7C[9],RC[9]>=R7C[9],RC[9]<=R6C[9]),AND(R6C[9]<R7C[9],OR(RC[9]>=R7C[9],RC[9]<=R6C[9]))),RC[9],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("U8").Value = Range("U8").Value

If Range("U8") < 0 Then
    Range("U10:U500").ClearContents
End If
End If

'Column V
If Range("V1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("V2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("V3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("V16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("V8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[10]>R7C[10],RC[10]>=R7C[10],RC[10]<=R6C[10]),AND(R6C[10]<R7C[10],OR(RC[10]>=R7C[10],RC[10]<=R6C[10]))),RC[10],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("V8").Value = Range("V8").Value

If Range("V8") < 0 Then
    Range("V10:V500").ClearContents
End If
End If

'Column W
If Range("W1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("W2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("W3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("W16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("W8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[11]>R7C[11],RC[11]>=R7C[11],RC[11]<=R6C[11]),AND(R6C[11]<R7C[11],OR(RC[11]>=R7C[11],RC[11]<=R6C[11]))),RC[11],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("W8").Value = Range("W8").Value

If Range("W8") < 0 Then
    Range("W10:W500").ClearContents
End If
End If

If Range("X1") <> "" Then Application.Run "F.xlsm!Sect2"

End Sub

Sub Sect2()
'
' OZSect2 Macro
'
'Column X
Application.ScreenUpdating = False
If Range("X1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("X2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("X3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X13").Value = Sheets("YDWK3").Range("C2").Value

     Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("X16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("X8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[12]>R7C[12],RC[12]>=R7C[12],RC[12]<=R6C[12]),AND(R6C[12]<R7C[12],OR(RC[12]>=R7C[12],RC[12]<=R6C[12]))),RC[12],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("X8").Value = Range("X8").Value

If Range("X8") < 0 Then
    Range("X10:X500").ClearContents
End If
End If

'Column Y
If Range("Y1") <> "" Then
    Sheets("YDWK3").Activate
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("Y2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("Y3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Y16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("Y8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[13]>R7C[13],RC[13]>=R7C[13],RC[13]<=R6C[13]),AND(R6C[13]<R7C[13],OR(RC[13]>=R7C[13],RC[13]<=R6C[13]))),RC[13],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Y8").Value = Range("Y8").Value

If Range("Y8") < 0 Then
    Range("Y10:Y500").ClearContents
End If
End If

'Column Z
If Range("Z1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("Z2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("Z3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("Z16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("Z8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[14]>R7C[14],RC[14]>=R7C[14],RC[14]<=R6C[14]),AND(R6C[14]<R7C[14],OR(RC[14]>=R7C[14],RC[14]<=R6C[14]))),RC[14],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("Z8").Value = Range("Z8").Value

If Range("Z8") < 0 Then
    Range("Z10:Z500").ClearContents
End If
End If

'Column AA
If Range("AA1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AA2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AA3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AA16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AA8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[15]>R7C[15],RC[15]>=R7C[15],RC[15]<=R6C[15]),AND(R6C[15]<R7C[15],OR(RC[15]>=R7C[15],RC[15]<=R6C[15]))),RC[15],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AA8").Value = Range("AA8").Value

If Range("AA8") < 0 Then
    Range("AA10:AA500").ClearContents
End If
End If

'Column AB
If Range("AB1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AB2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AB3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AB16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AB8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[16]>R7C[16],RC[16]>=R7C[16],RC[16]<=R6C[16]),AND(R6C[16]<R7C[16],OR(RC[16]>=R7C[16],RC[16]<=R6C[16]))),RC[16],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AB8").Value = Range("AB8").Value

If Range("AB8") < 0 Then
    Range("AB10:AB500").ClearContents
End If
End If

'Column AC
If Range("AC1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AC2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AC3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AC16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AC8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[17]>R7C[17],RC[17]>=R7C[17],RC[17]<=R6C[17]),AND(R6C[17]<R7C[17],OR(RC[17]>=R7C[17],RC[17]<=R6C[17]))),RC[17],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AC8").Value = Range("AC8").Value

If Range("AC8") < 0 Then
    Range("AC10:AC500").ClearContents
End If
End If

'Column AD
If Range("AD1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AD2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AD3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AD16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AD8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[18]>R7C[18],RC[18]>=R7C[18],RC[18]<=R6C[18]),AND(R6C[18]<R7C[18],OR(RC[18]>=R7C[18],RC[18]<=R6C[18]))),RC[18],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AD8").Value = Range("AD8").Value

If Range("AD8") < 0 Then
    Range("AD10:AD500").ClearContents
End If
End If

'Column AE
If Range("AE1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AE2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AE3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AE16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AE8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[19]>R7C[19],RC[19]>=R7C[19],RC[19]<=R6C[19]),AND(R6C[19]<R7C[19],OR(RC[19]>=R7C[19],RC[19]<=R6C[19]))),RC[19],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AE8").Value = Range("AE8").Value

If Range("AE8") < 0 Then
    Range("AE10:AE500").ClearContents
End If
End If

'Column AF
If Range("AF1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AF2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AF3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AF16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AF8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[20]>R7C[20],RC[20]>=R7C[20],RC[20]<=R6C[20]),AND(R6C[20]<R7C[20],OR(RC[20]>=R7C[20],RC[20]<=R6C[20]))),RC[20],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AF8").Value = Range("AF8").Value

If Range("AF8") < 0 Then
    Range("AF10:AF500").ClearContents
End If
End If

'Column AG
If Range("AG1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AG2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AG3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AG16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AG8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[21]>R7C[21],RC[21]>=R7C[21],RC[21]<=R6C[21]),AND(R6C[21]<R7C[21],OR(RC[21]>=R7C[21],RC[21]<=R6C[21]))),RC[21],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AG8").Value = Range("AG8").Value

If Range("AG8") < 0 Then
    Range("AG10:AG500").ClearContents
End If
End If

If Range("AH1") <> "" Then Application.Run "F.xlsm!Sect3"

End Sub

Sub Sect3()
'
' OZSect3 Macro
'
'Column AH
Application.ScreenUpdating = False
If Range("AH1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AH2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AH3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AH16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AH8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[22]>R7C[22],RC[22]>=R7C[22],RC[22]<=R6C[22]),AND(R6C[22]<R7C[22],OR(RC[22]>=R7C[22],RC[22]<=R6C[22]))),RC[22],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AH8").Value = Range("AH8").Value

If Range("AH8") < 0 Then
    Range("AH10:AH500").ClearContents
End If
End If

'Column AI
If Range("AI1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AI2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AI3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AI16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AI8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[23]>R7C[23],RC[23]>=R7C[23],RC[23]<=R6C[23]),AND(R6C[23]<R7C[23],OR(RC[23]>=R7C[23],RC[23]<=R6C[23]))),RC[23],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AI8").Value = Range("AI8").Value

If Range("AI8") < 0 Then
    Range("AI10:AI500").ClearContents
End If
End If

'Column AJ
If Range("AJ1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AJ2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AJ3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AJ16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AJ8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[24]>R7C[24],RC[24]>=R7C[24],RC[24]<=R6C[24]),AND(R6C[24]<R7C[24],OR(RC[24]>=R7C[24],RC[24]<=R6C[24]))),RC[24],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AJ8").Value = Range("AJ8").Value

If Range("AJ8") < 0 Then
    Range("AJ10:AJ500").ClearContents
End If
End If

'Column AK
If Range("AK1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AK2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AK3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AK16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AK8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[25]>R7C[25],RC[25]>=R7C[25],RC[25]<=R6C[25]),AND(R6C[25]<R7C[25],OR(RC[25]>=R7C[25],RC[25]<=R6C[25]))),RC[25],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AK8").Value = Range("AK8").Value

If Range("AK8") < 0 Then
    Range("AK10:AK500").ClearContents
End If
End If

'Column AL
If Range("AL1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AL2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AL3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AL16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AL8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[26]>R7C[26],RC[26]>=R7C[26],RC[26]<=R6C[26]),AND(R6C[26]<R7C[26],OR(RC[26]>=R7C[26],RC[26]<=R6C[26]))),RC[26],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AL8").Value = Range("AL8").Value

If Range("AL8") < 0 Then
    Range("AL10:AL500").ClearContents
End If
End If

'Column AM
If Range("AM1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AM2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AM3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AM16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AM8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[27]>R7C[27],RC[27]>=R7C[27],RC[27]<=R6C[27]),AND(R6C[27]<R7C[27],OR(RC[27]>=R7C[27],RC[27]<=R6C[27]))),RC[27],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AM8").Value = Range("AM8").Value

If Range("AM8") < 0 Then
    Range("AM10:AM500").ClearContents
End If
End If

'Column AN
If Range("AN1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AN2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AN3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AN16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AN8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[28]>R7C[28],RC[28]>=R7C[28],RC[28]<=R6C[28]),AND(R6C[28]<R7C[28],OR(RC[28]>=R7C[28],RC[28]<=R6C[28]))),RC[28],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AN8").Value = Range("AN8").Value

If Range("AN8") < 0 Then
    Range("AN10:AN500").ClearContents
End If
End If

'Column AO
If Range("AO1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AO2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AO3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AO16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AO8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[29]>R7C[29],RC[29]>=R7C[29],RC[29]<=R6C[29]),AND(R6C[29]<R7C[29],OR(RC[29]>=R7C[29],RC[29]<=R6C[29]))),RC[29],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AO8").Value = Range("AO8").Value

If Range("AO8") < 0 Then
    Range("AO10:AO500").ClearContents
End If
End If

'Column AP
If Range("AP1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AP2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AP3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AP16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AP8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[30]>R7C[30],RC[30]>=R7C[30],RC[30]<=R6C[30]),AND(R6C[30]<R7C[30],OR(RC[30]>=R7C[30],RC[30]<=R6C[30]))),RC[30],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AP8").Value = Range("AP8").Value

If Range("AP8") < 0 Then
    Range("AP10:AP500").ClearContents
End If
End If

'Column AQ
If Range("AQ1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AQ2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AQ3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AQ16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AQ8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[31]>R7C[31],RC[31]>=R7C[31],RC[31]<=R6C[31]),AND(R6C[31]<R7C[31],OR(RC[31]>=R7C[31],RC[31]<=R6C[31]))),RC[31],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AQ8").Value = Range("AQ8").Value

If Range("AQ8") < 0 Then
    Range("AQ10:AQ500").ClearContents
End If
End If

If Range("AR1") <> "" Then Application.Run "F.xlsm!Sect4"

End Sub

Sub Sect4()
'
' OZSect4 Macro
'
'Column AR
Application.ScreenUpdating = False
If Range("AR1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AR2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AR3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AR16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AR8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[32]>R7C[32],RC[32]>=R7C[32],RC[32]<=R6C[32]),AND(R6C[32]<R7C[32],OR(RC[32]>=R7C[32],RC[32]<=R6C[32]))),RC[32],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AR8").Value = Range("AR8").Value

If Range("AR8") < 0 Then
    Range("AR10:AR500").ClearContents
End If
End If

'Column AS
If Range("AS1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AS2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AS3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AS16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AS8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[33]>R7C[33],RC[33]>=R7C[33],RC[33]<=R6C[33]),AND(R6C[33]<R7C[33],OR(RC[33]>=R7C[33],RC[33]<=R6C[33]))),RC[33],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AS8").Value = Range("AS8").Value

If Range("AS8") < 0 Then
    Range("AS10:AS500").ClearContents
End If
End If

'Column AT
If Range("AT1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AT2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AT3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AT16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AT8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[34]>R7C[34],RC[34]>=R7C[34],RC[34]<=R6C[34]),AND(R6C[34]<R7C[34],OR(RC[34]>=R7C[34],RC[34]<=R6C[34]))),RC[34],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AT8").Value = Range("AT8").Value

If Range("AT8") < 0 Then
    Range("AT10:AT500").ClearContents
End If
End If

'Column AU
If Range("AU1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AU2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AU3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AU16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AU8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[35]>R7C[35],RC[35]>=R7C[35],RC[35]<=R6C[35]),AND(R6C[35]<R7C[35],OR(RC[35]>=R7C[35],RC[35]<=R6C[35]))),RC[35],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AU8").Value = Range("AU8").Value

If Range("AU8") < 0 Then
    Range("AU10:AU500").ClearContents
End If
End If

'Column AV
If Range("AV1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AV2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AV3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AV16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AV8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[36]>R7C[36],RC[36]>=R7C[36],RC[36]<=R6C[36]),AND(R6C[36]<R7C[36],OR(RC[36]>=R7C[36],RC[36]<=R6C[36]))),RC[36],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AV8").Value = Range("AV8").Value

If Range("AV8") < 0 Then
    Range("AV10:AV500").ClearContents
End If
End If

'Column AW
If Range("AW1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AW2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AW3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AW16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AW8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[37]>R7C[37],RC[37]>=R7C[37],RC[37]<=R6C[37]),AND(R6C[37]<R7C[37],OR(RC[37]>=R7C[37],RC[37]<=R6C[37]))),RC[37],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AW8").Value = Range("AW8").Value

If Range("AW8") < 0 Then
    Range("AW10:AW500").ClearContents
End If
End If

'Column AX
If Range("AX1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AX2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AX3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AX16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AX8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[38]>R7C[38],RC[38]>=R7C[38],RC[38]<=R6C[38]),AND(R6C[38]<R7C[38],OR(RC[38]>=R7C[38],RC[38]<=R6C[38]))),RC[38],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AX8").Value = Range("AX8").Value

If Range("AX8") < 0 Then
    Range("AX10:AX500").ClearContents
End If
End If

'Column AY
If Range("AY1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AY2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AY3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AY16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AY8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[39]>R7C[39],RC[39]>=R7C[39],RC[39]<=R6C[39]),AND(R6C[39]<R7C[39],OR(RC[39]>=R7C[39],RC[39]<=R6C[39]))),RC[39],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AY8").Value = Range("AY8").Value

If Range("AY8") < 0 Then
    Range("AY10:AY500").ClearContents
End If
End If

'Column AZ
If Range("AZ1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("AZ2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("AZ3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("AZ16").Value = Sheets("YDWK3").Range("C2").Value
  
' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("AZ8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[40]>R7C[40],RC[40]>=R7C[40],RC[40]<=R6C[40]),AND(R6C[40]<R7C[40],OR(RC[40]>=R7C[40],RC[40]<=R6C[40]))),RC[40],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("AZ8").Value = Range("AZ8").Value

If Range("AZ8") < 0 Then
    Range("AZ10:AZ500").ClearContents
End If
End If

'Column BA
If Range("BA1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BA2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BA3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BA16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BA8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[41]>R7C[41],RC[41]>=R7C[41],RC[41]<=R6C[41]),AND(R6C[41]<R7C[41],OR(RC[41]>=R7C[41],RC[41]<=R6C[41]))),RC[41],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BA8").Value = Range("BA8").Value

If Range("BA8") < 0 Then
    Range("BA10:BA500").ClearContents
End If
End If
If Range("BB1") <> "" Then Application.Run "F.xlsm!Sect5"

End Sub

Sub Sect5()
'
' Sect5 Macro
'
'Column BB
Application.ScreenUpdating = False
If Range("BB1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BB2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BB3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BB16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BB8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[42]>R7C[42],RC[42]>=R7C[42],RC[42]<=R6C[42]),AND(R6C[42]<R7C[42],OR(RC[42]>=R7C[42],RC[42]<=R6C[42]))),RC[42],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BB8").Value = Range("BB8").Value

If Range("BB8") < 0 Then
    Range("BB10:BB500").ClearContents
End If
End If

'Column BC
If Range("BC1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BC2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BC3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BC16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BC8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[43]>R7C[43],RC[43]>=R7C[43],RC[43]<=R6C[43]),AND(R6C[43]<R7C[43],OR(RC[43]>=R7C[43],RC[43]<=R6C[43]))),RC[43],-1)"

    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BC8").Value = Range("BC8").Value

If Range("BC8") < 0 Then
    Range("BC10:BC500").ClearContents
End If
End If

'Column BD
If Range("BD1") <> "" Then
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BD2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BD3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BD16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BD8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[44]>R7C[44],RC[44]>=R7C[44],RC[44]<=R6C[44]),AND(R6C[44]<R7C[44],OR(RC[44]>=R7C[44],RC[44]<=R6C[44]))),RC[44],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("BD8").Value = Range("BD8").Value

If Range("BD8") < 0 Then
    Range("BD10:BD500").ClearContents
End If
End If

'Column BE
If Range("BE1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BE2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BE3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BE16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BE8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[45]>R7C[45],RC[45]>=R7C[45],RC[45]<=R6C[45]),AND(R6C[45]<R7C[45],OR(RC[45]>=R7C[45],RC[45]<=R6C[45]))),RC[45],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BE8").Value = Range("BE8").Value

If Range("BE8") < 0 Then
    Range("BE10:BE500").ClearContents
End If
End If

'Column BF
If Range("BF1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BF2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BF3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BF15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("Sheet2").Range("BF16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BF8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[46]>R7C[46],RC[46]>=R7C[46],RC[46]<=R6C[46]),AND(R6C[46]<R7C[46],OR(RC[46]>=R7C[46],RC[46]<=R6C[46]))),RC[46],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BF8").Value = Range("BF8").Value

If Range("BF8") < 0 Then
    Range("BF10:BF500").ClearContents
End If
End If

'Column BG
If Range("BG1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BG2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BG3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BG16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BG8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[47]>R7C[47],RC[47]>=R7C[47],RC[47]<=R6C[47]),AND(R6C[47]<R7C[47],OR(RC[47]>=R7C[47],RC[47]<=R6C[47]))),RC[47],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BG8").Value = Range("BG8").Value

If Range("BG8") < 0 Then
    Range("BG10:BG500").ClearContents
End If
End If

'Column BH
If Range("BH1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BH2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BH3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BH16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BH8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[48]>R7C[48],RC[48]>=R7C[48],RC[48]<=R6C[48]),AND(R6C[48]<R7C[48],OR(RC[48]>=R7C[48],RC[48]<=R6C[48]))),RC[48],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BH8").Value = Range("BH8").Value

If Range("BH8") < 0 Then
    Range("BH10:BH500").ClearContents
End If
End If

'Column BI
If Range("BI1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BI2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BI3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("Sheet2").Range("BI15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BI16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BI8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[49]>R7C[49],RC[49]>=R7C[49],RC[49]<=R6C[49]),AND(R6C[49]<R7C[49],OR(RC[49]>=R7C[49],RC[49]<=R6C[49]))),RC[49],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BI8").Value = Range("BI8").Value

If Range("BI8") < 0 Then
    Range("BI10:BI500").ClearContents
End If
End If

'Column BJ
If Range("BJ1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BJ2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BJ3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BJ16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BJ8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[50]>R7C[50],RC[50]>=R7C[50],RC[50]<=R6C[50]),AND(R6C[50]<R7C[50],OR(RC[50]>=R7C[50],RC[50]<=R6C[50]))),RC[50],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BJ8").Value = Range("BJ8").Value

If Range("BJ8") < 0 Then
    Range("BJ10:BJ500").ClearContents
End If
End If

'Column BK
If Range("BK1") <> "" Then
Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H10:I10").Value
    Sheets("YDWK3").Range("C6").Value = Sheets("Sheet2").Range("BK2").Value
    Sheets("YDWK3").Range("D6").Value = Sheets("Sheet2").Range("BK3").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK10").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H11:I11").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK11").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H12:I12").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK12").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H13:I13").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK13").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H14:I14").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK14").Value = Sheets("YDWK3").Range("C2").Value

    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H15:I15").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK15").Value = Sheets("YDWK3").Range("C2").Value
    
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet2").Range("H16:I16").Value
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    ActiveSheet.Calculate
    Sheets("Sheet2").Range("BK16").Value = Sheets("YDWK3").Range("C2").Value

' Test Column(Starts) for FIN in OZ Sector
    Sheets("Sheet2").Activate
    Range("BK8").FormulaR1C1 = "=MAX(R[2]C12:R[493]C12)"
    Range("L10").FormulaR1C1 = _
        "=IF(OR(AND(R6C[51]>R7C[51],RC[51]>=R7C[51],RC[51]<=R6C[51]),AND(R6C[51]<R7C[51],OR(RC[51]>=R7C[51],RC[51]<=R6C[51]))),RC[51],-1)"
    
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("L10:L10").AutoFill Destination:=.Range("L10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("BK8").Value = Range("BK8").Value

If Range("BK8") < 0 Then
    Range("BK10:BK500").ClearContents
End If
End If

End Sub

Sub Last()
'
' Last Macro
'
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual
    Range("N102:BK102").FormulaR1C1 = _
        "=IF(R8C>0,6371*ACOS(SIN(R2C)*SIN(R2C2)+COS(R2C)*COS(R2C2)*COS(R2C3-R3C)),"""")"
    
    Range("N101").FormulaR1C1 = "=MAX(R[1]C:R[1]C[49])"
    Range("N101").Value = Range("N101").Value
    
  If Range("N101") = 0 Then
    Columns("N:BK").Clear
  
  ElseIf Range("N101") <> 0 Then
    Range("N103:BK103").FormulaR1C1 = "=IF(R102C=R101C14,R1C,"""")"
    Range("N104:BK104").FormulaR1C1 = "=IF(R[-1]C<>"""",R2C,"""")"
    Range("N105:BK105").FormulaR1C1 = "=IF(R[-1]C<>"""",R3C,"""")"
    Range("N106:BK106").FormulaR1C1 = "=IF(R[-1]C<>"""",R4C,"""")"
    Range("N107:BK107").FormulaR1C1 = "=IF(R[-1]C<>"""",R5C,"""")"
    
    Range("L103:L107").FormulaR1C1 = "=MAX(RC[2]:RC[51])"
    Range("L103:L107").Value = Range("L103:L107").Value
    
    Range("L103:L107").Copy
    Range("H1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("G105:K129").Value = Range("G10:K34").Value
     
    Range("N103:BK103").FormulaR1C1 = "=IF(R102C=R101C14,R6C,"""")"
    Range("N104:BK104").FormulaR1C1 = "=IF(R[-1]C<>"""",R7C,"""")"
    Range("N105:BK105").FormulaR1C1 = "=IF(R[-1]C<>"""",R10C,"""")"
    Range("N106:BK106").FormulaR1C1 = "=IF(R[-1]C<>"""",R11C,"""")"
    Range("N107:BK107").FormulaR1C1 = "=IF(R[-1]C<>"""",R12C,"""")"
    Range("N108:BK108").FormulaR1C1 = "=IF(R[-1]C<>"""",R13C,"""")"
    Range("N109:BK109").FormulaR1C1 = "=IF(R[-1]C<>"""",R14C,"""")"
    Range("N110:BK110").FormulaR1C1 = "=IF(R[-1]C<>"""",R15C,"""")"
    Range("N111:BK111").FormulaR1C1 = "=IF(R[-1]C<>"""",R16C,"""")"
    Range("N103:BK111").Value = Range("N103:BK111").Value
    Range("L103:L109").Clear
    Range("L103:L111").FormulaR1C1 = "=MAX(RC[2]:RC[51])"
     
    Range("M105").FormulaR1C1 = _
        "=IF(OR(AND(R103C[-1]>R104C[-1],RC[-1]>=R104C[-1],RC[-1]<=R103C[-1]),AND(R103C[-1]<R104C[-1],OR(RC[-1]<=R103C[-1],RC[-1]>=R104C[-1]))),RC[-6],"""")"

    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M105:M105").AutoFill Destination:=.Range("M105:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("G101").FormulaR1C1 = "=MAX(R[4]C[6]:R[28]C[6])"
    Range("G101").Value = Range("G101").Value
    
    Range("H105").FormulaR1C1 = "=IF(RC[-1]=R101C[-1],R[-95]C,"""")"
    Range("I105").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-95]C,"""")"
    Range("J105").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-95]C,"""")"
    Range("K105").FormulaR1C1 = "=IF(RC[-1]<>"""",R[-95]C,"""")"
    
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("H105:K105").AutoFill Destination:=.Range("H105:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    
    Range("H101:K101").FormulaR1C1 = "=MAX(R[4]C:R[24]C)"
    Range("H101:K101").Value = Range("H101:K101").Value
    Range("H3:L3").Value = Range("G101:K101").Value
    
    Range("H2:L2").Value = Range("A2:E2").Value
    Range("M2").FormulaR1C1 = _
        "=IF(R[-1]C[-2]-R[1]C[-2]<=R9C4,2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3])),2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))-((R[-1]C[-2]-R[1]C[-2]-R9C4)*0.1))"
    Range("M2").Value = Range("M2").Value
    Range("M3").Value = "SECTOR"

    Range("A5,C6:E7").Clear
    Range("G10:M10009").Clear
    Columns("N:BK").Clear
    
  End If
End Sub
Sub NearestSF()
'
' NearestSF Macro; amended 8/27/17 for Franke et similar
'
Application.ScreenUpdating = False

    Range("H6:L9").Clear
    Range("A5").Value = "0.00138888888888889"
    
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]>=R3C8-R5C1,RC[-12]<=R3C8+R5C1),RC[-12],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    Range("R10").FormulaR1C1 = "=IF(OR(RC[-1]="""",RC[-3]=R1C10),"""",6371*ACOS(SIN(RC[-4])*SIN(R1C9)+COS(RC[-4])*COS(R1C9)*COS(R1C10-RC[-3])))"
    'Copy Ref A Value Sort
    Application.Calculation = xlCalculationManual
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:R10").AutoFill Destination:=.Range("M10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:R10009").Value = Range("M10:R10009").Value
    Range("M10:R10009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("R8").FormulaR1C1 = "=MIN(R[2]C:R[501]C)"
    Range("S8:W8").FormulaR1C1 = "=MAX(R[2]C:R[501]C)"
    
    Range("S10").FormulaR1C1 = "=IF(RC[-1]=R8C18,RC[-6],"""")"
    Range("T10:W10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref M
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "M").End(xlUp).Row
.Range("S10:W10").AutoFill Destination:=.Range("S10:W" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R8:W8").Value = Range("R8:W8").Value
    
    Range("R10:R509").Clear
    
    Range("R10").FormulaR1C1 = "=IF(AND(RC[-17]>=R1C8-R5C1,RC[-17]<=R1C8+R5C1),RC[-17],"""")"
    Range("S10:V10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-17],"""")"
    Range("W10").FormulaR1C1 = "=IF(OR(RC[-1]="""",RC[-2]=R8C21),"""",6371*ACOS(SIN(RC[-4])*SIN(R8C20)+COS(RC[-4])*COS(R8C20)*COS(R8C21-RC[-3])))"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("R10:W10").AutoFill Destination:=.Range("R10:W" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("R10:W10009").Value = Range("R10:W10009").Value
    Range("R10:W10009").Sort Key1:=Range("R10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("R6").FormulaR1C1 = "=MIN(R[4]C[5]:R[496]C[5])"
    Range("S6:W6").FormulaR1C1 = "=MAX(R[4]C[5]:R[496]C[5])"
    
    Range("X10").FormulaR1C1 = "=IF(RC[-1]=R6C18,RC[-6],"""")"
    Range("Y10:AB10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref R
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "R").End(xlUp).Row
.Range("X10:AB10").AutoFill Destination:=.Range("X10:AB" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("S6:W6").Value = Range("S6:W6").Value
    Range("S7:W7").Value = Range("H2:L2").Value
    Range("H6:L8").Value = Range("S6:W8").Value
    
    Range("S6:W8,M10:W10009").Clear
    Columns("X:AB").Clear
    Range("M7").FormulaR1C1 = "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate
    Range("A5").Value = "0.000208333333333333"
    
    Range("M10").FormulaR1C1 = "=IF(AND(RC[-12]>=R8C8-R5C1,RC[-12]<=R8C8+R5C1),RC[-12],"""")"
    Range("N10:Q10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-12],"""")"
    Range("R10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R7C9)+COS(RC[-4])*COS(R7C9)*COS(R7C10-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:R10").AutoFill Destination:=.Range("M10:R" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:R10009").Value = Range("M10:R10009").Value
    Range("M10:R10009").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    Range("M10:R509").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
        
    Range("M10:R10009").Clear
    
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R6C8-R5C1,RC[-6]<=R6C8+R5C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R7C9)+COS(RC[-4])*COS(R7C9)*COS(R7C10-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
     
    'MATRIX
    Range("N10:BK10").FormulaR1C1 = _
        "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5),"""",6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))))"
    'Copy Ref L
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "L").End(xlUp).Row
.Range("N10:BK10").AutoFill Destination:=.Range("N10:BK" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("I5").FormulaR1C1 = "=MIN(R[5]C[5]:R[495]C[42])"
    Range("I5").Value = Range("I5").Value
    Range("N10:BK50").Value = Range("N10:BK50").Value
    Range("N7:BK7").FormulaR1C1 = "=IF(MIN(R[3]C:R[493]C)=R5C9,R[-6]C,"""")"
    Range("N7:BK7").Value = Range("N7:BK7").Value
    Range("M10:M50").FormulaR1C1 = "=IF(MIN(RC[1]:RC[50])=R5C9,RC[-6],"""")"
    Range("M10:M50").Value = Range("M10:M50").Value
    
    Range("N10:BK50").Clear
    
    Range("N8:BK11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    
    Range("H8").FormulaR1C1 = "=MAX(R[-1]C[6]:R[-1]C[55])"
    Range("I8").FormulaR1C1 = "=MAX(RC[5]:RC[54])"
    Range("J8").FormulaR1C1 = "=MAX(R[1]C[4]:R[1]C[53])"
    Range("K8").FormulaR1C1 = "=MAX(R[2]C[3]:R[2]C[52])"
    Range("L8").FormulaR1C1 = "=MAX(R[3]C[2]:R[3]C[51])"
    Range("H8:L8").Value = Range("H8:L8").Value
    Range("N7:BK11").Clear
    
    Range("N10:Q50").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    Range("H6:L6").FormulaR1C1 = "=MAX(R[4]C[5]:R[494]C[5])"
    ActiveSheet.Calculate
    Range("H6:L6").Value = Range("H6:L6").Value
    
    Range("M7").FormulaR1C1 = _
        "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    ActiveSheet.Calculate
    Range("I5,G10:Q10009,N1:BK6").Clear
    
    'Revised 8/27/17 Franke no change
    If Range("M7") > Range("M2") Then
        Range("A1:F3").Value = Range("H6:M8").Value
        Application.Run "F.xlsm!OZSector"
    ElseIf Range("M7") <= Range("M2") Then
        Range("H6:M8").Clear
        Application.Run "F.xlsm!OZSectorB"
    End If
End Sub
Sub FLineLast()
'
' Tests within 3 minutes of initial S/F pt for Fin Line ONLY
'
    Range("A5").Value = 0.002083333
    'Starts within 3 minutes of H1
    Range("G10").FormulaR1C1 = "=IF(AND(RC[-6]>=R1C8-R5C1,RC[-6]<=R1C8+R5C1),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("L10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3])),"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:L10").AutoFill Destination:=.Range("G10:L" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:L10009").Value = Range("G10:L10009").Value
    Range("G10:L10009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'Finis
    Range("O10").FormulaR1C1 = "=IF(AND(RC[-14]>=R3C8-R5C1,RC[-14]<=R3C8+R5C1),RC[-14],"""")"
    Range("P10:S10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-14],"""")"
    Range("T10").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-4])*SIN(R2C9)+COS(RC[-4])*COS(R2C9)*COS(R2C10-RC[-3])),"""")"
    'Copy Ref A Value Sort Copy to N1
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("O10:T10").AutoFill Destination:=.Range("O10:T" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("O10:T10009").Value = Range("O10:T10009").Value
    Range("O10:T10009").Sort Key1:=Range("O10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    Range("O10:T190").Copy
    Range("N1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    
    Range("O10:T10009").Clear
    
    'Matrix
     Range("N10:GK10").FormulaR1C1 = _
        "=IF(OR(R1C="""",R3C=RC9),"""",IF(OR(R6C<RC12,6371*ACOS(SIN(R2C)*SIN(RC8)+COS(R2C)*COS(RC8)*COS(RC9-R3C))>0.5,R6C<SQRT(RC12^2+0.25),R6C>R6C[1]),"""",IF(RC10-R4C<R9C4,R6C+RC12,R6C+RC12-((RC10-R4C-R9C4)*0.1))))"
    'Range("N10:GK10").FormulaR1C1 = "=IF(OR(R1C="""",RC9=R3C),"""",IF(OR(6371*ACOS(SIN(RC8)*SIN(R2C)+COS(RC8)*COS(R2C)*COS(R3C-RC9))>0.5,R6C[1]<R6C),0,2*RC12))"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("N10:GK10").AutoFill Destination:=.Range("N10:GK" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("N10:GK190").Value = Range("N10:GK190").Value

    Range("M8").FormulaR1C1 = "=MAX(R[2]C[1]:R[352]C[180])"
    Range("M8").Value = Range("M8").Value
    
    If Range("M8") <> 0 Then
    
    Range("M10").FormulaR1C1 = "=IF(MAX(RC[1]:RC[180])=R8C13,RC[-6],"""")"
    'Copy Ref G
    With Worksheets("Sheet2")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("M10:M10").AutoFill Destination:=.Range("M10:M" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:M10009").Value = Range("M10:M10009").Value
    
    Range("N7:GK7").FormulaR1C1 = "=IF(MAX(R[3]C:R[193]C)=R8C13,R[-6]C,"""")"
    ActiveSheet.Calculate
    Range("N7:GK7").Value = Range("N7:GK7").Value
    Range("H8").FormulaR1C1 = "=MIN(R[-1]C[6]:R[-1]C[185])"
    Range("H8").Value = Range("H8").Value
    
    Range("M8,N10:GK190").Clear
    
    Range("N10:Q190").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    ActiveSheet.Calculate
    Range("H6:L6").FormulaR1C1 = "=MAX(R[4]C[5]:R[194]C[5])"
    Range("H6:L6").Value = Range("H6:L6").Value
    
    Range("N8:GK8").FormulaR1C1 = "=IF(R[-1]C=R8C8,R[-6]C,"""")"
    Range("N9:GK11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    ActiveSheet.Calculate
    
    Range("I8").FormulaR1C1 = "=MAX(RC[5]:RC[184])"
    Range("J8").FormulaR1C1 = "=MAX(R[1]C[4]:R[1]C[183])"
    Range("K8").FormulaR1C1 = "=MAX(R[2]C[3]:R[2]C[182])"
    Range("L8").FormulaR1C1 = "=MAX(R[3]C[2]:R[3]C[181])"
    Range("I8:L8").Value = Range("I8:L8").Value
    
    Range("H7:L7").Value = Range("H2:L2").Value
    Range("M7").FormulaR1C1 = "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Columns("N:GK").Clear
    Range("G10:L190").Clear
    Range("A1:F3").Value = Range("H6:M8").Value
    Range("H1:M3").Value = Range("H6:M8").Value
    Range("H6:M8").Clear
    Application.Run "F.xlsm!Fline1"
  End If
     
End Sub
Sub ORRref()
'
' On Sheet 3
'
Application.ScreenUpdating = False
    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("A5").Value = 2.08333333333333E-04
    Sheets("Sheet3").Range("H1:M4").Value = Sheets("Sheet2").Range("H10:M13").Value
    If Range("H4") = "NO FIN LINE" Then
        Range("H4").Clear
    End If
    
    'SORT +/- 18 SECONDS
    Range("G10").FormulaR1C1 = _
        "=IF(OR(AND(RC[-6]>=R1C8-R5C1,RC[-6]<=R1C8+R5C1),AND(RC[-6]>=R2C8-R5C1,RC[-6]<=R2C8+R5C1),AND(RC[-6]>=R3C8-R5C1,RC[-6]<=R3C8+R5C1),AND(R4C8<>"""",RC[-6]>=R4C8-R5C1,RC[-6]<=R4C8+R5C1),AND(R5C8<>"""",RC[-6]>=R5C8-R5C1,RC[-6]<=R5C8+R5C1)),RC[-6],"""")"
    Range("H10:K10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    'Copy Ref A Value Sort
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "A").End(xlUp).Row
.Range("G10:K10").AutoFill Destination:=.Range("G10:K" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("G10:K60009").Value = Range("G10:K60009").Value
    Range("G10:K60009").Sort Key1:=Range("G10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    'CHECK TP
    Range("M8:R8").FormulaR1C1 = "=MAX(R[2]C:R[192]C)"
    Range("M9").FormulaR1C1 = "=2*R8C"
    Range("M10:M200").FormulaR1C1 = _
        "=IF(RC[-6]="""","""",IF(AND(RC[-6]>R1C8,RC[-6]<R3C8),6371*ACOS(SIN(RC[-5])*SIN(R1C9)+COS(RC[-5])*COS(R1C9)*COS(R1C10-RC[-4])),""""))"
    Range("N10:N200").FormulaR1C1 = "=IF(RC[-1]=R8C13,RC[-7],"""")"
    Range("O10:R200").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-7],"""")"
    ActiveSheet.Calculate
    
    If Range("M9") > Range("M2") Then
        Range("H2:L2").Value = Range("N8:R8").Value
        Range("M2").Value = Range("M9").Value
    End If
    Range("M8:R200").Clear
    
    'CK OZ if Fini by Sector ONLY
If Range("H4") = "" And Range("M3") = "SECTOR" Then
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I2:J2").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("J6:J7").Value = Sheets("YDWK3").Range("E2:E3").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Activate
   'Find 7 Fixes - 3 before & 3 after raw Fin
    Range("M10").FormulaR1C1 = "=IF(RC[-6]=R3C8,1,"""")"
    Range("N10").FormulaR1C1 = "=IF(R[3]C[-1]=1,1,"""")"
    Range("O10").FormulaR1C1 = "=IF(R[2]C[-2]=1,1,"""")"
    Range("P10").FormulaR1C1 = "=IF(R[1]C[-3]=1,1,"""")"
    Range("Q10").FormulaR1C1 = "=IF(R[-1]C[-4]=1,1,"""")"
    Range("R10").FormulaR1C1 = "=IF(R[-2]C[-5]=1,1,"""")"
    Range("S10").FormulaR1C1 = "=IF(R[-3]C[-6]=1,1,"""")"
    
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("M10:S10").AutoFill Destination:=.Range("M10:S" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("M10:S209").Value = Range("M10:S209").Value
    Range("T10").FormulaR1C1 = "=IF(OR(RC[-7]=1,RC[-6]=1,RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-13],"""")"
    Range("U10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("V10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("W10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("X10").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
      
    With Worksheets("Sheet3")
    LastRow = .Cells(Rows.Count, "G").End(xlUp).Row
.Range("T10:X10").AutoFill Destination:=.Range("T10:X" & LastRow), Type:=xlFillDefault
    End With
    ActiveSheet.Calculate
    Range("T10:X209").Value = Range("T10:X209").Value
    Range("M10:S209").Clear
    Range("T10:X209").Sort Key1:=Range("T10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    'Test 3 earlier, 3 later than A3
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U10:V10").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S10").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U11:V11").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S11").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U12:V12").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S12").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U13:V13").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S13").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U14:V14").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S14").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U15:V15").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S15").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Sheets("YDWK3").Range("C5:D5").Value = Sheets("Sheet3").Range("U16:V16").Value
    Sheets("YDWK3").Range("C6:D6").Value = Sheets("Sheet3").Range("I1:J1").Value
    Sheets("YDWK3").Calculate
    Sheets("Sheet3").Range("S16").Value = Sheets("YDWK3").Range("C2").Value
    Sheets("YDWK3").Range("C5:D6").Value = 0
    Sheets("YDWK3").Activate
    Range("C24").FormulaR1C1 = _
        "=R[-15]C+(1-R[-1]C)*R[-16]C*R[-3]C*(ACOS(R[-4]C)+R[-1]C*SIN(ACOS(R[-4]C))*(R[-2]C+R[-1]C*R[-4]C*(-1+2*R[-2]C*R[-2]C)))"
    Sheets("YDWK3").Calculate
    Application.Run "F.xlsm!YDWK3clear"
    
    Sheets("Sheet3").Activate
    Range("M6").FormulaR1C1 = "=MIN(R[4]C:R[10]C)"
    Range("N6:Q6").FormulaR1C1 = "=MAX(R[4]C:R[10]C)"
    Range("M10:M16").FormulaR1C1 = _
        "=IF(OR(6371*ACOS(SIN(RC[8])*SIN(R1C9)+COS(RC[8])*COS(R1C9)*COS(R1C10-RC[9]))>1,RC[6]=""""),"""",IF(OR(AND(R6C10>R7C10,RC[6]>=R7C10,RC[6]<=R6C10),AND(R6C10<R7C10,OR(RC[6]<=R6C10,RC[6]>=R7C10))),RC[7],""""))"
    Range("N10:N16").FormulaR1C1 = "=IF(RC[-1]=R6C13,RC[7],"""")"
    Range("O10:Q16").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[7],"""")"
    ActiveSheet.Calculate
    Range("M6:Q6").Value = Range("M6:Q6").Value
    
    If Range("M6") > 0 Then
        Range("K6").Value = "OK"
        Range("H3:L3").Value = Range("M6:Q6").Value
        Range("M2").FormulaR1C1 = "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
        Range("N2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-R[1]C[-3]<=R9C4),AND(RC[-1]<=100,R9C5<>""PR"",R[-1]C[-3]-R[1]C[-3]<=(10*RC[-1])),AND(RC[-1]<=100,R9C5=""PR"",R[-1]C[-3]-R[1]C[-3]<=(10*RC[-1]-100))),RC[-1],IF(AND(RC[-1]>100,R[-1]C[-3]-R[1]C[-3]>R9C4),RC[-1]-((R[-1]C[-3]-R[1]C[-3]-R9C4)*0.1),0))"
        ActiveSheet.Calculate
        If Range("N2") < Range("M2") Then
            Range("M2").Value = Range("N2").Value
            Range("N3").Value = "LOH"
        End If
        Range("M2").Value = Range("M2").Value
        Range("N2").Clear
        Range("M3").Value = "SECTOR"
        Range("H4").Value = "NO FIN LINE"
        
        Sheets("Sheet2").Range("H15:M18").Value = Sheets("Sheet3").Range("H1:N4").Value
        Sheets("Sheet3").Range("A5,H1:N3").Clear
    End If
    
ElseIf Range("I4") = "        FINISH LINE" Then
    Range("M10:M209").FormulaR1C1 = "=IF(RC[-6]="""","""",IF(AND(RC[-6]>=R1C8-R5C1,RC[-6]<=R1C8+R5C1),RC[-6],""""))"
    Range("N10:Q209").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    Range("R10:R209").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-10])*SIN(R2C9)+COS(RC[-10])*COS(R2C9)*COS(R2C10-RC[-9])),"""")"
    Range("S10:S209").FormulaR1C1 = "=IF(RC[-6]="""","""",IF(RC[-1]>100,R9C4,IF(R9C5<>""PR"",20*RC[-1],20*RC[-1]-100)))"
    ActiveSheet.Calculate
    Range("M10:S209").Value = Range("M10:S209").Value
    Range("M10:S209").Sort Key1:=Range("M10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("T10:T209").FormulaR1C1 = "=IF(RC[-13]="""","""",IF(AND(RC[-13]>=R3C8-R5C1,RC[-13]<=R3C8+R5C1),RC[-13],""""))"
    Range("U10:X209").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-13],"""")"
    Range("Y10:Y209").FormulaR1C1 = "=IF(RC[-1]<>"""",6371*ACOS(SIN(RC[-17])*SIN(R2C9)+COS(RC[-17])*COS(R2C9)*COS(R2C10-RC[-16])),"""")"
    ActiveSheet.Calculate
    Range("T10:Y209").Value = Range("T10:Y209").Value
    Range("T10:Y209").Sort Key1:=Range("T10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Range("T10:Y209").Copy
    Range("T1").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Range("T10:Y209").Clear
 
    'MATRIX
    Range("T10:HL209").FormulaR1C1 = _
        "=IF(OR(RC13="""",R1C="""",RC15=R3C),"""",IF(OR(6371*ACOS(SIN(RC14)*SIN(R2C)+COS(RC14)*COS(R2C)*COS(R3C-RC15))>0.5,R6C<RC18,R6C[1]<RC18,R6C<SQRT(RC18^2+0.25)),"""",IF(RC16-R4C<=RC19,R6C+RC18,IF(AND(RC16-R4C>RC19,R9C5<>""PR""),R6C+RC18-((RC16-R4C-RC19)*0.1),0))))"
    ActiveSheet.Calculate
    Range("T10:HL209").Value = Range("T10:HL209").Value
    Range("O5").FormulaR1C1 = "=MAX(R[5]C[5]:R[195]C[205])"
    ActiveSheet.Calculate
    Range("O5").Value = Range("O5").Value
    Range("T7:HL7").FormulaR1C1 = "=IF(MAX(R[3]C:R[193]C)=R5C15,R1C,"""")"
    ActiveSheet.Calculate
    Range("T7:HL7").Value = Range("T7:HL7").Value
    
    Range("S10:S209").FormulaR1C1 = "=IF(MAX(RC[1]:RC[201])=R5C15,RC[-6],"""")"
    ActiveSheet.Calculate
    Range("S10:S209").Value = Range("S10:S209").Value
    
    Range("T10:HL209").Clear
    Range("T10:W209").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-6],"""")"
    
    Range("N1:R1").FormulaR1C1 = "=MAX(R[9]C[5]:R[199]C[5])"
    ActiveSheet.Calculate
    Range("N1:R1").Value = Range("N1:R1").Value
    Range("N2:R2").Value = Range("H2:L2").Value
    Range("T8:HL11").FormulaR1C1 = "=IF(R[-1]C<>"""",R[-6]C,"""")"
    ActiveSheet.Calculate
    Range("N3").FormulaR1C1 = "=MAX(R[4]C[6]:R[4]C[206])"
    Range("O3").FormulaR1C1 = "=MAX(R[5]C[5]:R[5]C[205])"
    Range("P3").FormulaR1C1 = "=MAX(R[6]C[4]:R[6]C[204])"
    Range("Q3").FormulaR1C1 = "=MAX(R[7]C[3]:R[7]C[203])"
    Range("R3").FormulaR1C1 = "=MAX(R[8]C[2]:R[8]C[202])"
    ActiveSheet.Calculate
    Range("N3:R3").Value = Range("N3:R3").Value
    
    Range("T1:HL209").Clear
    Range("S2").FormulaR1C1 = "=2*6371*ACOS(SIN(R[-1]C[-4])*SIN(RC[-4])+COS(R[-1]C[-4])*COS(RC[-4])*COS(RC[-3]-R[-1]C[-3]))"
    Range("T2").FormulaR1C1 = _
        "=IF(OR(AND(RC[-1]>100,R[-1]C[-3]-R[1]C[-3]<R9C4),AND(RC[-1]<=100,R9C5<>""PR"",R[-1]C[-3]-R[1]C[-3]<=10*RC[-1]),AND(RC[-1]<=100,R9C5=""PR"",R[-1]C[-3]-R[1]C[-3]<=10*RC[-1]-100)),RC[-1],IF(R9C5<>""PR"",RC[-1]-((R[-1]C[-3]-R[1]C[-3]-R9C4)*0.1),0))"
    Range("S3").FormulaR1C1 = "=IF(R[-1]C[1]<R[-1]C,""LOH"","""")"
    ActiveSheet.Calculate
    Range("S3").Value = Range("S3").Value
    Range("S2").Value = Range("T2").Value
    Range("T2,M5:S209").Clear
    
    'Select New FINI + 2 fixes before, 2 fixes after
    Range("M10:M209").FormulaR1C1 = "=IF(RC[-6]=R3C14,1,"""")"
    Range("N10:N209").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
    Range("O10:O209").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
    Range("P10:P209").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
    Range("Q10:Q209").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
    Range("R10:R209").FormulaR1C1 = "=IF(AND(RC[-11]<>"""",OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1)),RC[-11],"""")"
    Range("S10:V209").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
    ActiveSheet.Calculate
    Range("R10:V209").Value = Range("R10:V209").Value
    Range("M10:Q209").Clear
    Range("R10:V209").Sort Key1:=Range("R10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
    Sheets("YDWK3").Activate
    Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet3").Range("N2:R2").Value
    Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet3").Range("N1:R1").Value
    Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet3").Range("R10:V14").Value

    Application.Run "F.xlsm!FINlines"

    Sheets("Sheet3").Activate
    Sheets("Sheet3").Range("N4").Value = Sheets("YDWK3").Range("M17").Value
    Sheets("Sheet3").Range("O4").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
    ActiveSheet.Calculate
    Range("O4").Value = Range("O4").Value
    Sheets("Sheet3").Range("Q4:R4").Value = Sheets("YDWK3").Range("N17:O17").Value
    Range("A5,R10:V14").Clear

Application.Run "F.xlsm!YDWK3clear"

    Sheets("Sheet3").Activate

    If Range("N4") = "NO FIN LINE" Then
        'CK ORIGINAL Start; FINI + 2 fixes before, 2 fixes after
        Range("M10:M209").FormulaR1C1 = "=IF(RC[-6]=R3C8,1,"""")"
        Range("N10:N209").FormulaR1C1 = "=IF(R[2]C[-1]=1,1,"""")"
        Range("O10:O209").FormulaR1C1 = "=IF(R[1]C[-2]=1,1,"""")"
        Range("P10:P209").FormulaR1C1 = "=IF(R[-1]C[-3]=1,1,"""")"
        Range("Q10:Q209").FormulaR1C1 = "=IF(R[-2]C[-4]=1,1,"""")"
        Range("R10:R209").FormulaR1C1 = "=IF(OR(RC[-5]=1,RC[-4]=1,RC[-3]=1,RC[-2]=1,RC[-1]=1),RC[-11],"""")"
        Range("S10:V209").FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-11],"""")"
        ActiveSheet.Calculate
        Range("R10:V209").Value = Range("R10:V209").Value
        Range("M10:Q209").Clear
        Range("R10:V209").Sort Key1:=Range("R10"), Order1:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal
    
        Sheets("YDWK3").Activate
        Sheets("YDWK3").Range("M22:Q22").Value = Sheets("Sheet3").Range("H2:L2").Value
        Sheets("YDWK3").Range("M23:Q23").Value = Sheets("Sheet3").Range("H1:L1").Value
        Sheets("YDWK3").Range("M25:Q29").Value = Sheets("Sheet3").Range("R10:V14").Value

    Application.Run "F.xlsm!FINlines"

        Sheets("Sheet3").Activate
        Sheets("Sheet3").Range("H5").Value = Sheets("YDWK3").Range("M17").Value
        Sheets("Sheet3").Range("I5").FormulaR1C1 = "=IF(RC[-1]<>""NO FIN LINE"",""        FINISH LINE"","""")"
        Range("I5").Value = Range("I5").Value
        Sheets("Sheet3").Range("K5:L5").Value = Sheets("YDWK3").Range("N17:O17").Value
        Range("A5,N1:S4,R10:V14").Clear

    Application.Run "F.xlsm!YDWK3clear"
    End If
    
    Sheets("Sheet3").Activate
    If Range("S2") > Range("M2") And Range("I4") = Range("O4") And Range("M3") = Range("S3") Then
        Sheets("Sheet2").Range("H15:M18").Value = Sheets("Sheet3").Range("N1:S4").Value
    ElseIf Range("I5") = "        FINISH LINE" Then
        Sheets("Sheet2").Range("H15:M17").Value = Sheets("Sheet3").Range("H1:M3").Value
        Sheets("Sheet2").Range("H18:M18").Value = Sheets("Sheet3").Range("H5:M5").Value
    ElseIf Range("H5") = "NO FIN LINE" And Range("I4") = "        FINISH LINE" Then
        Sheets("Sheet2").Range("H15:M18").Value = Sheets("Sheet3").Range("H1:M4").Value
    End If
End If
Sheets("Sheet3").Columns("G:V").Clear

End Sub

Sub OZSectorB()
'
' OZSectorB Macro
'
    'P1 differentiates between Sect / Line based on flight date 10/1/15
    Range("P1").FormulaR1C1 = _
        "=IF(AND(R2C6=MAX(R2C6,R2C13,R7C13),R4C1<>""NO FIN LINE""),""A1"",IF(OR(AND(R2C13=MAX(R2C13,R7C13),R3C13=""SECTOR"",R4C8=""NO FIN LINE""),AND(R2C13=MAX(R2C13,R7C13),R4C8<>""NO FIN LINE"")),""H1"",IF(AND(R6C8<>"""",R9C8<>""NO FIN LINE""),""H6"")))"
    ActiveSheet.Calculate
    Range("P1").Value = Range("P1").Value
    
    If Range("P1") = "H1" Then
        Range("H10:M13").Value = Range("H1:M4").Value
    ElseIf Range("P1") = "A1" Then
        Range("H10:M13").Value = Range("A1:F4").Value
    ElseIf Range("P1") = "H6" Then
        Range("H10:M13").Value = Range("H6:M9").Value
    End If
    
  If Range("A9") = "REF" Or Range("B9") = "REF2" Then
    Application.Run "F.xlsm!ORRref"
    Sheets("Sheet2").Activate
  End If

If Range("H15") <> "" Then
    If Range("M17") = "SECTOR" And Range("H18") = "NO FIN LINE" Then
        Range("I17:J17").Value = Range("I15:J15").Value
        Range("I18").Value = "   FINISH SECTOR"
        Range("M17").Clear
        Range("K18:L18").Value = Range("K17:L17").Value
        Range("H18").Value = Range("H17").Value
    ElseIf Range("I18") = "        FINISH LINE" Then
        Range("H17").Value = Range("H18").Value
        Range("I17:J17").Value = Range("I15:J15").Value
        Range("K17:L17").Value = Range("K18:L18").Value
        Range("M17").Clear
    End If

    Sheets("TASKS").Activate
    Sheets("TASKS").Range("C14:E17").Value = Sheets("Sheet2").Range("H15:J18").Value
    Range("F14:G16").FormulaR1C1 = "=DEGREES(RC[-2])"
    Sheets("TASKS").Range("H14:J17").Value = Sheets("Sheet2").Range("K15:M18").Value
    Range("F17").FormulaR1C1 = "=RC[-2]"
    Range("F14:G17").Value = Range("F14:G17").Value
     
ElseIf Range("H15") = "" Then
    If Range("M12") = "SECTOR" And Range("H13") = "NO FIN LINE" Then
        Range("I12:J12").Value = Range("I10:J10").Value
        Range("I13").Value = "   FINISH SECTOR"
        Range("M12").Clear
        Range("K13:L13").Value = Range("K12:L12").Value
        Range("H13").Value = Range("H12").Value
    ElseIf Range("I13") = "        FINISH LINE" Then
        Range("H12").Value = Range("H13").Value
        Range("I12:J12").Value = Range("I10:J10").Value
        Range("K12:L12").Value = Range("K13:L13").Value
        Range("M12").Clear
    End If
    Sheets("TASKS").Activate
    Sheets("TASKS").Range("C14:E17").Value = Sheets("Sheet2").Range("H10:J13").Value
    Range("F14:G16").FormulaR1C1 = "=DEGREES(RC[-2])"
    Sheets("TASKS").Range("H14:J17").Value = Sheets("Sheet2").Range("K10:M13").Value
    Range("F17").FormulaR1C1 = "=RC[-2]"
    Range("F14:G17").Value = Range("F14:G17").Value
End If

Sheets("Sheet2").Activate
Range("A1:F7").Clear
Columns("F:P").Clear
Application.Run "F.xlsm!ORDS"

End Sub

+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |Workbook_Open       |Runs when the Excel Workbook is opened       |
|Suspicious|Run                 |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Hex String|G""""""             |47222222222222                               |
|Base64    |7]5                 |N101                                         |
|String    |                    |                                             |
|Base64    |3]9                 |M105                                         |
|String    |                    |                                             |
|Base64    |#]9                 |I105                                         |
|String    |                    |                                             |
|Base64    |']9                 |J105                                         |
|String    |                    |                                             |
|Base64    |+]9                 |K105                                         |
|String    |                    |                                             |
|Base64    |DAv                 |REF2                                         |
|String    |                    |                                             |
+----------+--------------------+---------------------------------------------+

